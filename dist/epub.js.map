{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 168360cec27c75ef536d","webpack:///./src/core.js","webpack:///./src/epubcfi.js","webpack:///./~/path-webpack/path.js","webpack:///./~/event-emitter/index.js","webpack:///(webpack)/buildin/global.js","webpack:///./~/process/browser.js","webpack:///./src/hook.js","webpack:///./src/mapping.js","webpack:///./src/queue.js","webpack:///./src/replacements.js","webpack:///./src/request.js","webpack:///./src/contents.js","webpack:///./src/managers/default/index.js","webpack:///./src/rendition.js","webpack:///external \"xmldom\"","webpack:///./src/book.js","webpack:///./src/managers/continuous/index.js","webpack:///./src/managers/views/iframe.js","webpack:///./libs/mime/mime.js","webpack:///./~/base64-js/index.js","webpack:///./~/d/index.js","webpack:///./~/es5-ext/object/assign/index.js","webpack:///./~/es5-ext/object/assign/is-implemented.js","webpack:///./~/es5-ext/object/assign/shim.js","webpack:///./~/es5-ext/object/is-callable.js","webpack:///./~/es5-ext/object/keys/index.js","webpack:///./~/es5-ext/object/keys/is-implemented.js","webpack:///./~/es5-ext/object/keys/shim.js","webpack:///./~/es5-ext/object/normalize-options.js","webpack:///./~/es5-ext/object/valid-callable.js","webpack:///./~/es5-ext/object/valid-value.js","webpack:///./~/es5-ext/string/#/contains/index.js","webpack:///./~/es5-ext/string/#/contains/is-implemented.js","webpack:///./~/es5-ext/string/#/contains/shim.js","webpack:///./src/archive.js","webpack:///./src/container.js","webpack:///./src/layout.js","webpack:///./src/locations.js","webpack:///./src/managers/helpers/stage.js","webpack:///./src/managers/helpers/views.js","webpack:///./src/navigation.js","webpack:///./src/packaging.js","webpack:///./src/pagelist.js","webpack:///./src/resources.js","webpack:///./src/section.js","webpack:///./src/spine.js","webpack:///external \"JSZip\"","webpack:///./src/epub.js"],"names":[],"mappings":"AAAA;AACA;AACA,0EAA0E,MAAM,yBAAyB,EAAE,YAAY,EAAE;AACzH;AACA;AACA;AACA,2EAA2E,MAAM,yBAAyB,EAAE,YAAY,EAAE;AAC1H;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA,mDAA2C,cAAc;;AAEzD;AACA;AACA;AACA;AACA;AACA;AACA,YAAI;AACJ;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;AC9DA;AACA;;AAEA;;AAEA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,SAAS;AACpB;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,EAAE;;AAEF;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,eAAe,YAAY;AAC3B;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,2CAA2C,YAAY;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;;AAEA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,EAAE;;AAEF;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,EAAE;;AAEF;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,sBAAsB;AACtB;;AAEA;AACA,sBAAsB;AACtB;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,gBAAgB,qBAAqB;AACrC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,iCAAiC,aAAa;;AAE9C;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA,8BAA8B;;AAE9B;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,YAAY,SAAS;AACrB;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA,qCAAqC;AACrC;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,mDAAmD;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B;AAC3B,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,YAAY,SAAS;AACrB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,SAAS;AACrB;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,kBAAkB;AACnC;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA;AACA;AACA,gBAAgB,uBAAuB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC7sBA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA,mBAAmB;;AAEnB,oBAAoB;;AAEpB;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA;;AAEA;;;AAGA;AACA;AACA;AACA,EAAE;AACF;AACA,EAAE;AACF;AACA,EAAE;AACF;AACA,EAAE;AACF;AACA,EAAE;AACF;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA,EAAE,2EAA2E;AAC7E;AACA,EAAE;AACF;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW;AACX,WAAW;AACX;AACA;AACA;AACA;;AAEA;AACA,UAAU;AACV;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,UAAU;AACV;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,gBAAgB;AAChB;;AAEA;AACA;AACA,EAAE;;AAEF;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA,oBAAoB;AACpB;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,mCAAmC;AACnC;;AAEA;AACA;AACA;;AAEA;;AAEA,EAAE;;AAEF;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA,gBAAgB,mBAAmB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;;AAEA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,WAAW;AACX,WAAW;AACX;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,WAAW;AACX,WAAW;AACX;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA,EAAE;AACF;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ,UAAU;AACV;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,YAAY,SAAS;;AAErB;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA,EAAE;;AAEF;AACA;;;AAGA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,EAAE;;AAEF;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,YAAY,SAAS;AACrB;;AAEA;AACA;AACA,GAAG;AACH;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA,EAAE;AACF;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;;AAEA,GAAG;AACH;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;;AAEA,GAAG;AACH;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;;;;;;;ACl8BA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,kBAAkB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,QAAQ;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,sCAAsC,8BAA8B;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA,GAAG;;;AAGH;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;AACA,mBAAmB,sBAAsB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,UAAU,yBAAyB;AACnC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,UAAU,qBAAqB;AAC/B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,UAAU,aAAa;AACvB;AACA;AACA;AACA;AACA,4CAA4C;AAC5C;AACA,WAAW;AACX;AACA,qCAAqC;AACrC;AACA;AACA,SAAS;AACT;AACA;AACA,gDAAgD;AAChD;AACA,WAAW;AACX;AACA,wCAAwC;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,2CAA2C,cAAc;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,QAAQ;AACzC;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,+BAA+B,QAAQ;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,+BAA+B,QAAQ;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,QAAQ;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;;AAEA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,UAAU,YAAY;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;;;AAGA;;;;;;;;;ACniBA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,kBAAkB;;AAElB;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,aAAa,4BAA4B;AACzC;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,OAAO;;AAEpB;AACA,aAAa,2BAA2B;AACxC;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,OAAO;AACrB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,0BAA0B;;AAE1B;AACA;AACA;AACA;;;;;;;ACnIA;;AAEA;AACA,iBAAiB,aAAa,EAAE;;AAEhC;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;;AAEA;AACA;AACA,4CAA4C;;AAE5C;;;;;;;AClBA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,2BAA2B;AAC3B;AACA;AACA;AACA,4BAA4B,UAAU;;;;;;;ACnLtC;AACA;AACA;AACA;AACA,WAAW,IAAI;AACf;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,6CAA6C,IAAI;AACjD;AACA;AACA,eAAe,sBAAsB;AACrC;AACA;AACA,GAAG;AACH;AACA,iBAAiB,yBAAyB;AAC1C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,uDAAuD,IAAI;AAC3D;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,EAAE;;;AAGF;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;;;;;;AC7DA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,gBAAgB,iBAAiB;AACjC;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA;AACA;;AAEA,GAAG;;AAEH;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA;AACA;;AAEA,GAAG;;;AAGH;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA,gBAAgB,mBAAmB;AACnC;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,gBAAgB,mBAAmB;AACnC;;AAEA;;AAEA;AACA;AACA,GAAG;AACH;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;;AAIA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA,gBAAgB,oBAAoB;AACpC;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;;;;;;ACxSA;;AAEA;AACA;AACA;AACA,WAAW,MAAM;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,EAAE;AACF;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY;AACZ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL,IAAI;AACJ;AACA;AACA;AACA;;;;AAIA,GAAG;AACH;AACA;AACA;;AAEA,EAAE;AACF;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,KAAK;;AAEL,GAAG;AACH;AACA;AACA;;AAEA,EAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY;AACZ;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,IAAI;AAChB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,SAAS;AACpB,WAAW,MAAM;AACjB,WAAW,MAAM;AACjB,YAAY,SAAS;AACrB;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,EAAE;;AAEF;;AAEA;;AAEA;;;;;;;AClOA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,uBAAuB;;AAEvB;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA;AACA,EAAE;;AAEF,gBAAgB,kBAAkB;AAClC;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACjHA;AACA;;AAEA;AACA,uEAAuE;AACvE;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA,mCAAmC;AACnC;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,6CAA6C;AAC7C;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA,yCAAyC;AACzC;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA,MAAM;AACN;AACA;AACA;;AAEA,KAAK;AACL;AACA;;AAEA;AACA,IAAI;;AAEJ;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA;;;;;;;ACvJA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;;AAGA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;;AAGA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH,iBAAiB,mBAAmB;AACpC;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,sBAAsB;AACtB,mBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN,EAAE;;AAEF;AACA,eAAe;;AAEf;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,gBAAgB,mBAAmB;AACnC;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAE;;AAEF;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,kBAAkB;;AAElB;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA,EAAE;AACF;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;;AAEA,EAAE;AACF;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA,mCAAmC,QAAQ;AAC3C;AACA;AACA;AACA;AACA;AACA;;AAEA,4BAA4B,QAAQ;AACpC;AACA,2EAA2E;AAC3E;;AAEA;AACA,qCAAqC,gBAAgB;AACrD;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;;AAEA,EAAE;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,gBAAgB,2CAA2C;;AAE3D;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA,gBAAgB,aAAa;;AAE7B;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;;;;;;ACnqBA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,gDAAgD;AAChD;AACA;AACA;AACA;AACA,+BAA+B,2DAA2D;AAC1F;AACA;AACA;AACA,EAAE;;AAEF,kDAAkD;;AAElD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF;;AAEA;AACA;AACA;AACA,KAAK;;AAEL;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,EAAE;AACF;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;;AAEF;;AAEA;AACA;AACA;AACA,EAAE;;AAEF;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;;AAEA;;AAEA,GAAG;AACH;AACA;AACA,MAAM;AACN;AACA;AACA,MAAM;AACN;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,EAAE;AACF;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;;;AAGA,EAAE;;AAEF;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;;;AAGA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA,GAAG;AACH;AACA;;;AAGA,EAAE;;AAEF;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,EAAE;AACF;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,gBAAgB,iBAAiB;AACjC;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,uCAAuC,wCAAwC;;AAE/E;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA,GAAG;;AAEH;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,KAAK;;AAEL;;AAEA;AACA;;AAEA;;;;;;;ACpjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,KAAK;AAChB,WAAW,OAAO;AAClB,WAAW,IAAI;AACf,WAAW,IAAI;AACf,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,WAAW,IAAI;AACf;AACA;;AAEA,gDAAgD;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA,eAAe,KAAK;AACpB;AACA;AACA;AACA;AACA;AACA,eAAe,OAAO;AACtB,WAAW;AACX;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,SAAS;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,gBAAgB;AAC5B,YAAY;AACZ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,oFAAoF;AACpF,EAAE;AACF;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,gBAAgB;AAC5B,YAAY;AACZ;AACA;AACA;;AAEA;AACA,mEAAmE;AACnE,EAAE;AACF;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;AAGA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,QAAQ;AACpB,YAAY;AACZ;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA,EAAE;;AAEF;;AAEA;AACA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY;AACZ;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA,GAAG;AACH;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA,YAAY,EAAE;AACd;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;;AAEF;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,IAAI;AAChB;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,IAAI;AACJ,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,EAAE;AACF;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAY,KAAK;AACjB;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA,YAAY,MAAM;AAClB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,KAAK;AACjB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,EAAE;AACF;;AAEA;AACA;;AAEA;;;;;;;ACvkBA,gD;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,WAAW,QAAQ;AACnB,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,aAAa;AACb,6CAA6C;AAC7C,sBAAsB,0BAA0B;AAChD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,gDAAgD;AAChD;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;;;AAGA;AACA;AACA;AACA,eAAe,QAAQ;AACvB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,eAAe,QAAQ;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA,eAAe,OAAO;AACtB;AACA;AACA;;AAEA;AACA,eAAe,MAAM;AACrB;AACA;;AAEA;AACA,eAAe,UAAU;AACzB;AACA;;AAEA;AACA,eAAe,WAAW;AAC1B;AACA;;AAEA;AACA,eAAe,SAAS;AACxB;AACA;;AAEA;AACA,eAAe,IAAI;AACnB;AACA;AACA;;AAEA;AACA,eAAe,KAAK;AACpB;AACA;AACA;;AAEA;AACA,eAAe,QAAQ;AACvB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,SAAS;AACrB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,QAAQ;AACpB;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,UAAU;AACtB,YAAY,OAAO;AACnB;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,WAAW,SAAS;AACpB;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA,EAAE;;AAEF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA,GAAG;AACH,EAAE;AACF;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,WAAW,SAAS;AACpB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,YAAY,SAAS;AACrB,YAAY;AACZ;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,WAAW,QAAQ;AACnB;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,SAAS;AACrB,YAAY;AACZ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,GAAG;;;;AAIH;AACA;;AAEA;AACA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,YAAY;AACZ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF;;AAEA;AACA;AACA,YAAY,SAAS;AACrB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;;;;;;ACzeA;AACA;;AAEA;;AAEA,2CAA2C;;AAE3C;;AAEA,gDAAgD;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF,kDAAkD;;AAElD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,EAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;;AAEF;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;;AAEF;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,EAAE;AACF;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,EAAE;AACF;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,gBAAgB,iBAAiB;AACjC;;AAEA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA,IAAI;AACJ;;AAEA;;AAEA;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,2BAA2B;;AAE3B;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;;AAGL,OAAO;;AAEP,EAAE;AACF;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,gBAAgB,oBAAoB;AACpC;AACA;;AAEA;AACA,gBAAgB,kBAAkB;AAClC;AACA;;AAEA;AACA;AACA;;AAEA,8DAA8D;;AAE9D;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,MAAM;AACN,KAAK;;AAEL;;AAEA,GAAG;AACH;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;;AAEA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,sBAAsB,QAAQ;AAC9B;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,EAAE;;AAEF,sBAAsB,QAAQ;AAC9B;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,uCAAuC,wCAAwC;;AAE/E;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA,EAAE;AACF;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA,KAAK;;AAEL;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;;;;;;;ACtqBA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B;AAC5B,EAAE,eAAe;;AAEjB;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,8BAA8B;AAC9B;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;;AAEA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,MAAM;AACN;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,MAAM;AACN;AACA;AACA,MAAM;AACN;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA,GAAG;AACH;AACA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA,EAAE;AACF;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAE;AACF,mBAAmB;AACnB;;AAEA;AACA;AACA,uCAAuC;AACvC;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;;;AAIA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA,EAAE;;AAEF;AACA;AACA,EAAE;;AAEF;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA,GAAG;;AAEH,EAAE;AACF;AACA;;;AAGA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;;;;;;AC9jBA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN,qBAAqB,oBAAoB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED,gCAAgC;;AAEhC;AACA;AACA;;AAEA;AACA;AACA;;;;;;;;AC1KA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,kCAAkC,SAAS;AAC3C;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA,oBAAoB,OAAO;AAC3B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,qBAAqB,SAAS;AAC9B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,0CAA0C,UAAU;AACpD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;ACjHA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;;AAEA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA,EAAE;AACF;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA,SAAS;AACT;AACA;;;;;;;;AC9DA;;AAEA;AACA;AACA;;;;;;;;ACJA;;AAEA;AACA;AACA;AACA,QAAQ;AACR,cAAc,aAAa,GAAG,eAAe;AAC7C;AACA;;;;;;;;ACRA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,OAAO,sBAAsB,EAAE;AAC/B;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACrBA;;AAEA;;AAEA,iCAAiC,kCAAkC;;;;;;;;ACJnE;;AAEA;AACA;AACA;;;;;;;;ACJA;;AAEA;AACA;AACA;AACA;AACA,EAAE,YAAY,cAAc;AAC5B;;;;;;;;ACPA;;AAEA;;AAEA;AACA;AACA;;;;;;;;ACNA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;;;;;;;;AChBA;;AAEA;AACA;AACA;AACA;;;;;;;;ACLA;;AAEA;AACA;AACA;AACA;;;;;;;;ACLA;;AAEA;AACA;AACA;;;;;;;;ACJA;;AAEA;;AAEA;AACA;AACA;AACA;;;;;;;;ACPA;;AAEA;;AAEA;AACA;AACA;;;;;;;ACNA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB;AACA;AACA,mCAAmC,mBAAmB;AACtD;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,QAAQ;AACpB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA,oCAAoC,mBAAmB;AACvD,GAAG;AACH;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,SAAS;AACrB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH,EAAE;AACF;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,IAAI;AAChB,YAAY,SAAS;AACrB,YAAY,IAAI;AAChB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,SAAS;AACrB,YAAY;AACZ;AACA;AACA,6DAA6D;AAC7D;;AAEA;AACA;AACA;AACA,kCAAkC,gBAAgB;AAClD,GAAG;AACH;AACA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,SAAS;AACrB,YAAY;AACZ;AACA;AACA,6DAA6D;AAC7D;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,SAAS;AACrB,YAAY,OAAO;AACnB;AACA;AACA,6DAA6D;AAC7D;;AAEA;AACA;AACA;AACA,iCAAiC;AACjC,GAAG;AACH;AACA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,SAAS;AACrB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA,IAAI;;AAEJ;;AAEA,EAAE;;AAEF;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA,IAAI;;AAEJ;AACA;;;AAGA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;ACpPA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,WAAW;AACtB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,SAAS;AACrB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;;;;;;ACxCA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,oBAAoB;AAC/B,WAAW,SAAS;AACpB,WAAW,UAAU;AACrB,WAAW,gBAAgB;AAC3B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,QAAQ;AACpB;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,SAAS;AACrB,YAAY;AACZ;AACA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA,EAAE,OAAO;AACT;AACA;;AAEA,kBAAkB;AAClB;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;ACzJA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,MAAM;AACjB,WAAW,QAAQ;AACnB;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA,YAAY,IAAI;AAChB,YAAY,OAAO;AACnB;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA,EAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,EAAE;;AAEF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,gBAAgB;AAChB;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,oDAAoD;AACpD;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA,EAAE;AACF;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;AACA,EAAE;AACF;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;;AAEA;;AAEA;;;;;;;AChQA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B,6BAA6B;AAC7B;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA,EAAE;AACF;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,wCAAwC;AACxC;AACA;AACA,EAAE;;AAEF,6CAA6C,cAAc;AAC3D;;;;AAIA;;;;;;;ACtOA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA,gBAAgB,SAAS;AACzB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA,gBAAgB,SAAS;AACzB;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA,gBAAgB,SAAS;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,gBAAgB,SAAS;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,gBAAgB,SAAS;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;ACpKA;AACA;;AAEA;AACA;AACA,WAAW,SAAS;AACpB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,SAAS;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAY,MAAM;AAClB;AACA;AACA;;AAEA,gBAAgB,gBAAgB;AAChC;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAY,SAAS;AACrB,YAAY,MAAM;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,YAAY,YAAY;AACxB;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAY,QAAQ;AACpB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,SAAS;AACrB,YAAY,MAAM;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,YAAY,YAAY;AACxB;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAY,QAAQ;AACpB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,SAAS;AACrB,YAAY,OAAO;AACnB;AACA;AACA;AACA;;AAEA;;;;;;;ACvMA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,SAAS;AACpB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,SAAS;AACrB,YAAY,OAAO;AACnB;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,SAAS;AACrB,YAAY,OAAO;AACnB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAY,SAAS;AACrB,YAAY,OAAO;AACnB;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,EAAE;;AAEF;;AAEA;;AAEA;AACA;AACA,YAAY,SAAS;AACrB,YAAY,mBAAmB;AAC/B,YAAY,OAAO;AACnB;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA4C,mBAAmB;AAC/D;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA4C,wCAAwC;AACpF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,YAAY,SAAS;AACrB,YAAY,OAAO;AACnB;AACA;AACA;AACA;;AAEA;AACA,gDAAgD,eAAe;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C,2BAA2B;AACtE;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,SAAS;AACrB,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,YAAY,SAAS;AACrB,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA,iCAAiC,oBAAoB;;AAErD;AACA;AACA;;AAEA;AACA;;AAEA;;;;;;;ACzRA;AACA;;AAEA;AACA;AACA,WAAW,WAAW;AACtB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,SAAS;AACrB;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAE,gBAAgB;AAClB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,SAAS;AACrB,YAAY,gBAAgB;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,YAAY,YAAY;AACxB;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,MAAM;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,EAAE;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,IAAI;AAChB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;ACxPA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,SAAS;AACpB,WAAW,SAAS;AACpB,WAAW,kBAAkB;AAC7B,WAAW,UAAU;AACrB,WAAW,SAAS;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA,EAAE;;AAEF;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,YAAY,SAAS;AACrB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;;AAEA,uCAAuC,oDAAoD;AAC3F,GAAG;;AAEH;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA,YAAY,UAAU;AACtB,YAAY,SAAS;AACrB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA,EAAE;AACF;AACA;;AAEA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,UAAU;AACtB,YAAY,SAAS;AACrB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,IAAI;;AAEJ;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA,GAAG;;AAEH;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,WAAW;AACvB,YAAY,SAAS;AACrB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,EAAE;AACF;AACA,IAAI,oDAAoD;AACxD;AACA;;AAEA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,SAAS;AACrB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;;;AAGA;;;;;;;ACpPA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,SAAS;AACrB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;AACA;AACA,IAAI;AACJ;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAY,SAAS;AACrB;AACA;AACA;AACA,6CAA6C;AAC7C;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;;AAGA;AACA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA,aAAa;;AAEb;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB;AACA;;AAEA;;AAEA;AACA;AACA;AACA,UAAU,OAAO;AACjB,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;AACA,YAAY,MAAM;AAClB,YAAY,OAAO;AACnB;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,YAAY,OAAO;AACnB;AACA;AACA;AACA;;AAEA;;;;;;;ACzLA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,QAAQ;AACpB,YAAY,OAAO;AACnB;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,yBAAyB,0BAA0B,EAAE;AACrD,yBAAyB,0BAA0B,EAAE;;AAErD;;AAEA;;;AAGA,EAAE;;AAEF;AACA;;AAEA;AACA;AACA,YAAY,aAAa;AACzB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA,EAAE;AACF;AACA,EAAE;AACF;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;;AAEA;;;;;;;AChKA,2DAA2D,kDAAkD,6BAA6B;AAC1I,gD;;;;;;;ACDA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,mBAAmB;AAC9B,WAAW,OAAO;AAClB,aAAa,KAAK;AAClB,yCAAyC;AACzC;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA","file":"epub.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory((function webpackLoadOptionalExternalModule() { try { return require(\"JSZip\"); } catch(e) {} }()), require(\"xmldom\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"JSZip\", \"xmldom\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ePub\"] = factory((function webpackLoadOptionalExternalModule() { try { return require(\"JSZip\"); } catch(e) {} }()), require(\"xmldom\"));\n\telse\n\t\troot[\"ePub\"] = factory(root[\"JSZip\"], root[\"xmldom\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_48__, __WEBPACK_EXTERNAL_MODULE_14__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmory imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmory exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tObject.defineProperty(exports, name, {\n \t\t\tconfigurable: false,\n \t\t\tenumerable: true,\n \t\t\tget: getter\n \t\t});\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/dist/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 50);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 168360cec27c75ef536d","var base64 = require('base64-js');\r\nvar path = require('path');\r\n\r\nvar requestAnimationFrame = (typeof window != 'undefined') ? (window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame) : false;\r\n\r\n/**\r\n * creates a uri object\r\n * @param\t{string} urlString\ta url string (relative or absolute)\r\n * @param\t{[string]} baseString optional base for the url,\r\n * default to window.location.href\r\n * @return {object} url\r\n */\r\nfunction Url(urlString, baseString) {\r\n\tvar absolute = (urlString.indexOf('://') > -1);\r\n\tvar pathname = urlString;\r\n\r\n\tthis.Url = undefined;\r\n\tthis.href = urlString;\r\n\tthis.protocol = \"\";\r\n\tthis.origin = \"\";\r\n\tthis.fragment = \"\";\r\n\tthis.search = \"\";\r\n\tthis.base = baseString;\r\n\r\n\tif (!absolute && (typeof(baseString) !== \"string\")) {\r\n\t\tthis.base = window && window.location.href;\r\n\t}\r\n\r\n\t// URL Polyfill doesn't throw an error if base is empty\r\n\tif (absolute || this.base) {\r\n\t\ttry {\r\n\t\t\tthis.Url = new URL(urlString, this.base);\r\n\t\t\tthis.href = this.Url.href;\r\n\r\n\t\t\tthis.protocol = this.Url.protocol;\r\n\t\t\tthis.origin = this.Url.origin;\r\n\t\t\tthis.fragment = this.Url.fragment;\r\n\t\t\tthis.search = this.Url.search;\r\n\r\n\t\t\tpathname = this.Url.pathname;\r\n\t\t} catch (e) {\r\n\t\t\t// Skip URL parsing\r\n\t\t\tthis.Url = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\tthis.Path = new Path(pathname);\r\n\tthis.directory = this.Path.directory;\r\n\tthis.filename = this.Path.filename;\r\n\tthis.extension = this.Path.extension;\r\n\r\n}\r\n\r\nUrl.prototype.path = function () {\r\n\treturn this.Path;\r\n};\r\n\r\nUrl.prototype.resolve = function (what) {\r\n\tvar isAbsolute = (what.indexOf('://') > -1);\r\n\tvar fullpath;\r\n\r\n\tif (isAbsolute) {\r\n\t\treturn what;\r\n\t}\r\n\r\n\tfullpath = path.resolve(this.directory, what);\r\n\treturn this.origin + fullpath;\r\n};\r\n\r\nUrl.prototype.relative = function (what) {\r\n\treturn path.relative(what, this.directory);\r\n};\r\n\r\nUrl.prototype.toString = function () {\r\n\treturn this.href;\r\n};\r\n\r\nfunction Path(pathString) {\r\n\tvar protocol;\r\n\tvar parsed;\r\n\r\n\tprotocol = pathString.indexOf('://');\r\n\tif (protocol > -1) {\r\n\t\tpathString = new URL(pathString).pathname;\r\n\t}\r\n\r\n\tparsed = this.parse(pathString);\r\n\r\n\tthis.path = pathString;\r\n\r\n\tif (this.isDirectory(pathString)) {\r\n\t\tthis.directory = pathString;\r\n\t} else {\r\n\t\tthis.directory = parsed.dir + \"/\";\r\n\t}\r\n\r\n\tthis.filename = parsed.base;\r\n\tthis.extension = parsed.ext.slice(1);\r\n\r\n}\r\n\r\nPath.prototype.parse = function (what) {\r\n\treturn path.parse(what);\r\n};\r\n\r\nPath.prototype.isAbsolute = function (what) {\r\n\treturn path.isAbsolute(what || this.path);\r\n};\r\n\r\nPath.prototype.isDirectory = function (what) {\r\n\treturn (what.charAt(what.length-1) === '/');\r\n};\r\n\r\nPath.prototype.resolve = function (what) {\r\n\treturn path.resolve(this.directory, what);\r\n};\r\n\r\nPath.prototype.relative = function (what) {\r\n\treturn path.relative(this.directory, what);\r\n};\r\n\r\nPath.prototype.splitPath = function(filename) {\r\n\treturn this.splitPathRe.exec(filename).slice(1);\r\n};\r\n\r\nPath.prototype.toString = function () {\r\n\treturn this.path;\r\n};\r\n\r\nfunction assertPath(path) {\r\n\tif (typeof path !== 'string') {\r\n\t\tthrow new TypeError('Path must be a string. Received ', path);\r\n\t}\r\n};\r\n\r\nfunction isElement(obj) {\r\n\t\treturn !!(obj && obj.nodeType == 1);\r\n};\r\n\r\n// http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\r\nfunction uuid() {\r\n\tvar d = new Date().getTime();\r\n\tvar uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\r\n\t\t\tvar r = (d + Math.random()*16)%16 | 0;\r\n\t\t\td = Math.floor(d/16);\r\n\t\t\treturn (c=='x' ? r : (r&0x7|0x8)).toString(16);\r\n\t});\r\n\treturn uuid;\r\n};\r\n\r\n// From Lodash\r\nfunction values(object) {\r\n\tvar index = -1,\r\n\t\t\tprops = Object.keys(object),\r\n\t\t\tlength = props.length,\r\n\t\t\tresult = Array(length);\r\n\r\n\twhile (++index < length) {\r\n\t\tresult[index] = object[props[index]];\r\n\t}\r\n\treturn result;\r\n};\r\n\r\nfunction resolveUrl(base, path) {\r\n\tvar url = [],\r\n\t\tsegments = [],\r\n\t\tbaseUri = uri(base),\r\n\t\tpathUri = uri(path),\r\n\t\tbaseDirectory = baseUri.directory,\r\n\t\tpathDirectory = pathUri.directory,\r\n\t\tdirectories = [],\r\n\t\t// folders = base.split(\"/\"),\r\n\t\tpaths;\r\n\r\n\t// if(uri.host) {\r\n\t//\t return path;\r\n\t// }\r\n\r\n\tif(baseDirectory[0] === \"/\") {\r\n\t\tbaseDirectory = baseDirectory.substring(1);\r\n\t}\r\n\r\n\tif(pathDirectory[pathDirectory.length-1] === \"/\") {\r\n\t\tbaseDirectory = baseDirectory.substring(0, baseDirectory.length-1);\r\n\t}\r\n\r\n\tif(pathDirectory[0] === \"/\") {\r\n\t\tpathDirectory = pathDirectory.substring(1);\r\n\t}\r\n\r\n\tif(pathDirectory[pathDirectory.length-1] === \"/\") {\r\n\t\tpathDirectory = pathDirectory.substring(0, pathDirectory.length-1);\r\n\t}\r\n\r\n\tif(baseDirectory) {\r\n\t\tdirectories = baseDirectory.split(\"/\");\r\n\t}\r\n\r\n\tpaths = pathDirectory.split(\"/\");\r\n\r\n\tpaths.reverse().forEach(function(part, index){\r\n\t\tif(part === \"..\"){\r\n\t\t\tdirectories.pop();\r\n\t\t} else if(part === directories[directories.length-1]) {\r\n\t\t\tdirectories.pop();\r\n\t\t\tsegments.unshift(part);\r\n\t\t} else {\r\n\t\t\tsegments.unshift(part);\r\n\t\t}\r\n\t});\r\n\r\n\turl = [baseUri.origin];\r\n\r\n\tif(directories.length) {\r\n\t\turl = url.concat(directories);\r\n\t}\r\n\r\n\tif(segments) {\r\n\t\turl = url.concat(segments);\r\n\t}\r\n\r\n\turl = url.concat(pathUri.filename);\r\n\r\n\treturn url.join(\"/\");\r\n};\r\n\r\nfunction documentHeight() {\r\n\treturn Math.max(\r\n\t\t\tdocument.documentElement.clientHeight,\r\n\t\t\tdocument.body.scrollHeight,\r\n\t\t\tdocument.documentElement.scrollHeight,\r\n\t\t\tdocument.body.offsetHeight,\r\n\t\t\tdocument.documentElement.offsetHeight\r\n\t);\r\n};\r\n\r\nfunction isNumber(n) {\r\n\treturn !isNaN(parseFloat(n)) && isFinite(n);\r\n};\r\n\r\nfunction isFloat(n) {\r\n\treturn isNumber(n) && (Math.floor(n) !== n);\r\n}\r\n\r\nfunction prefixed(unprefixed) {\r\n\tvar vendors = [\"Webkit\", \"Moz\", \"O\", \"ms\" ],\r\n\t\tprefixes = ['-Webkit-', '-moz-', '-o-', '-ms-'],\r\n\t\tupper = unprefixed[0].toUpperCase() + unprefixed.slice(1),\r\n\t\tlength = vendors.length;\r\n\r\n\tif (typeof(document) === 'undefined' || typeof(document.body.style[unprefixed]) != 'undefined') {\r\n\t\treturn unprefixed;\r\n\t}\r\n\r\n\tfor ( var i=0; i < length; i++ ) {\r\n\t\tif (typeof(document.body.style[vendors[i] + upper]) != 'undefined') {\r\n\t\t\treturn vendors[i] + upper;\r\n\t\t}\r\n\t}\r\n\r\n\treturn unprefixed;\r\n};\r\n\r\nfunction defaults(obj) {\r\n\tfor (var i = 1, length = arguments.length; i < length; i++) {\r\n\t\tvar source = arguments[i];\r\n\t\tfor (var prop in source) {\r\n\t\t\tif (obj[prop] === void 0) obj[prop] = source[prop];\r\n\t\t}\r\n\t}\r\n\treturn obj;\r\n};\r\n\r\nfunction extend(target) {\r\n\t\tvar sources = [].slice.call(arguments, 1);\r\n\t\tsources.forEach(function (source) {\r\n\t\t\tif(!source) return;\r\n\t\t\tObject.getOwnPropertyNames(source).forEach(function(propName) {\r\n\t\t\t\tObject.defineProperty(target, propName, Object.getOwnPropertyDescriptor(source, propName));\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn target;\r\n};\r\n\r\n// Fast quicksort insert for sorted array -- based on:\r\n// http://stackoverflow.com/questions/1344500/efficient-way-to-insert-a-number-into-a-sorted-array-of-numbers\r\nfunction insert(item, array, compareFunction) {\r\n\tvar location = locationOf(item, array, compareFunction);\r\n\tarray.splice(location, 0, item);\r\n\r\n\treturn location;\r\n};\r\n// Returns where something would fit in\r\nfunction locationOf(item, array, compareFunction, _start, _end) {\r\n\tvar start = _start || 0;\r\n\tvar end = _end || array.length;\r\n\tvar pivot = parseInt(start + (end - start) / 2);\r\n\tvar compared;\r\n\tif(!compareFunction){\r\n\t\tcompareFunction = function(a, b) {\r\n\t\t\tif(a > b) return 1;\r\n\t\t\tif(a < b) return -1;\r\n\t\t\tif(a = b) return 0;\r\n\t\t};\r\n\t}\r\n\tif(end-start <= 0) {\r\n\t\treturn pivot;\r\n\t}\r\n\r\n\tcompared = compareFunction(array[pivot], item);\r\n\tif(end-start === 1) {\r\n\t\treturn compared > 0 ? pivot : pivot + 1;\r\n\t}\r\n\r\n\tif(compared === 0) {\r\n\t\treturn pivot;\r\n\t}\r\n\tif(compared === -1) {\r\n\t\treturn locationOf(item, array, compareFunction, pivot, end);\r\n\t} else{\r\n\t\treturn locationOf(item, array, compareFunction, start, pivot);\r\n\t}\r\n};\r\n// Returns -1 of mpt found\r\nfunction indexOfSorted(item, array, compareFunction, _start, _end) {\r\n\tvar start = _start || 0;\r\n\tvar end = _end || array.length;\r\n\tvar pivot = parseInt(start + (end - start) / 2);\r\n\tvar compared;\r\n\tif(!compareFunction){\r\n\t\tcompareFunction = function(a, b) {\r\n\t\t\tif(a > b) return 1;\r\n\t\t\tif(a < b) return -1;\r\n\t\t\tif(a = b) return 0;\r\n\t\t};\r\n\t}\r\n\tif(end-start <= 0) {\r\n\t\treturn -1; // Not found\r\n\t}\r\n\r\n\tcompared = compareFunction(array[pivot], item);\r\n\tif(end-start === 1) {\r\n\t\treturn compared === 0 ? pivot : -1;\r\n\t}\r\n\tif(compared === 0) {\r\n\t\treturn pivot; // Found\r\n\t}\r\n\tif(compared === -1) {\r\n\t\treturn indexOfSorted(item, array, compareFunction, pivot, end);\r\n\t} else{\r\n\t\treturn indexOfSorted(item, array, compareFunction, start, pivot);\r\n\t}\r\n};\r\n\r\nfunction bounds(el) {\r\n\r\n\tvar style = window.getComputedStyle(el);\r\n\tvar widthProps = [\"width\", \"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\r\n\tvar heightProps = [\"height\", \"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\r\n\r\n\tvar width = 0;\r\n\tvar height = 0;\r\n\r\n\twidthProps.forEach(function(prop){\r\n\t\twidth += parseFloat(style[prop]) || 0;\r\n\t});\r\n\r\n\theightProps.forEach(function(prop){\r\n\t\theight += parseFloat(style[prop]) || 0;\r\n\t});\r\n\r\n\treturn {\r\n\t\theight: height,\r\n\t\twidth: width\r\n\t};\r\n\r\n};\r\n\r\nfunction borders(el) {\r\n\r\n\tvar style = window.getComputedStyle(el);\r\n\tvar widthProps = [\"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\r\n\tvar heightProps = [\"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\r\n\r\n\tvar width = 0;\r\n\tvar height = 0;\r\n\r\n\twidthProps.forEach(function(prop){\r\n\t\twidth += parseFloat(style[prop]) || 0;\r\n\t});\r\n\r\n\theightProps.forEach(function(prop){\r\n\t\theight += parseFloat(style[prop]) || 0;\r\n\t});\r\n\r\n\treturn {\r\n\t\theight: height,\r\n\t\twidth: width\r\n\t};\r\n\r\n};\r\n\r\nfunction windowBounds() {\r\n\r\n\tvar width = window.innerWidth;\r\n\tvar height = window.innerHeight;\r\n\r\n\treturn {\r\n\t\ttop: 0,\r\n\t\tleft: 0,\r\n\t\tright: width,\r\n\t\tbottom: height,\r\n\t\twidth: width,\r\n\t\theight: height\r\n\t};\r\n\r\n};\r\n\r\n//https://stackoverflow.com/questions/13482352/xquery-looking-for-text-with-single-quote/13483496#13483496\r\nfunction cleanStringForXpath(str)\t{\r\n\t\tvar parts = str.match(/[^'\"]+|['\"]/g);\r\n\t\tparts = parts.map(function(part){\r\n\t\t\t\tif (part === \"'\")\t{\r\n\t\t\t\t\t\treturn '\\\"\\'\\\"'; // output \"'\"\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (part === '\"') {\r\n\t\t\t\t\t\treturn \"\\'\\\"\\'\"; // output '\"'\r\n\t\t\t\t}\r\n\t\t\t\treturn \"\\'\" + part + \"\\'\";\r\n\t\t});\r\n\t\treturn \"concat(\\'\\',\" + parts.join(\",\") + \")\";\r\n};\r\n\r\nfunction indexOfTextNode(textNode){\r\n\tvar parent = textNode.parentNode;\r\n\tvar children = parent.childNodes;\r\n\tvar sib;\r\n\tvar index = -1;\r\n\tfor (var i = 0; i < children.length; i++) {\r\n\t\tsib = children[i];\r\n\t\tif(sib.nodeType === Node.TEXT_NODE){\r\n\t\t\tindex++;\r\n\t\t}\r\n\t\tif(sib == textNode) break;\r\n\t}\r\n\r\n\treturn index;\r\n};\r\n\r\nfunction isXml(ext) {\r\n\treturn ['xml', 'opf', 'ncx'].indexOf(ext) > -1;\r\n}\r\n\r\nfunction createBlob(content, mime){\r\n\tvar blob = new Blob([content], {type : mime });\r\n\r\n\treturn blob;\r\n};\r\n\r\nfunction createBlobUrl(content, mime){\r\n\tvar _URL = window.URL || window.webkitURL || window.mozURL;\r\n\tvar tempUrl;\r\n\tvar blob = this.createBlob(content, mime);\r\n\r\n\ttempUrl = _URL.createObjectURL(blob);\r\n\r\n\treturn tempUrl;\r\n};\r\n\r\nfunction createBase64Url(content, mime){\r\n\tvar string;\r\n\tvar data;\r\n\tvar datauri;\r\n\r\n\tif (typeof(content) !== \"string\") {\r\n\t\t// Only handles strings\r\n\t\treturn;\r\n\t}\r\n\r\n\tdata = btoa(content);\r\n\r\n\tdatauri = \"data:\" + mime + \";base64,\" + data;\r\n\r\n\treturn datauri;\r\n};\r\n\r\nfunction type(obj){\r\n\treturn Object.prototype.toString.call(obj).slice(8, -1);\r\n}\r\n\r\nfunction parse(markup, mime, forceXMLDom) {\r\n\tvar doc;\r\n\r\n\tif (typeof DOMParser === \"undefined\" || forceXMLDom) {\r\n\t\tDOMParser = require('xmldom').DOMParser;\r\n\t}\r\n\r\n\r\n\tdoc = new DOMParser().parseFromString(markup, mime);\r\n\r\n\treturn doc;\r\n}\r\n\r\nfunction qs(el, sel) {\r\n\tvar elements;\r\n\tif (!el) {\r\n\t\tthrow new Error('No Element Provided');\r\n\t}\r\n\r\n\tif (typeof el.querySelector != \"undefined\") {\r\n\t\treturn el.querySelector(sel);\r\n\t} else {\r\n\t\telements = el.getElementsByTagName(sel);\r\n\t\tif (elements.length) {\r\n\t\t\treturn elements[0];\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction qsa(el, sel) {\r\n\r\n\tif (typeof el.querySelector != \"undefined\") {\r\n\t\treturn el.querySelectorAll(sel);\r\n\t} else {\r\n\t\treturn el.getElementsByTagName(sel);\r\n\t}\r\n}\r\n\r\nfunction qsp(el, sel, props) {\r\n\tvar q, filtered;\r\n\tif (typeof el.querySelector != \"undefined\") {\r\n\t\tsel += '[';\r\n\t\tfor (var prop in props) {\r\n\t\t\tsel += prop + \"='\" + props[prop] + \"'\";\r\n\t\t}\r\n\t\tsel += ']';\r\n\t\treturn el.querySelector(sel);\r\n\t} else {\r\n\t\tq = el.getElementsByTagName(sel);\r\n\t\tfiltered = Array.prototype.slice.call(q, 0).filter(function(el) {\r\n\t\t\tfor (var prop in props) {\r\n\t\t\t\tif(el.getAttribute(prop) === props[prop]){\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tif (filtered) {\r\n\t\t\treturn filtered[0];\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Sprint through all text nodes in a document\r\n * @param  {element} root element to start with\r\n * @param  {function} func function to run on each element\r\n */\r\nfunction sprint(root, func) {\r\n\tvar doc = root.ownerDocument || root;\r\n\tif (typeof(doc.createTreeWalker) !== \"undefined\") {\r\n\t\ttreeWalker(root, func, NodeFilter.SHOW_TEXT);\r\n\t} else {\r\n\t\twalk(root, function(node) {\r\n\t\t\tif (node && node.nodeType === 3) { // Node.TEXT_NODE\r\n\t\t\t\tfunc(node);\r\n\t\t\t}\r\n\t\t}, true);\r\n\t}\r\n}\r\n\r\nfunction treeWalker(root, func, filter) {\r\n\tvar treeWalker = document.createTreeWalker(root, filter, null, false);\r\n\twhile ((node = treeWalker.nextNode())) {\r\n\t\tfunc(node);\r\n\t}\r\n}\r\n\r\n// function walk(root, func, onlyText) {\r\n// \tvar node = root;\r\n//\r\n// \tif (node && !onlyText || node.nodeType === 3) { // Node.TEXT_NODE\r\n// \t\tfunc(node);\r\n// \t}\r\n// \tconsole.log(root);\r\n//\r\n// \tnode = node.firstChild;\r\n// \twhile(node) {\r\n// \t\twalk(node, func, onlyText);\r\n// \t\tnode = node.nextSibling;\r\n// \t}\r\n// }\r\n\r\n/**\r\n * @param callback return false for continue,true for break\r\n * @return boolean true: break visit;\r\n */\r\nfunction walk(node,callback){\r\n\tif(callback(node)){\r\n\t\treturn true;\r\n\t}\r\n\tif(node = node.firstChild){\r\n\t\tdo{\r\n\t\t\tif(walk(node,callback)){return true}\r\n\t\t}while(node=node.nextSibling)\r\n\t}\r\n}\r\n\r\nfunction blob2base64(blob, cb) {\r\n\tvar reader = new FileReader();\r\n\treader.readAsDataURL(blob);\r\n\treader.onloadend = function() {\r\n\t\tcb(reader.result);\r\n\t}\r\n}\r\n\r\n// From: https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Promise.jsm/Deferred#backwards_forwards_compatible\r\nfunction defer() {\r\n\t/* A method to resolve the associated Promise with the value passed.\r\n\t * If the promise is already settled it does nothing.\r\n\t *\r\n\t * @param {anything} value : This value is used to resolve the promise\r\n\t * If the value is a Promise then the associated promise assumes the state\r\n\t * of Promise passed as value.\r\n\t */\r\n\tthis.resolve = null;\r\n\r\n\t/* A method to reject the assocaited Promise with the value passed.\r\n\t * If the promise is already settled it does nothing.\r\n\t *\r\n\t * @param {anything} reason: The reason for the rejection of the Promise.\r\n\t * Generally its an Error object. If however a Promise is passed, then the Promise\r\n\t * itself will be the reason for rejection no matter the state of the Promise.\r\n\t */\r\n\tthis.reject = null;\r\n\r\n\tthis.id = uuid();\r\n\r\n\t/* A newly created Pomise object.\r\n\t * Initially in pending state.\r\n\t */\r\n\tthis.promise = new Promise(function(resolve, reject) {\r\n\t\tthis.resolve = resolve;\r\n\t\tthis.reject = reject;\r\n\t}.bind(this));\r\n\tObject.freeze(this);\r\n}\r\n\r\n function querySelectorByType(html, element, type){\r\n\tvar query;\r\n\tif (typeof html.querySelector != \"undefined\") {\r\n\t\tquery = html.querySelector(element+'[*|type=\"'+type+'\"]');\r\n\t}\r\n\t// Handle IE not supporting namespaced epub:type in querySelector\r\n\tif(!query || query.length === 0) {\r\n\t\tquery = this.qsa(html, element);\r\n\t\tfor (var i = 0; i < query.length; i++) {\r\n\t\t\tif(query[i].getAttributeNS(\"http://www.idpf.org/2007/ops\", \"type\") === type) {\r\n\t\t\t\treturn query[i];\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\treturn query;\r\n\t}\r\n}\r\n\r\nfunction children(el) {\r\n\tvar children = [];\r\n\tvar childNodes = el.parentNode.childNodes;\r\n\tfor (var i = 0; i < childNodes.length; i++) {\r\n\t\tnode = childNodes[i];\r\n\t\tif (node.nodeType === 1) {\r\n\t\t\tchildren.push(node);\r\n\t\t}\r\n\t};\r\n\treturn children;\r\n}\r\n\r\nmodule.exports = {\r\n\t'isElement': isElement,\r\n\t'uuid': uuid,\r\n\t'values': values,\r\n\t'resolveUrl': resolveUrl,\r\n\t'indexOfSorted': indexOfSorted,\r\n\t'documentHeight': documentHeight,\r\n\t'isNumber': isNumber,\r\n\t'isFloat': isFloat,\r\n\t'prefixed': prefixed,\r\n\t'defaults': defaults,\r\n\t'extend': extend,\r\n\t'insert': insert,\r\n\t'locationOf': locationOf,\r\n\t'indexOfSorted': indexOfSorted,\r\n\t'requestAnimationFrame': requestAnimationFrame,\r\n\t'bounds': bounds,\r\n\t'borders': borders,\r\n\t'windowBounds': windowBounds,\r\n\t'cleanStringForXpath': cleanStringForXpath,\r\n\t'indexOfTextNode': indexOfTextNode,\r\n\t'isXml': isXml,\r\n\t'createBlob': createBlob,\r\n\t'createBlobUrl': createBlobUrl,\r\n\t'type': type,\r\n\t'parse' : parse,\r\n\t'qs' : qs,\r\n\t'qsa' : qsa,\r\n\t'qsp' : qsp,\r\n\t'blob2base64' : blob2base64,\r\n\t'createBase64Url': createBase64Url,\r\n\t'defer': defer,\r\n\t'Url': Url,\r\n\t'Path': Path,\r\n\t'querySelectorByType': querySelectorByType,\r\n\t'sprint' : sprint,\r\n\t'children' : children\r\n};\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/core.js\n// module id = 0\n// module chunks = 0","var core = require('./core');\r\n\r\n/**\r\n\tEPUB CFI spec: http://www.idpf.org/epub/linking/cfi/epub-cfi.html\r\n\r\n\tImplements:\r\n\t- Character Offset: epubcfi(/6/4[chap01ref]!/4[body01]/10[para05]/2/1:3)\r\n\t- Simple Ranges : epubcfi(/6/4[chap01ref]!/4[body01]/10[para05],/2/1:1,/3:4)\r\n\r\n\tDoes Not Implement:\r\n\t- Temporal Offset (~)\r\n\t- Spatial Offset (@)\r\n\t- Temporal-Spatial Offset (~ + @)\r\n\t- Text Location Assertion ([)\r\n*/\r\n\r\nvar ELEMENT_NODE = 1;\r\nvar TEXT_NODE = 3;\r\nvar COMMENT_NODE = 8;\r\nvar DOCUMENT_NODE = 9;\r\n\r\nfunction EpubCFI(cfiFrom, base, ignoreClass){\r\n\tvar type;\r\n\r\n\tthis.str = '';\r\n\r\n\tthis.base = {};\r\n\tthis.spinePos = 0; // For compatibility\r\n\r\n\tthis.range = false; // true || false;\r\n\r\n\tthis.path = {};\r\n\tthis.start = null;\r\n\tthis.end = null;\r\n\r\n\t// Allow instantiation without the 'new' keyword\r\n\tif (!(this instanceof EpubCFI)) {\r\n\t\treturn new EpubCFI(cfiFrom, base, ignoreClass);\r\n\t}\r\n\r\n\tif(typeof base === 'string') {\r\n\t\tthis.base = this.parseComponent(base);\r\n\t} else if(typeof base === 'object' && base.steps) {\r\n\t\tthis.base = base;\r\n\t}\r\n\r\n\ttype = this.checkType(cfiFrom);\r\n\r\n\r\n\tif(type === 'string') {\r\n\t\tthis.str = cfiFrom;\r\n\t\treturn core.extend(this, this.parse(cfiFrom));\r\n\t} else if (type === 'range') {\r\n\t\treturn core.extend(this, this.fromRange(cfiFrom, this.base, ignoreClass));\r\n\t} else if (type === 'node') {\r\n\t\treturn core.extend(this, this.fromNode(cfiFrom, this.base, ignoreClass));\r\n\t} else if (type === 'EpubCFI' && cfiFrom.path) {\r\n\t\treturn cfiFrom;\r\n\t} else if (!cfiFrom) {\r\n\t\treturn this;\r\n\t} else {\r\n\t\tthrow new TypeError('not a valid argument for EpubCFI');\r\n\t}\r\n\r\n};\r\n\r\nEpubCFI.prototype.checkType = function(cfi) {\r\n\r\n\tif (this.isCfiString(cfi)) {\r\n\t\treturn 'string';\r\n\t// Is a range object\r\n\t} else if (typeof cfi === 'object' && (core.type(cfi) === \"Range\" || typeof(cfi.startContainer) != \"undefined\")){\r\n\t\treturn 'range';\r\n\t} else if (typeof cfi === 'object' && typeof(cfi.nodeType) != \"undefined\" ){ // || typeof cfi === 'function'\r\n\t\treturn 'node';\r\n\t} else if (typeof cfi === 'object' && cfi instanceof EpubCFI){\r\n\t\treturn 'EpubCFI';\r\n\t} else {\r\n\t\treturn false;\r\n\t}\r\n};\r\n\r\nEpubCFI.prototype.parse = function(cfiStr) {\r\n\tvar cfi = {\r\n\t\t\tspinePos: -1,\r\n\t\t\trange: false,\r\n\t\t\tbase: {},\r\n\t\t\tpath: {},\r\n\t\t\tstart: null,\r\n\t\t\tend: null\r\n\t\t};\r\n\tvar baseComponent, pathComponent, range;\r\n\r\n\tif(typeof cfiStr !== \"string\") {\r\n\t\treturn {spinePos: -1};\r\n\t}\r\n\r\n\tif(cfiStr.indexOf(\"epubcfi(\") === 0 && cfiStr[cfiStr.length-1] === \")\") {\r\n\t\t// Remove intial epubcfi( and ending )\r\n\t\tcfiStr = cfiStr.slice(8, cfiStr.length-1);\r\n\t}\r\n\r\n\tbaseComponent = this.getChapterComponent(cfiStr);\r\n\r\n\t// Make sure this is a valid cfi or return\r\n\tif(!baseComponent) {\r\n\t\treturn {spinePos: -1};\r\n\t}\r\n\r\n\tcfi.base = this.parseComponent(baseComponent);\r\n\r\n\tpathComponent = this.getPathComponent(cfiStr);\r\n\tcfi.path = this.parseComponent(pathComponent);\r\n\r\n\trange = this.getRange(cfiStr);\r\n\r\n\tif(range) {\r\n\t\tcfi.range = true;\r\n\t\tcfi.start = this.parseComponent(range[0]);\r\n\t\tcfi.end = this.parseComponent(range[1]);\r\n\t}\r\n\r\n\t// Get spine node position\r\n\t// cfi.spineSegment = cfi.base.steps[1];\r\n\r\n\t// Chapter segment is always the second step\r\n\tcfi.spinePos = cfi.base.steps[1].index;\r\n\r\n\treturn cfi;\r\n};\r\n\r\nEpubCFI.prototype.parseComponent = function(componentStr){\r\n\tvar component = {\r\n\t\tsteps: [],\r\n\t\tterminal: {\r\n\t\t\toffset: null,\r\n\t\t\tassertion: null\r\n\t\t}\r\n\t};\r\n\tvar parts = componentStr.split(':');\r\n\tvar steps = parts[0].split('/');\r\n\tvar terminal;\r\n\r\n\tif(parts.length > 1) {\r\n\t\tterminal = parts[1];\r\n\t\tcomponent.terminal = this.parseTerminal(terminal);\r\n\t}\r\n\r\n\tif (steps[0] === '') {\r\n\t\tsteps.shift(); // Ignore the first slash\r\n\t}\r\n\r\n\tcomponent.steps = steps.map(function(step){\r\n\t\treturn this.parseStep(step);\r\n\t}.bind(this));\r\n\r\n\treturn component;\r\n};\r\n\r\nEpubCFI.prototype.parseStep = function(stepStr){\r\n\tvar type, num, index, has_brackets, id;\r\n\r\n\thas_brackets = stepStr.match(/\\[(.*)\\]/);\r\n\tif(has_brackets && has_brackets[1]){\r\n\t\tid = has_brackets[1];\r\n\t}\r\n\r\n\t//-- Check if step is a text node or element\r\n\tnum = parseInt(stepStr);\r\n\r\n\tif(isNaN(num)) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif(num % 2 === 0) { // Even = is an element\r\n\t\ttype = \"element\";\r\n\t\tindex = num / 2 - 1;\r\n\t} else {\r\n\t\ttype = \"text\";\r\n\t\tindex = (num - 1 ) / 2;\r\n\t}\r\n\r\n\treturn {\r\n\t\t\"type\" : type,\r\n\t\t'index' : index,\r\n\t\t'id' : id || null\r\n\t};\r\n};\r\n\r\nEpubCFI.prototype.parseTerminal = function(termialStr){\r\n\tvar characterOffset, textLocationAssertion;\r\n\tvar assertion = termialStr.match(/\\[(.*)\\]/);\r\n\r\n\tif(assertion && assertion[1]){\r\n\t\tcharacterOffset = parseInt(termialStr.split('[')[0]) || null;\r\n\t\ttextLocationAssertion = assertion[1];\r\n\t} else {\r\n\t\tcharacterOffset = parseInt(termialStr) || null;\r\n\t}\r\n\r\n\treturn {\r\n\t\t'offset': characterOffset,\r\n\t\t'assertion': textLocationAssertion\r\n\t};\r\n\r\n};\r\n\r\nEpubCFI.prototype.getChapterComponent = function(cfiStr) {\r\n\r\n\tvar indirection = cfiStr.split(\"!\");\r\n\r\n\treturn indirection[0];\r\n};\r\n\r\nEpubCFI.prototype.getPathComponent = function(cfiStr) {\r\n\r\n\tvar indirection = cfiStr.split(\"!\");\r\n\r\n\tif(indirection[1]) {\r\n\t\tranges = indirection[1].split(',');\r\n\t\treturn ranges[0];\r\n\t}\r\n\r\n};\r\n\r\nEpubCFI.prototype.getRange = function(cfiStr) {\r\n\r\n\tvar ranges = cfiStr.split(\",\");\r\n\r\n\tif(ranges.length === 3){\r\n\t\treturn [\r\n\t\t\tranges[1],\r\n\t\t\tranges[2]\r\n\t\t];\r\n\t}\r\n\r\n\treturn false;\r\n};\r\n\r\nEpubCFI.prototype.getCharecterOffsetComponent = function(cfiStr) {\r\n\tvar splitStr = cfiStr.split(\":\");\r\n\treturn splitStr[1] || '';\r\n};\r\n\r\nEpubCFI.prototype.joinSteps = function(steps) {\r\n\tif(!steps) {\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\treturn steps.map(function(part){\r\n\t\tvar segment = '';\r\n\r\n\t\tif(part.type === 'element') {\r\n\t\t\tsegment += (part.index + 1) * 2;\r\n\t\t}\r\n\r\n\t\tif(part.type === 'text') {\r\n\t\t\tsegment += 1 + (2 * part.index); // TODO: double check that this is odd\r\n\t\t}\r\n\r\n\t\tif(part.id) {\r\n\t\t\tsegment += \"[\" + part.id + \"]\";\r\n\t\t}\r\n\r\n\t\treturn segment;\r\n\r\n\t}).join('/');\r\n\r\n};\r\n\r\nEpubCFI.prototype.segmentString = function(segment) {\r\n\tvar segmentString = '/';\r\n\r\n\tsegmentString += this.joinSteps(segment.steps);\r\n\r\n\tif(segment.terminal && segment.terminal.offset != null){\r\n\t\tsegmentString += ':' + segment.terminal.offset;\r\n\t}\r\n\r\n\tif(segment.terminal && segment.terminal.assertion != null){\r\n\t\tsegmentString += '[' + segment.terminal.assertion + ']';\r\n\t}\r\n\r\n\treturn segmentString;\r\n};\r\n\r\nEpubCFI.prototype.toString = function() {\r\n\tvar cfiString = 'epubcfi(';\r\n\r\n\tcfiString += this.segmentString(this.base);\r\n\r\n\tcfiString += '!';\r\n\tcfiString += this.segmentString(this.path);\r\n\r\n\t// Add Range, if present\r\n\tif(this.start) {\r\n\t\tcfiString += ',';\r\n\t\tcfiString += this.segmentString(this.start);\r\n\t}\r\n\r\n\tif(this.end) {\r\n\t\tcfiString += ',';\r\n\t\tcfiString += this.segmentString(this.end);\r\n\t}\r\n\r\n\tcfiString += \")\";\r\n\r\n\treturn cfiString;\r\n};\r\n\r\nEpubCFI.prototype.compare = function(cfiOne, cfiTwo) {\r\n\tvar stepsA, stepsB;\r\n\tvar terminalA, terminalB;\r\n\r\n\tif(typeof cfiOne === 'string') {\r\n\t\tcfiOne = new EpubCFI(cfiOne);\r\n\t}\r\n\tif(typeof cfiTwo === 'string') {\r\n\t\tcfiTwo = new EpubCFI(cfiTwo);\r\n\t}\r\n\t// Compare Spine Positions\r\n\tif(cfiOne.spinePos > cfiTwo.spinePos) {\r\n\t\treturn 1;\r\n\t}\r\n\tif(cfiOne.spinePos < cfiTwo.spinePos) {\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tif (cfiOne.range) {\r\n\t\tstepsA = cfiOne.path.steps.concat(cfiOne.start.steps);\r\n\t\tterminalA = cfiOne.start.terminal;\r\n\t} else {\r\n\t\tstepsA = cfiOne.path.steps;\r\n\t\tterminalA = cfiOne.path.terminal;\r\n\t}\r\n\r\n\tif (cfiTwo.range) {\r\n\t\tstepsB = cfiTwo.path.steps.concat(cfiTwo.start.steps);\r\n\t\tterminalB = cfiTwo.start.terminal;\r\n\t} else {\r\n\t\tstepsB = cfiTwo.path.steps;\r\n\t\tterminalB = cfiTwo.path.terminal;\r\n\t}\r\n\r\n\t// Compare Each Step in the First item\r\n\tfor (var i = 0; i < stepsA.length; i++) {\r\n\t\tif(!stepsA[i]) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\tif(!stepsB[i]) {\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\tif(stepsA[i].index > stepsB[i].index) {\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\tif(stepsA[i].index < stepsB[i].index) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\t// Otherwise continue checking\r\n\t}\r\n\r\n\t// All steps in First equal to Second and First is Less Specific\r\n\tif(stepsA.length < stepsB.length) {\r\n\t\treturn 1;\r\n\t}\r\n\r\n\t// Compare the charecter offset of the text node\r\n\tif(terminalA.offset > terminalB.offset) {\r\n\t\treturn 1;\r\n\t}\r\n\tif(terminalA.offset < terminalB.offset) {\r\n\t\treturn -1;\r\n\t}\r\n\r\n\t// CFI's are equal\r\n\treturn 0;\r\n};\r\n\r\nEpubCFI.prototype.step = function(node) {\r\n\tvar nodeType = (node.nodeType === TEXT_NODE) ? 'text' : 'element';\r\n\r\n\treturn {\r\n\t\t'id' : node.id,\r\n\t\t'tagName' : node.tagName,\r\n\t\t'type' : nodeType,\r\n\t\t'index' : this.position(node)\r\n\t};\r\n};\r\n\r\nEpubCFI.prototype.filteredStep = function(node, ignoreClass) {\r\n\tvar filteredNode = this.filter(node, ignoreClass);\r\n\tvar nodeType;\r\n\r\n\t// Node filtered, so ignore\r\n\tif (!filteredNode) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Otherwise add the filter node in\r\n\tnodeType = (filteredNode.nodeType === TEXT_NODE) ? 'text' : 'element';\r\n\r\n\treturn {\r\n\t\t'id' : filteredNode.id,\r\n\t\t'tagName' : filteredNode.tagName,\r\n\t\t'type' : nodeType,\r\n\t\t'index' : this.filteredPosition(filteredNode, ignoreClass)\r\n\t};\r\n};\r\n\r\nEpubCFI.prototype.pathTo = function(node, offset, ignoreClass) {\r\n\tvar segment = {\r\n\t\tsteps: [],\r\n\t\tterminal: {\r\n\t\t\toffset: null,\r\n\t\t\tassertion: null\r\n\t\t}\r\n\t};\r\n\tvar currentNode = node;\r\n\tvar step;\r\n\r\n\twhile(currentNode && currentNode.parentNode &&\r\n\t\t\t\tcurrentNode.parentNode.nodeType != DOCUMENT_NODE) {\r\n\r\n\t\tif (ignoreClass) {\r\n\t\t\tstep = this.filteredStep(currentNode, ignoreClass);\r\n\t\t} else {\r\n\t\t\tstep = this.step(currentNode);\r\n\t\t}\r\n\r\n\t\tif (step) {\r\n\t\t\tsegment.steps.unshift(step);\r\n\t\t}\r\n\r\n\t\tcurrentNode = currentNode.parentNode;\r\n\r\n\t}\r\n\r\n\tif (offset != null && offset >= 0) {\r\n\r\n\t\tsegment.terminal.offset = offset;\r\n\r\n\t\t// Make sure we are getting to a textNode if there is an offset\r\n\t\tif(segment.steps[segment.steps.length-1].type != \"text\") {\r\n\t\t\tsegment.steps.push({\r\n\t\t\t\t'type' : \"text\",\r\n\t\t\t\t'index' : 0\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\treturn segment;\r\n}\r\n\r\nEpubCFI.prototype.equalStep = function(stepA, stepB) {\r\n\tif (!stepA || !stepB) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif(stepA.index === stepB.index &&\r\n\t\t stepA.id === stepB.id &&\r\n\t\t stepA.type === stepB.type) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n};\r\n\r\nEpubCFI.prototype.fromRange = function(range, base, ignoreClass) {\r\n\tvar cfi = {\r\n\t\t\trange: false,\r\n\t\t\tbase: {},\r\n\t\t\tpath: {},\r\n\t\t\tstart: null,\r\n\t\t\tend: null\r\n\t\t};\r\n\r\n\tvar start = range.startContainer;\r\n\tvar end = range.endContainer;\r\n\r\n\tvar startOffset = range.startOffset;\r\n\tvar endOffset = range.endOffset;\r\n\r\n\tvar needsIgnoring = false;\r\n\r\n\tif (ignoreClass) {\r\n\t\t// Tell pathTo if / what to ignore\r\n\t\tneedsIgnoring = (start.ownerDocument.querySelector('.' + ignoreClass) != null);\r\n\t}\r\n\r\n\r\n\tif (typeof base === 'string') {\r\n\t\tcfi.base = this.parseComponent(base);\r\n\t\tcfi.spinePos = cfi.base.steps[1].index;\r\n\t} else if (typeof base === 'object') {\r\n\t\tcfi.base = base;\r\n\t}\r\n\r\n\tif (range.collapsed) {\r\n\t\tif (needsIgnoring) {\r\n\t\t\tstartOffset = this.patchOffset(start, startOffset, ignoreClass);\r\n\t\t}\r\n\t\tcfi.path = this.pathTo(start, startOffset, ignoreClass);\r\n\t} else {\r\n\t\tcfi.range = true;\r\n\r\n\t\tif (needsIgnoring) {\r\n\t\t\tstartOffset = this.patchOffset(start, startOffset, ignoreClass);\r\n\t\t}\r\n\r\n\t\tcfi.start = this.pathTo(start, startOffset, ignoreClass);\r\n\t\tif (needsIgnoring) {\r\n\t\t\tendOffset = this.patchOffset(end, endOffset, ignoreClass);\r\n\t\t}\r\n\r\n\t\tcfi.end = this.pathTo(end, endOffset, ignoreClass);\r\n\r\n\t\t// Create a new empty path\r\n\t\tcfi.path = {\r\n\t\t\tsteps: [],\r\n\t\t\tterminal: null\r\n\t\t};\r\n\r\n\t\t// Push steps that are shared between start and end to the common path\r\n\t\tvar len = cfi.start.steps.length;\r\n\t\tvar i;\r\n\r\n\t\tfor (i = 0; i < len; i++) {\r\n\t\t\tif (this.equalStep(cfi.start.steps[i], cfi.end.steps[i])) {\r\n\t\t\t\tif(i === len-1) {\r\n\t\t\t\t\t// Last step is equal, check terminals\r\n\t\t\t\t\tif(cfi.start.terminal === cfi.end.terminal) {\r\n\t\t\t\t\t\t// CFI's are equal\r\n\t\t\t\t\t\tcfi.path.steps.push(cfi.start.steps[i]);\r\n\t\t\t\t\t\t// Not a range\r\n\t\t\t\t\t\tcfi.range = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcfi.path.steps.push(cfi.start.steps[i]);\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tcfi.start.steps = cfi.start.steps.slice(cfi.path.steps.length);\r\n\t\tcfi.end.steps = cfi.end.steps.slice(cfi.path.steps.length);\r\n\r\n\t\t// TODO: Add Sanity check to make sure that the end if greater than the start\r\n\t}\r\n\r\n\treturn cfi;\r\n}\r\n\r\nEpubCFI.prototype.fromNode = function(anchor, base, ignoreClass) {\r\n\tvar cfi = {\r\n\t\t\trange: false,\r\n\t\t\tbase: {},\r\n\t\t\tpath: {},\r\n\t\t\tstart: null,\r\n\t\t\tend: null\r\n\t\t};\r\n\r\n\tvar needsIgnoring = false;\r\n\r\n\tif (ignoreClass) {\r\n\t\t// Tell pathTo if / what to ignore\r\n\t\tneedsIgnoring = (anchor.ownerDocument.querySelector('.' + ignoreClass) != null);\r\n\t}\r\n\r\n\tif (typeof base === 'string') {\r\n\t\tcfi.base = this.parseComponent(base);\r\n\t\tcfi.spinePos = cfi.base.steps[1].index;\r\n\t} else if (typeof base === 'object') {\r\n\t\tcfi.base = base;\r\n\t}\r\n\r\n\tcfi.path = this.pathTo(anchor, null, ignoreClass);\r\n\r\n\treturn cfi;\r\n};\r\n\r\nEpubCFI.prototype.filter = function(anchor, ignoreClass) {\r\n\tvar needsIgnoring;\r\n\tvar sibling; // to join with\r\n\tvar parent, prevSibling, nextSibling;\r\n\tvar isText = false;\r\n\r\n\tif (anchor.nodeType === TEXT_NODE) {\r\n\t\tisText = true;\r\n\t\tparent = anchor.parentNode;\r\n\t\tneedsIgnoring = anchor.parentNode.classList.contains(ignoreClass);\r\n\t} else {\r\n\t\tisText = false;\r\n\t\tneedsIgnoring = anchor.classList.contains(ignoreClass);\r\n\t}\r\n\r\n\tif (needsIgnoring && isText) {\r\n\t\tpreviousSibling = parent.previousSibling;\r\n\t\tnextSibling = parent.nextSibling;\r\n\r\n\t\t// If the sibling is a text node, join the nodes\r\n\t\tif (previousSibling && previousSibling.nodeType === TEXT_NODE) {\r\n\t\t\tsibling = previousSibling;\r\n\t\t} else if (nextSibling && nextSibling.nodeType === TEXT_NODE) {\r\n\t\t\tsibling = nextSibling;\r\n\t\t}\r\n\r\n\t\tif (sibling) {\r\n\t\t\treturn sibling;\r\n\t\t} else {\r\n\t\t\t// Parent will be ignored on next step\r\n\t\t\treturn anchor;\r\n\t\t}\r\n\r\n\t} else if (needsIgnoring && !isText) {\r\n\t\t// Otherwise just skip the element node\r\n\t\treturn false;\r\n\t} else {\r\n\t\t// No need to filter\r\n\t\treturn anchor;\r\n\t}\r\n\r\n};\r\n\r\nEpubCFI.prototype.patchOffset = function(anchor, offset, ignoreClass) {\r\n\tvar needsIgnoring;\r\n\tvar sibling;\r\n\r\n\tif (anchor.nodeType != TEXT_NODE) {\r\n\t\tconsole.error(\"Anchor must be a text node\");\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar curr = anchor;\r\n\tvar totalOffset = offset;\r\n\r\n\t// If the parent is a ignored node, get offset from it's start\r\n\tif (anchor.parentNode.classList.contains(ignoreClass)) {\r\n\t\tcurr = anchor.parentNode;\r\n\t}\r\n\r\n\twhile (curr.previousSibling) {\r\n\t\tif(curr.previousSibling.nodeType === ELEMENT_NODE) {\r\n\t\t\t// Originally a text node, so join\r\n\t\t\tif(curr.previousSibling.classList.contains(ignoreClass)){\r\n\t\t\t\ttotalOffset += curr.previousSibling.textContent.length;\r\n\t\t\t} else {\r\n\t\t\t\tbreak; // Normal node, dont join\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// If the previous sibling is a text node, join the nodes\r\n\t\t\ttotalOffset += curr.previousSibling.textContent.length;\r\n\t\t}\r\n\r\n\t\tcurr = curr.previousSibling;\r\n\t}\r\n\r\n\treturn totalOffset;\r\n\r\n};\r\n\r\nEpubCFI.prototype.normalizedMap = function(children, nodeType, ignoreClass) {\r\n\tvar output = {};\r\n\tvar prevIndex = -1;\r\n\tvar i, len = children.length;\r\n\tvar currNodeType;\r\n\tvar prevNodeType;\r\n\r\n\tfor (i = 0; i < len; i++) {\r\n\r\n\t\tcurrNodeType = children[i].nodeType;\r\n\r\n\t\t// Check if needs ignoring\r\n\t\tif (currNodeType === ELEMENT_NODE &&\r\n\t\t\t\tchildren[i].classList.contains(ignoreClass)) {\r\n\t\t\tcurrNodeType = TEXT_NODE;\r\n\t\t}\r\n\r\n\t\tif (i > 0 &&\r\n\t\t\t\tcurrNodeType === TEXT_NODE &&\r\n\t\t\t\tprevNodeType === TEXT_NODE) {\r\n\t\t\t// join text nodes\r\n\t\t\toutput[i] = prevIndex;\r\n\t\t} else if (nodeType === currNodeType){\r\n\t\t\tprevIndex = prevIndex + 1;\r\n\t\t\toutput[i] = prevIndex;\r\n\t\t}\r\n\r\n\t\tprevNodeType = currNodeType;\r\n\r\n\t}\r\n\r\n\treturn output;\r\n};\r\n\r\nEpubCFI.prototype.position = function(anchor) {\r\n\tvar children, index, map;\r\n\tvar childNodes, node;\r\n\tif (anchor.nodeType === ELEMENT_NODE) {\r\n\t\tchildren = anchor.parentNode.children;\r\n\t\tif (!children) {\r\n\t\t\tchildren = core.children(anchor.parentNode);\r\n\t\t}\r\n\t\tindex = Array.prototype.indexOf.call(children, anchor);\r\n\t} else {\r\n\t\tchildren = this.textNodes(anchor.parentNode);\r\n\t\tindex = children.indexOf(anchor);\r\n\t}\r\n\r\n\treturn index;\r\n};\r\n\r\nEpubCFI.prototype.filteredPosition = function(anchor, ignoreClass) {\r\n\tvar children, index, map;\r\n\r\n\tif (anchor.nodeType === ELEMENT_NODE) {\r\n\t\tchildren = anchor.parentNode.children;\r\n\t\tmap = this.normalizedMap(children, ELEMENT_NODE, ignoreClass);\r\n\t} else {\r\n\t\tchildren = anchor.parentNode.childNodes;\r\n\t\t// Inside an ignored node\r\n\t\tif(anchor.parentNode.classList.contains(ignoreClass)) {\r\n\t\t\tanchor = anchor.parentNode;\r\n\t\t\tchildren = anchor.parentNode.childNodes;\r\n\t\t}\r\n\t\tmap = this.normalizedMap(children, TEXT_NODE, ignoreClass);\r\n\t}\r\n\r\n\r\n\tindex = Array.prototype.indexOf.call(children, anchor);\r\n\r\n\treturn map[index];\r\n};\r\n\r\nEpubCFI.prototype.stepsToXpath = function(steps) {\r\n\tvar xpath = [\".\", \"*\"];\r\n\r\n\tsteps.forEach(function(step){\r\n\t\tvar position = step.index + 1;\r\n\r\n\t\tif(step.id){\r\n\t\t\txpath.push(\"*[position()=\" + position + \" and @id='\" + step.id + \"']\");\r\n\t\t} else if(step.type === \"text\") {\r\n\t\t\txpath.push(\"text()[\" + position + \"]\");\r\n\t\t} else {\r\n\t\t\txpath.push(\"*[\" + position + \"]\");\r\n\t\t}\r\n\t});\r\n\r\n\treturn xpath.join(\"/\");\r\n};\r\n\r\n\r\n/*\r\n\r\nTo get the last step if needed:\r\n\r\n// Get the terminal step\r\nlastStep = steps[steps.length-1];\r\n// Get the query string\r\nquery = this.stepsToQuery(steps);\r\n// Find the containing element\r\nstartContainerParent = doc.querySelector(query);\r\n// Find the text node within that element\r\nif(startContainerParent && lastStep.type == \"text\") {\r\n\tcontainer = startContainerParent.childNodes[lastStep.index];\r\n}\r\n*/\r\nEpubCFI.prototype.stepsToQuerySelector = function(steps) {\r\n\tvar query = [\"html\"];\r\n\r\n\tsteps.forEach(function(step){\r\n\t\tvar position = step.index + 1;\r\n\r\n\t\tif(step.id){\r\n\t\t\tquery.push(\"#\" + step.id);\r\n\t\t} else if(step.type === \"text\") {\r\n\t\t\t// unsupported in querySelector\r\n\t\t\t// query.push(\"text()[\" + position + \"]\");\r\n\t\t} else {\r\n\t\t\tquery.push(\"*:nth-child(\" + position + \")\");\r\n\t\t}\r\n\t});\r\n\r\n\treturn query.join(\">\");\r\n\r\n};\r\n\r\nEpubCFI.prototype.textNodes = function(container, ignoreClass) {\r\n\treturn Array.prototype.slice.call(container.childNodes).\r\n\t\tfilter(function (node) {\r\n\t\t\tif (node.nodeType === TEXT_NODE) {\r\n\t\t\t\treturn true;\r\n\t\t\t} else if (ignoreClass && node.classList.contains(ignoreClass)) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t});\r\n};\r\n\r\nEpubCFI.prototype.walkToNode = function(steps, _doc, ignoreClass) {\r\n\tvar doc = _doc || document;\r\n\tvar container = doc.documentElement;\r\n\tvar step;\r\n\tvar len = steps.length;\r\n\tvar i;\r\n\r\n\tfor (i = 0; i < len; i++) {\r\n\t\tstep = steps[i];\r\n\r\n\t\tif(step.type === \"element\") {\r\n\t\t\tcontainer = container.children[step.index];\r\n\t\t} else if(step.type === \"text\"){\r\n\t\t\tcontainer = this.textNodes(container, ignoreClass)[step.index];\r\n\t\t}\r\n\r\n\t};\r\n\r\n\treturn container;\r\n};\r\n\r\nEpubCFI.prototype.findNode = function(steps, _doc, ignoreClass) {\r\n\tvar doc = _doc || document;\r\n\tvar container;\r\n\tvar xpath;\r\n\r\n\tif(!ignoreClass && typeof doc.evaluate != 'undefined') {\r\n\t\txpath = this.stepsToXpath(steps);\r\n\t\tcontainer = doc.evaluate(xpath, doc, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;\r\n\t} else if(ignoreClass) {\r\n\t\tcontainer = this.walkToNode(steps, doc, ignoreClass);\r\n\t} else {\r\n\t\tcontainer = this.walkToNode(steps, doc);\r\n\t}\r\n\r\n\treturn container;\r\n};\r\n\r\nEpubCFI.prototype.fixMiss = function(steps, offset, _doc, ignoreClass) {\r\n\tvar container = this.findNode(steps.slice(0,-1), _doc, ignoreClass);\r\n\tvar children = container.childNodes;\r\n\tvar map = this.normalizedMap(children, TEXT_NODE, ignoreClass);\r\n\tvar i;\r\n\tvar child;\r\n\tvar len;\r\n\tvar childIndex;\r\n\tvar lastStepIndex = steps[steps.length-1].index;\r\n\r\n\tfor (var childIndex in map) {\r\n\t\tif (!map.hasOwnProperty(childIndex)) return;\r\n\r\n\t\tif(map[childIndex] === lastStepIndex) {\r\n\t\t\tchild = children[childIndex];\r\n\t\t\tlen = child.textContent.length;\r\n\t\t\tif(offset > len) {\r\n\t\t\t\toffset = offset - len;\r\n\t\t\t} else {\r\n\t\t\t\tif (child.nodeType === ELEMENT_NODE) {\r\n\t\t\t\t\tcontainer = child.childNodes[0];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcontainer = child;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\tcontainer: container,\r\n\t\toffset: offset\r\n\t};\r\n\r\n};\r\n\r\nEpubCFI.prototype.toRange = function(_doc, ignoreClass) {\r\n\tvar doc = _doc || document;\r\n\tvar range = doc.createRange();\r\n\tvar start, end, startContainer, endContainer;\r\n\tvar cfi = this;\r\n\tvar startSteps, endSteps;\r\n\tvar needsIgnoring = ignoreClass ? (doc.querySelector('.' + ignoreClass) != null) : false;\r\n\tvar missed;\r\n\r\n\tif (cfi.range) {\r\n\t\tstart = cfi.start;\r\n\t\tstartSteps = cfi.path.steps.concat(start.steps);\r\n\t\tstartContainer = this.findNode(startSteps, doc, needsIgnoring ? ignoreClass : null);\r\n\t\tend = cfi.end;\r\n\t\tendSteps = cfi.path.steps.concat(end.steps);\r\n\t\tendContainer = this.findNode(endSteps, doc, needsIgnoring ? ignoreClass : null);\r\n\t} else {\r\n\t\tstart = cfi.path;\r\n\t\tstartSteps = cfi.path.steps;\r\n\t\tstartContainer = this.findNode(cfi.path.steps, doc, needsIgnoring ? ignoreClass : null);\r\n\t}\r\n\r\n\tif(startContainer) {\r\n\t\ttry {\r\n\r\n\t\t\tif(start.terminal.offset != null) {\r\n\t\t\t\trange.setStart(startContainer, start.terminal.offset);\r\n\t\t\t} else {\r\n\t\t\t\trange.setStart(startContainer, 0);\r\n\t\t\t}\r\n\r\n\t\t} catch (e) {\r\n\t\t\tmissed = this.fixMiss(startSteps, start.terminal.offset, doc, needsIgnoring ? ignoreClass : null);\r\n\t\t\trange.setStart(missed.container, missed.offset);\r\n\t\t}\r\n\t} else {\r\n\t\t// No start found\r\n\t\treturn null;\r\n\t}\r\n\r\n\tif (endContainer) {\r\n\t\ttry {\r\n\r\n\t\t\tif(end.terminal.offset != null) {\r\n\t\t\t\trange.setEnd(endContainer, end.terminal.offset);\r\n\t\t\t} else {\r\n\t\t\t\trange.setEnd(endContainer, 0);\r\n\t\t\t}\r\n\r\n\t\t} catch (e) {\r\n\t\t\tmissed = this.fixMiss(endSteps, cfi.end.terminal.offset, doc, needsIgnoring ? ignoreClass : null);\r\n\t\t\trange.setEnd(missed.container, missed.offset);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t// doc.defaultView.getSelection().addRange(range);\r\n\treturn range;\r\n};\r\n\r\n// is a cfi string, should be wrapped with \"epubcfi()\"\r\nEpubCFI.prototype.isCfiString = function(str) {\r\n\tif(typeof str === 'string' &&\r\n\t\t\tstr.indexOf(\"epubcfi(\") === 0 &&\r\n\t\t\tstr[str.length-1] === \")\") {\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n};\r\n\r\nEpubCFI.prototype.generateChapterComponent = function(_spineNodeIndex, _pos, id) {\r\n\tvar pos = parseInt(_pos),\r\n\t\tspineNodeIndex = _spineNodeIndex + 1,\r\n\t\tcfi = '/'+spineNodeIndex+'/';\r\n\r\n\tcfi += (pos + 1) * 2;\r\n\r\n\tif(id) {\r\n\t\tcfi += \"[\" + id + \"]\";\r\n\t}\r\n\r\n\treturn cfi;\r\n};\r\n\r\nmodule.exports = EpubCFI;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/epubcfi.js\n// module id = 1\n// module chunks = 0","'use strict';\n\nfunction assertPath(path) {\n  if (typeof path !== 'string') {\n    throw new TypeError('Path must be a string. Received ' + path);\n  }\n}\n\n// Resolves . and .. elements in a path with directory names\nfunction normalizeStringPosix(path, allowAboveRoot) {\n  var res = '';\n  var lastSlash = -1;\n  var dots = 0;\n  var code;\n  for (var i = 0; i <= path.length; ++i) {\n    if (i < path.length)\n      code = path.charCodeAt(i);\n    else if (code === 47/*/*/)\n      break;\n    else\n      code = 47/*/*/;\n    if (code === 47/*/*/) {\n      if (lastSlash === i - 1 || dots === 1) {\n        // NOOP\n      } else if (lastSlash !== i - 1 && dots === 2) {\n        if (res.length < 2 ||\n            res.charCodeAt(res.length - 1) !== 46/*.*/ ||\n            res.charCodeAt(res.length - 2) !== 46/*.*/) {\n          if (res.length > 2) {\n            var start = res.length - 1;\n            var j = start;\n            for (; j >= 0; --j) {\n              if (res.charCodeAt(j) === 47/*/*/)\n                break;\n            }\n            if (j !== start) {\n              if (j === -1)\n                res = '';\n              else\n                res = res.slice(0, j);\n              lastSlash = i;\n              dots = 0;\n              continue;\n            }\n          } else if (res.length === 2 || res.length === 1) {\n            res = '';\n            lastSlash = i;\n            dots = 0;\n            continue;\n          }\n        }\n        if (allowAboveRoot) {\n          if (res.length > 0)\n            res += '/..';\n          else\n            res = '..';\n        }\n      } else {\n        if (res.length > 0)\n          res += '/' + path.slice(lastSlash + 1, i);\n        else\n          res = path.slice(lastSlash + 1, i);\n      }\n      lastSlash = i;\n      dots = 0;\n    } else if (code === 46/*.*/ && dots !== -1) {\n      ++dots;\n    } else {\n      dots = -1;\n    }\n  }\n  return res;\n}\n\nfunction _format(sep, pathObject) {\n  var dir = pathObject.dir || pathObject.root;\n  var base = pathObject.base ||\n    ((pathObject.name || '') + (pathObject.ext || ''));\n  if (!dir) {\n    return base;\n  }\n  if (dir === pathObject.root) {\n    return dir + base;\n  }\n  return dir + sep + base;\n}\n\nvar posix = {\n  // path.resolve([from ...], to)\n  resolve: function resolve() {\n    var resolvedPath = '';\n    var resolvedAbsolute = false;\n    var cwd;\n\n    for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n      var path;\n      if (i >= 0)\n        path = arguments[i];\n      else {\n        if (cwd === undefined)\n          cwd = process.cwd();\n        path = cwd;\n      }\n\n      assertPath(path);\n\n      // Skip empty entries\n      if (path.length === 0) {\n        continue;\n      }\n\n      resolvedPath = path + '/' + resolvedPath;\n      resolvedAbsolute = path.charCodeAt(0) === 47/*/*/;\n    }\n\n    // At this point the path should be resolved to a full absolute path, but\n    // handle relative paths to be safe (might happen when process.cwd() fails)\n\n    // Normalize the path\n    resolvedPath = normalizeStringPosix(resolvedPath, !resolvedAbsolute);\n\n    if (resolvedAbsolute) {\n      if (resolvedPath.length > 0)\n        return '/' + resolvedPath;\n      else\n        return '/';\n    } else if (resolvedPath.length > 0) {\n      return resolvedPath;\n    } else {\n      return '.';\n    }\n  },\n\n\n  normalize: function normalize(path) {\n    assertPath(path);\n\n    if (path.length === 0)\n      return '.';\n\n    var isAbsolute = path.charCodeAt(0) === 47/*/*/;\n    var trailingSeparator = path.charCodeAt(path.length - 1) === 47/*/*/;\n\n    // Normalize the path\n    path = normalizeStringPosix(path, !isAbsolute);\n\n    if (path.length === 0 && !isAbsolute)\n      path = '.';\n    if (path.length > 0 && trailingSeparator)\n      path += '/';\n\n    if (isAbsolute)\n      return '/' + path;\n    return path;\n  },\n\n\n  isAbsolute: function isAbsolute(path) {\n    assertPath(path);\n    return path.length > 0 && path.charCodeAt(0) === 47/*/*/;\n  },\n\n\n  join: function join() {\n    if (arguments.length === 0)\n      return '.';\n    var joined;\n    for (var i = 0; i < arguments.length; ++i) {\n      var arg = arguments[i];\n      assertPath(arg);\n      if (arg.length > 0) {\n        if (joined === undefined)\n          joined = arg;\n        else\n          joined += '/' + arg;\n      }\n    }\n    if (joined === undefined)\n      return '.';\n    return posix.normalize(joined);\n  },\n\n\n  relative: function relative(from, to) {\n    assertPath(from);\n    assertPath(to);\n\n    if (from === to)\n      return '';\n\n    from = posix.resolve(from);\n    to = posix.resolve(to);\n\n    if (from === to)\n      return '';\n\n    // Trim any leading backslashes\n    var fromStart = 1;\n    for (; fromStart < from.length; ++fromStart) {\n      if (from.charCodeAt(fromStart) !== 47/*/*/)\n        break;\n    }\n    var fromEnd = from.length;\n    var fromLen = (fromEnd - fromStart);\n\n    // Trim any leading backslashes\n    var toStart = 1;\n    for (; toStart < to.length; ++toStart) {\n      if (to.charCodeAt(toStart) !== 47/*/*/)\n        break;\n    }\n    var toEnd = to.length;\n    var toLen = (toEnd - toStart);\n\n    // Compare paths to find the longest common path from root\n    var length = (fromLen < toLen ? fromLen : toLen);\n    var lastCommonSep = -1;\n    var i = 0;\n    for (; i <= length; ++i) {\n      if (i === length) {\n        if (toLen > length) {\n          if (to.charCodeAt(toStart + i) === 47/*/*/) {\n            // We get here if `from` is the exact base path for `to`.\n            // For example: from='/foo/bar'; to='/foo/bar/baz'\n            return to.slice(toStart + i + 1);\n          } else if (i === 0) {\n            // We get here if `from` is the root\n            // For example: from='/'; to='/foo'\n            return to.slice(toStart + i);\n          }\n        } else if (fromLen > length) {\n          if (from.charCodeAt(fromStart + i) === 47/*/*/) {\n            // We get here if `to` is the exact base path for `from`.\n            // For example: from='/foo/bar/baz'; to='/foo/bar'\n            lastCommonSep = i;\n          } else if (i === 0) {\n            // We get here if `to` is the root.\n            // For example: from='/foo'; to='/'\n            lastCommonSep = 0;\n          }\n        }\n        break;\n      }\n      var fromCode = from.charCodeAt(fromStart + i);\n      var toCode = to.charCodeAt(toStart + i);\n      if (fromCode !== toCode)\n        break;\n      else if (fromCode === 47/*/*/)\n        lastCommonSep = i;\n    }\n\n    var out = '';\n    // Generate the relative path based on the path difference between `to`\n    // and `from`\n    for (i = fromStart + lastCommonSep + 1; i <= fromEnd; ++i) {\n      if (i === fromEnd || from.charCodeAt(i) === 47/*/*/) {\n        if (out.length === 0)\n          out += '..';\n        else\n          out += '/..';\n      }\n    }\n\n    // Lastly, append the rest of the destination (`to`) path that comes after\n    // the common path parts\n    if (out.length > 0)\n      return out + to.slice(toStart + lastCommonSep);\n    else {\n      toStart += lastCommonSep;\n      if (to.charCodeAt(toStart) === 47/*/*/)\n        ++toStart;\n      return to.slice(toStart);\n    }\n  },\n\n\n  _makeLong: function _makeLong(path) {\n    return path;\n  },\n\n\n  dirname: function dirname(path) {\n    assertPath(path);\n    if (path.length === 0)\n      return '.';\n    var code = path.charCodeAt(0);\n    var hasRoot = (code === 47/*/*/);\n    var end = -1;\n    var matchedSlash = true;\n    for (var i = path.length - 1; i >= 1; --i) {\n      code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        if (!matchedSlash) {\n          end = i;\n          break;\n        }\n      } else {\n        // We saw the first non-path separator\n        matchedSlash = false;\n      }\n    }\n\n    if (end === -1)\n      return hasRoot ? '/' : '.';\n    if (hasRoot && end === 1)\n      return '//';\n    return path.slice(0, end);\n  },\n\n\n  basename: function basename(path, ext) {\n    if (ext !== undefined && typeof ext !== 'string')\n      throw new TypeError('\"ext\" argument must be a string');\n    assertPath(path);\n\n    var start = 0;\n    var end = -1;\n    var matchedSlash = true;\n    var i;\n\n    if (ext !== undefined && ext.length > 0 && ext.length <= path.length) {\n      if (ext.length === path.length && ext === path)\n        return '';\n      var extIdx = ext.length - 1;\n      var firstNonSlashEnd = -1;\n      for (i = path.length - 1; i >= 0; --i) {\n        var code = path.charCodeAt(i);\n        if (code === 47/*/*/) {\n          // If we reached a path separator that was not part of a set of path\n          // separators at the end of the string, stop now\n          if (!matchedSlash) {\n            start = i + 1;\n            break;\n          }\n        } else {\n          if (firstNonSlashEnd === -1) {\n            // We saw the first non-path separator, remember this index in case\n            // we need it if the extension ends up not matching\n            matchedSlash = false;\n            firstNonSlashEnd = i + 1;\n          }\n          if (extIdx >= 0) {\n            // Try to match the explicit extension\n            if (code === ext.charCodeAt(extIdx)) {\n              if (--extIdx === -1) {\n                // We matched the extension, so mark this as the end of our path\n                // component\n                end = i;\n              }\n            } else {\n              // Extension does not match, so our result is the entire path\n              // component\n              extIdx = -1;\n              end = firstNonSlashEnd;\n            }\n          }\n        }\n      }\n\n      if (start === end)\n        end = firstNonSlashEnd;\n      else if (end === -1)\n        end = path.length;\n      return path.slice(start, end);\n    } else {\n      for (i = path.length - 1; i >= 0; --i) {\n        if (path.charCodeAt(i) === 47/*/*/) {\n          // If we reached a path separator that was not part of a set of path\n          // separators at the end of the string, stop now\n          if (!matchedSlash) {\n            start = i + 1;\n            break;\n          }\n        } else if (end === -1) {\n          // We saw the first non-path separator, mark this as the end of our\n          // path component\n          matchedSlash = false;\n          end = i + 1;\n        }\n      }\n\n      if (end === -1)\n        return '';\n      return path.slice(start, end);\n    }\n  },\n\n\n  extname: function extname(path) {\n    assertPath(path);\n    var startDot = -1;\n    var startPart = 0;\n    var end = -1;\n    var matchedSlash = true;\n    // Track the state of characters (if any) we see before our first dot and\n    // after any path separator we find\n    var preDotState = 0;\n    for (var i = path.length - 1; i >= 0; --i) {\n      var code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n      if (end === -1) {\n        // We saw the first non-path separator, mark this as the end of our\n        // extension\n        matchedSlash = false;\n        end = i + 1;\n      }\n      if (code === 46/*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n      } else if (startDot !== -1) {\n        // We saw a non-dot and non-path separator before our dot, so we should\n        // have a good chance at having a non-empty extension\n        preDotState = -1;\n      }\n    }\n\n    if (startDot === -1 ||\n        end === -1 ||\n        // We saw a non-dot character immediately before the dot\n        preDotState === 0 ||\n        // The (right-most) trimmed path component is exactly '..'\n        (preDotState === 1 &&\n         startDot === end - 1 &&\n         startDot === startPart + 1)) {\n      return '';\n    }\n    return path.slice(startDot, end);\n  },\n\n\n  format: function format(pathObject) {\n    if (pathObject === null || typeof pathObject !== 'object') {\n      throw new TypeError(\n        'Parameter \"pathObject\" must be an object, not ' + typeof(pathObject)\n      );\n    }\n    return _format('/', pathObject);\n  },\n\n\n  parse: function parse(path) {\n    assertPath(path);\n\n    var ret = { root: '', dir: '', base: '', ext: '', name: '' };\n    if (path.length === 0)\n      return ret;\n    var code = path.charCodeAt(0);\n    var isAbsolute = (code === 47/*/*/);\n    var start;\n    if (isAbsolute) {\n      ret.root = '/';\n      start = 1;\n    } else {\n      start = 0;\n    }\n    var startDot = -1;\n    var startPart = 0;\n    var end = -1;\n    var matchedSlash = true;\n    var i = path.length - 1;\n\n    // Track the state of characters (if any) we see before our first dot and\n    // after any path separator we find\n    var preDotState = 0;\n\n    // Get non-dir info\n    for (; i >= start; --i) {\n      code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n      if (end === -1) {\n        // We saw the first non-path separator, mark this as the end of our\n        // extension\n        matchedSlash = false;\n        end = i + 1;\n      }\n      if (code === 46/*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n      } else if (startDot !== -1) {\n        // We saw a non-dot and non-path separator before our dot, so we should\n        // have a good chance at having a non-empty extension\n        preDotState = -1;\n      }\n    }\n\n    if (startDot === -1 ||\n        end === -1 ||\n        // We saw a non-dot character immediately before the dot\n        preDotState === 0 ||\n        // The (right-most) trimmed path component is exactly '..'\n        (preDotState === 1 &&\n         startDot === end - 1 &&\n         startDot === startPart + 1)) {\n      if (end !== -1) {\n        if (startPart === 0 && isAbsolute)\n          ret.base = ret.name = path.slice(1, end);\n        else\n          ret.base = ret.name = path.slice(startPart, end);\n      }\n    } else {\n      if (startPart === 0 && isAbsolute) {\n        ret.name = path.slice(1, startDot);\n        ret.base = path.slice(1, end);\n      } else {\n        ret.name = path.slice(startPart, startDot);\n        ret.base = path.slice(startPart, end);\n      }\n      ret.ext = path.slice(startDot, end);\n    }\n\n    if (startPart > 0)\n      ret.dir = path.slice(0, startPart - 1);\n    else if (isAbsolute)\n      ret.dir = '/';\n\n    return ret;\n  },\n\n\n  sep: '/',\n  delimiter: ':',\n  posix: null\n};\n\n\nmodule.exports = posix;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/path-webpack/path.js\n// module id = 2\n// module chunks = 0","'use strict';\n\nvar d        = require('d')\n  , callable = require('es5-ext/object/valid-callable')\n\n  , apply = Function.prototype.apply, call = Function.prototype.call\n  , create = Object.create, defineProperty = Object.defineProperty\n  , defineProperties = Object.defineProperties\n  , hasOwnProperty = Object.prototype.hasOwnProperty\n  , descriptor = { configurable: true, enumerable: false, writable: true }\n\n  , on, once, off, emit, methods, descriptors, base;\n\non = function (type, listener) {\n\tvar data;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) {\n\t\tdata = descriptor.value = create(null);\n\t\tdefineProperty(this, '__ee__', descriptor);\n\t\tdescriptor.value = null;\n\t} else {\n\t\tdata = this.__ee__;\n\t}\n\tif (!data[type]) data[type] = listener;\n\telse if (typeof data[type] === 'object') data[type].push(listener);\n\telse data[type] = [data[type], listener];\n\n\treturn this;\n};\n\nonce = function (type, listener) {\n\tvar once, self;\n\n\tcallable(listener);\n\tself = this;\n\ton.call(this, type, once = function () {\n\t\toff.call(self, type, once);\n\t\tapply.call(listener, this, arguments);\n\t});\n\n\tonce.__eeOnceListener__ = listener;\n\treturn this;\n};\n\noff = function (type, listener) {\n\tvar data, listeners, candidate, i;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return this;\n\tdata = this.__ee__;\n\tif (!data[type]) return this;\n\tlisteners = data[type];\n\n\tif (typeof listeners === 'object') {\n\t\tfor (i = 0; (candidate = listeners[i]); ++i) {\n\t\t\tif ((candidate === listener) ||\n\t\t\t\t\t(candidate.__eeOnceListener__ === listener)) {\n\t\t\t\tif (listeners.length === 2) data[type] = listeners[i ? 0 : 1];\n\t\t\t\telse listeners.splice(i, 1);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif ((listeners === listener) ||\n\t\t\t\t(listeners.__eeOnceListener__ === listener)) {\n\t\t\tdelete data[type];\n\t\t}\n\t}\n\n\treturn this;\n};\n\nemit = function (type) {\n\tvar i, l, listener, listeners, args;\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return;\n\tlisteners = this.__ee__[type];\n\tif (!listeners) return;\n\n\tif (typeof listeners === 'object') {\n\t\tl = arguments.length;\n\t\targs = new Array(l - 1);\n\t\tfor (i = 1; i < l; ++i) args[i - 1] = arguments[i];\n\n\t\tlisteners = listeners.slice();\n\t\tfor (i = 0; (listener = listeners[i]); ++i) {\n\t\t\tapply.call(listener, this, args);\n\t\t}\n\t} else {\n\t\tswitch (arguments.length) {\n\t\tcase 1:\n\t\t\tcall.call(listeners, this);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tcall.call(listeners, this, arguments[1]);\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tcall.call(listeners, this, arguments[1], arguments[2]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tl = arguments.length;\n\t\t\targs = new Array(l - 1);\n\t\t\tfor (i = 1; i < l; ++i) {\n\t\t\t\targs[i - 1] = arguments[i];\n\t\t\t}\n\t\t\tapply.call(listeners, this, args);\n\t\t}\n\t}\n};\n\nmethods = {\n\ton: on,\n\tonce: once,\n\toff: off,\n\temit: emit\n};\n\ndescriptors = {\n\ton: d(on),\n\tonce: d(once),\n\toff: d(off),\n\temit: d(emit)\n};\n\nbase = defineProperties({}, descriptors);\n\nmodule.exports = exports = function (o) {\n\treturn (o == null) ? create(base) : defineProperties(Object(o), descriptors);\n};\nexports.methods = methods;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/event-emitter/index.js\n// module id = 3\n// module chunks = 0","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() { return this; })();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/global.js\n// module id = 4\n// module chunks = 0 1","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/process/browser.js\n// module id = 5\n// module chunks = 0 1","/**\r\n * Hooks allow for injecting functions that must all complete in order before finishing\r\n * They will execute in parallel but all must finish before continuing\r\n * Functions may return a promise if they are asycn.\r\n * @param {any} context scope of this\r\n * @example this.content = new EPUBJS.Hook(this);\r\n */\r\nfunction Hook(context){\r\n\tthis.context = context || this;\r\n\tthis.hooks = [];\r\n};\r\n\r\n/**\r\n * Adds a function to be run before a hook completes\r\n * @example this.content.register(function(){...});\r\n */\r\nHook.prototype.register = function(){\r\n\tfor(var i = 0; i < arguments.length; ++i) {\r\n\t\tif (typeof arguments[i]  === \"function\") {\r\n\t\t\tthis.hooks.push(arguments[i]);\r\n\t\t} else {\r\n\t\t\t// unpack array\r\n\t\t\tfor(var j = 0; j < arguments[i].length; ++j) {\r\n\t\t\t\tthis.hooks.push(arguments[i][j]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * Triggers a hook to run all functions\r\n * @example this.content.trigger(args).then(function(){...});\r\n */\r\nHook.prototype.trigger = function(){\r\n\tvar args = arguments;\r\n\tvar context = this.context;\r\n\tvar promises = [];\r\n\r\n\tthis.hooks.forEach(function(task, i) {\r\n\t\tvar executing = task.apply(context, args);\r\n\r\n\t\tif(executing && typeof executing[\"then\"] === \"function\") {\r\n\t\t\t// Task is a function that returns a promise\r\n\t\t\tpromises.push(executing);\r\n\t\t}\r\n\t\t// Otherwise Task resolves immediately, continue\r\n\t});\r\n\r\n\r\n\treturn Promise.all(promises);\r\n};\r\n\r\n// Adds a function to be run before a hook completes\r\nHook.prototype.list = function(){\r\n\treturn this.hooks;\r\n};\r\n\r\nHook.prototype.clear = function(){\r\n\treturn this.hooks = [];\r\n};\r\n\r\nmodule.exports = Hook;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/hook.js\n// module id = 6\n// module chunks = 0","var EpubCFI = require('./epubcfi');\r\n\r\nfunction Mapping(layout){\r\n\tthis.layout = layout;\r\n};\r\n\r\nMapping.prototype.section = function(view) {\r\n\tvar ranges = this.findRanges(view);\r\n\tvar map = this.rangeListToCfiList(view.section.cfiBase, ranges);\r\n\r\n\treturn map;\r\n};\r\n\r\nMapping.prototype.page = function(contents, cfiBase, start, end) {\r\n\tvar root = contents && contents.document ? contents.document.body : false;\r\n\r\n\tif (!root) {\r\n\t\treturn;\r\n\t}\r\n\r\n\treturn this.rangePairToCfiPair(cfiBase, {\r\n\t\tstart: this.findStart(root, start, end),\r\n\t\tend: this.findEnd(root, start, end)\r\n\t});\r\n};\r\n\r\nMapping.prototype.walk = function(root, func) {\r\n\t//var treeWalker = document.createTreeWalker(root, NodeFilter.SHOW_ELEMENT + NodeFilter.SHOW_TEXT, null, false);\r\n\tvar treeWalker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, {\r\n\t\t\tacceptNode: function (node) {\r\n\t\t\t\t\tif ( node.data.trim().length > 0 ) {\r\n\t\t\t\t\t\treturn NodeFilter.FILTER_ACCEPT;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn NodeFilter.FILTER_REJECT;\r\n\t\t\t\t\t}\r\n\t\t\t}\r\n\t}, false);\r\n\tvar node;\r\n\tvar result;\r\n\twhile ((node = treeWalker.nextNode())) {\r\n\t\tresult = func(node);\r\n\t\tif(result) break;\r\n\t}\r\n\r\n\treturn result;\r\n};\r\n\r\nMapping.prototype.findRanges = function(view){\r\n\tvar columns = [];\r\n\tvar scrollWidth = view.contents.scrollWidth();\r\n\tvar count = this.layout.count(scrollWidth);\r\n\tvar column = this.layout.column;\r\n\tvar gap = this.layout.gap;\r\n\tvar start, end;\r\n\r\n\tfor (var i = 0; i < count.pages; i++) {\r\n\t\tstart = (column + gap) * i;\r\n\t\tend = (column * (i+1)) + (gap * i);\r\n\t\tcolumns.push({\r\n\t\t\tstart: this.findStart(view.document.body, start, end),\r\n\t\t\tend: this.findEnd(view.document.body, start, end)\r\n\t\t});\r\n\t}\r\n\r\n\treturn columns;\r\n};\r\n\r\nMapping.prototype.findStart = function(root, start, end){\r\n\tvar stack = [root];\r\n\tvar $el;\r\n\tvar found;\r\n\tvar $prev = root;\r\n\twhile (stack.length) {\r\n\r\n\t\t$el = stack.shift();\r\n\r\n\t\tfound = this.walk($el, function(node){\r\n\t\t\tvar left, right;\r\n\t\t\tvar elPos;\r\n\t\t\tvar elRange;\r\n\r\n\r\n\t\t\tif(node.nodeType == Node.TEXT_NODE){\r\n\t\t\t\telRange = document.createRange();\r\n\t\t\t\telRange.selectNodeContents(node);\r\n\t\t\t\telPos = elRange.getBoundingClientRect();\r\n\t\t\t} else {\r\n\t\t\t\telPos = node.getBoundingClientRect();\r\n\t\t\t}\r\n\r\n\t\t\tleft = elPos.left;\r\n\t\t\tright = elPos.right;\r\n\r\n\t\t\tif( left >= start && left <= end ) {\r\n\t\t\t\treturn node;\r\n\t\t\t} else if (right > start) {\r\n\t\t\t\treturn node;\r\n\t\t\t} else {\r\n\t\t\t\t$prev = node;\r\n\t\t\t\tstack.push(node);\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t\tif(found) {\r\n\t\t\treturn this.findTextStartRange(found, start, end);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Return last element\r\n\treturn this.findTextStartRange($prev, start, end);\r\n};\r\n\r\nMapping.prototype.findEnd = function(root, start, end){\r\n\tvar stack = [root];\r\n\tvar $el;\r\n\tvar $prev = root;\r\n\tvar found;\r\n\r\n\twhile (stack.length) {\r\n\r\n\t\t$el = stack.shift();\r\n\r\n\t\tfound = this.walk($el, function(node){\r\n\r\n\t\t\tvar left, right;\r\n\t\t\tvar elPos;\r\n\t\t\tvar elRange;\r\n\r\n\r\n\t\t\tif(node.nodeType == Node.TEXT_NODE){\r\n\t\t\t\telRange = document.createRange();\r\n\t\t\t\telRange.selectNodeContents(node);\r\n\t\t\t\telPos = elRange.getBoundingClientRect();\r\n\t\t\t} else {\r\n\t\t\t\telPos = node.getBoundingClientRect();\r\n\t\t\t}\r\n\r\n\t\t\tleft = elPos.left;\r\n\t\t\tright = elPos.right;\r\n\r\n\t\t\tif(left > end && $prev) {\r\n\t\t\t\treturn $prev;\r\n\t\t\t} else if(right > end) {\r\n\t\t\t\treturn node;\r\n\t\t\t} else {\r\n\t\t\t\t$prev = node;\r\n\t\t\t\tstack.push(node);\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\r\n\t\tif(found){\r\n\t\t\treturn this.findTextEndRange(found, start, end);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// end of chapter\r\n\treturn this.findTextEndRange($prev, start, end);\r\n};\r\n\r\n\r\nMapping.prototype.findTextStartRange = function(node, start, end){\r\n\tvar ranges = this.splitTextNodeIntoRanges(node);\r\n\tvar prev;\r\n\tvar range;\r\n\tvar pos;\r\n\r\n\tfor (var i = 0; i < ranges.length; i++) {\r\n\t\trange = ranges[i];\r\n\r\n\t\tpos = range.getBoundingClientRect();\r\n\r\n\t\tif( pos.left >= start ) {\r\n\t\t\treturn range;\r\n\t\t}\r\n\r\n\t\tprev = range;\r\n\r\n\t}\r\n\r\n\treturn ranges[0];\r\n};\r\n\r\nMapping.prototype.findTextEndRange = function(node, start, end){\r\n\tvar ranges = this.splitTextNodeIntoRanges(node);\r\n\tvar prev;\r\n\tvar range;\r\n\tvar pos;\r\n\r\n\tfor (var i = 0; i < ranges.length; i++) {\r\n\t\trange = ranges[i];\r\n\r\n\t\tpos = range.getBoundingClientRect();\r\n\r\n\t\tif(pos.left > end && prev) {\r\n\t\t\treturn prev;\r\n\t\t} else if(pos.right > end) {\r\n\t\t\treturn range;\r\n\t\t}\r\n\r\n\t\tprev = range;\r\n\r\n\t}\r\n\r\n\t// Ends before limit\r\n\treturn ranges[ranges.length-1];\r\n\r\n};\r\n\r\nMapping.prototype.splitTextNodeIntoRanges = function(node, _splitter){\r\n\tvar ranges = [];\r\n\tvar textContent = node.textContent || \"\";\r\n\tvar text = textContent.trim();\r\n\tvar range;\r\n\tvar rect;\r\n\tvar list;\r\n\tvar doc = node.ownerDocument;\r\n\tvar splitter = _splitter || \" \";\r\n\r\n\tpos = text.indexOf(splitter);\r\n\r\n\tif(pos === -1 || node.nodeType != Node.TEXT_NODE) {\r\n\t\trange = doc.createRange();\r\n\t\trange.selectNodeContents(node);\r\n\t\treturn [range];\r\n\t}\r\n\r\n\trange = doc.createRange();\r\n\trange.setStart(node, 0);\r\n\trange.setEnd(node, pos);\r\n\tranges.push(range);\r\n\trange = false;\r\n\r\n\twhile ( pos != -1 ) {\r\n\r\n\t\tpos = text.indexOf(splitter, pos + 1);\r\n\t\tif(pos > 0) {\r\n\r\n\t\t\tif(range) {\r\n\t\t\t\trange.setEnd(node, pos);\r\n\t\t\t\tranges.push(range);\r\n\t\t\t}\r\n\r\n\t\t\trange = doc.createRange();\r\n\t\t\trange.setStart(node, pos+1);\r\n\t\t}\r\n\t}\r\n\r\n\tif(range) {\r\n\t\trange.setEnd(node, text.length);\r\n\t\tranges.push(range);\r\n\t}\r\n\r\n\treturn ranges;\r\n};\r\n\r\n\r\n\r\nMapping.prototype.rangePairToCfiPair = function(cfiBase, rangePair){\r\n\r\n\tvar startRange = rangePair.start;\r\n\tvar endRange = rangePair.end;\r\n\r\n\tstartRange.collapse(true);\r\n\tendRange.collapse(true);\r\n\r\n\t// startCfi = section.cfiFromRange(startRange);\r\n\t// endCfi = section.cfiFromRange(endRange);\r\n\tstartCfi = new EpubCFI(startRange, cfiBase).toString();\r\n\tendCfi = new EpubCFI(endRange, cfiBase).toString();\r\n\r\n\treturn {\r\n\t\tstart: startCfi,\r\n\t\tend: endCfi\r\n\t};\r\n\r\n};\r\n\r\nMapping.prototype.rangeListToCfiList = function(cfiBase, columns){\r\n\tvar map = [];\r\n\tvar rangePair, cifPair;\r\n\r\n\tfor (var i = 0; i < columns.length; i++) {\r\n\t\tcifPair = this.rangePairToCfiPair(cfiBase, columns[i]);\r\n\r\n\t\tmap.push(cifPair);\r\n\r\n\t}\r\n\r\n\treturn map;\r\n};\r\n\r\nmodule.exports = Mapping;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/mapping.js\n// module id = 7\n// module chunks = 0","var core = require('./core');\r\n\r\n/**\r\n * Queue for handling tasks one at a time\r\n * @class\r\n * @param {scope} context what this will resolve to in the tasks\r\n */\r\nfunction Queue(context){\r\n\tthis._q = [];\r\n\tthis.context = context;\r\n\tthis.tick = core.requestAnimationFrame;\r\n\tthis.running = false;\r\n\tthis.paused = false;\r\n};\r\n\r\n/**\r\n * Add an item to the queue\r\n * @return {Promise}\r\n */\r\nQueue.prototype.enqueue = function() {\r\n\tvar deferred, promise;\r\n\tvar queued;\r\n\tvar task = [].shift.call(arguments);\r\n\tvar args = arguments;\r\n\r\n\t// Handle single args without context\r\n\t// if(args && !Array.isArray(args)) {\r\n\t//   args = [args];\r\n\t// }\r\n\tif(!task) {\r\n\t\treturn console.error(\"No Task Provided\");\r\n\t}\r\n\r\n\tif(typeof task === \"function\"){\r\n\r\n\t\tdeferred = new core.defer();\r\n\t\tpromise = deferred.promise;\r\n\r\n\t\tqueued = {\r\n\t\t\t\"task\" : task,\r\n\t\t\t\"args\"     : args,\r\n\t\t\t//\"context\"  : context,\r\n\t\t\t\"deferred\" : deferred,\r\n\t\t\t\"promise\" : promise\r\n\t\t};\r\n\r\n\t} else {\r\n\t\t// Task is a promise\r\n\t\tqueued = {\r\n\t\t\t\"promise\" : task\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tthis._q.push(queued);\r\n\r\n\t// Wait to start queue flush\r\n\tif (this.paused == false && !this.running) {\r\n\t\t// setTimeout(this.flush.bind(this), 0);\r\n\t\t// this.tick.call(window, this.run.bind(this));\r\n\t\tthis.run();\r\n\t}\r\n\r\n\treturn queued.promise;\r\n};\r\n\r\n/**\r\n * Run one item\r\n * @return {Promise}\r\n */\r\nQueue.prototype.dequeue = function(){\r\n\tvar inwait, task, result;\r\n\r\n\tif(this._q.length) {\r\n\t\tinwait = this._q.shift();\r\n\t\ttask = inwait.task;\r\n\t\tif(task){\r\n\t\t\t// console.log(task)\r\n\r\n\t\t\tresult = task.apply(this.context, inwait.args);\r\n\r\n\t\t\tif(result && typeof result[\"then\"] === \"function\") {\r\n\t\t\t\t// Task is a function that returns a promise\r\n\t\t\t\treturn result.then(function(){\r\n\t\t\t\t\tinwait.deferred.resolve.apply(this.context, arguments);\r\n\t\t\t\t}, function(reason) {\r\n\t\t\t\t  \tinwait.deferred.reject.apply(this.context, arguments);\r\n\t\t\t\t}.bind(this));\r\n\t\t\t} else {\r\n\t\t\t\t// Task resolves immediately\r\n\t\t\t\tinwait.deferred.resolve.apply(this.context, result);\r\n\t\t\t\treturn inwait.promise;\r\n\t\t\t}\r\n\r\n\r\n\r\n\t\t} else if(inwait.promise) {\r\n\t\t\t// Task is a promise\r\n\t\t\treturn inwait.promise;\r\n\t\t}\r\n\r\n\t} else {\r\n\t\tinwait = new core.defer();\r\n\t\tinwait.deferred.resolve();\r\n\t\treturn inwait.promise;\r\n\t}\r\n\r\n};\r\n\r\n// Run All Immediately\r\nQueue.prototype.dump = function(){\r\n\twhile(this._q.length) {\r\n\t\tthis.dequeue();\r\n\t}\r\n};\r\n\r\n/**\r\n * Run all tasks sequentially, at convince\r\n * @return {Promise}\r\n */\r\nQueue.prototype.run = function(){\r\n\r\n\tif(!this.running){\r\n\t\tthis.running = true;\r\n\t\tthis.defered = new core.defer();\r\n\t}\r\n\r\n\tthis.tick.call(window, function() {\r\n\r\n\t\tif(this._q.length) {\r\n\r\n\t\t\tthis.dequeue()\r\n\t\t\t\t.then(function(){\r\n\t\t\t\t\tthis.run();\r\n\t\t\t\t}.bind(this));\r\n\r\n\t\t} else {\r\n\t\t\tthis.defered.resolve();\r\n\t\t\tthis.running = undefined;\r\n\t\t}\r\n\r\n\t}.bind(this));\r\n\r\n\t// Unpause\r\n\tif(this.paused == true) {\r\n\t\tthis.paused = false;\r\n\t}\r\n\r\n\treturn this.defered.promise;\r\n};\r\n\r\n/**\r\n * Flush all, as quickly as possible\r\n * @return {Promise}\r\n */\r\nQueue.prototype.flush = function(){\r\n\r\n\tif(this.running){\r\n\t\treturn this.running;\r\n\t}\r\n\r\n\tif(this._q.length) {\r\n\t\tthis.running = this.dequeue()\r\n\t\t\t.then(function(){\r\n\t\t\t\tthis.running = undefined;\r\n\t\t\t\treturn this.flush();\r\n\t\t\t}.bind(this));\r\n\r\n\t\treturn this.running;\r\n\t}\r\n\r\n};\r\n\r\n/**\r\n * Clear all items in wait\r\n */\r\nQueue.prototype.clear = function(){\r\n\tthis._q = [];\r\n\tthis.running = false;\r\n};\r\n\r\n/**\r\n * Get the number of tasks in the queue\r\n * @return {int} tasks\r\n */\r\nQueue.prototype.length = function(){\r\n\treturn this._q.length;\r\n};\r\n\r\n/**\r\n * Pause a running queue\r\n */\r\nQueue.prototype.pause = function(){\r\n\tthis.paused = true;\r\n};\r\n\r\n/**\r\n * Create a new task from a callback\r\n * @class\r\n * @private\r\n * @param {function} task\r\n * @param {array} args\r\n * @param {scope} context\r\n * @return {function} task\r\n */\r\nfunction Task(task, args, context){\r\n\r\n\treturn function(){\r\n\t\tvar toApply = arguments || [];\r\n\r\n\t\treturn new Promise(function(resolve, reject) {\r\n\t\t\tvar callback = function(value){\r\n\t\t\t\tresolve(value);\r\n\t\t\t};\r\n\t\t\t// Add the callback to the arguments list\r\n\t\t\ttoApply.push(callback);\r\n\r\n\t\t\t// Apply all arguments to the functions\r\n\t\t\ttask.apply(this, toApply);\r\n\r\n\t}.bind(this));\r\n\r\n\t};\r\n\r\n};\r\n\r\nmodule.exports = Queue;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/queue.js\n// module id = 8\n// module chunks = 0","// var URI = require('urijs');\r\nvar core = require('./core');\r\nvar Url = require('./core').Url;\r\n\r\nfunction base(doc, section){\r\n\tvar base;\r\n\tvar head;\r\n\r\n\tif(!doc){\r\n\t\treturn;\r\n\t}\r\n\r\n\t// head = doc.querySelector(\"head\");\r\n\t// base = head.querySelector(\"base\");\r\n\thead = core.qs(doc, \"head\");\r\n\tbase = core.qs(head, \"base\");\r\n\r\n\tif(!base) {\r\n\t\tbase = doc.createElement(\"base\");\r\n\t\thead.insertBefore(base, head.firstChild);\r\n\t}\r\n\r\n\tbase.setAttribute(\"href\", section.url);\r\n}\r\n\r\nfunction canonical(doc, section){\r\n\tvar head;\r\n\tvar link;\r\n\tvar url = section.url; // window.location.origin +  window.location.pathname + \"?loc=\" + encodeURIComponent(section.url);\r\n\r\n\tif(!doc){\r\n\t\treturn;\r\n\t}\r\n\r\n\thead = core.qs(doc, \"head\");\r\n\tlink = core.qs(head, \"link[rel='canonical']\");\r\n\r\n\tif (link) {\r\n\t\tlink.setAttribute(\"href\", url);\r\n\t} else {\r\n\t\tlink = doc.createElement(\"link\");\r\n\t\tlink.setAttribute(\"rel\", \"canonical\");\r\n\t\tlink.setAttribute(\"href\", url);\r\n\t\thead.appendChild(link);\r\n\t}\r\n}\r\n\r\nfunction links(view, renderer) {\r\n\r\n\tvar links = view.document.querySelectorAll(\"a[href]\");\r\n\tvar replaceLinks = function(link){\r\n\t\tvar href = link.getAttribute(\"href\");\r\n\r\n\t\tif(href.indexOf(\"mailto:\") === 0){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar linkUrl = Url(href);\r\n\t\tvar relative = this.book.resolve(href, false);\r\n\r\n\t\tif(linkUrl && linkUrl.protocol){\r\n\r\n\t\t\tlink.setAttribute(\"target\", \"_blank\");\r\n\r\n\t\t}else{\r\n\t\t\t/*\r\n\t\t\tif(baseDirectory) {\r\n\t\t\t\t// We must ensure that the file:// protocol is preserved for\r\n\t\t\t\t// local file links, as in certain contexts (such as under\r\n\t\t\t\t// Titanium), file links without the file:// protocol will not\r\n\t\t\t\t// work\r\n\t\t\t\tif (baseUri.protocol === \"file\") {\r\n\t\t\t\t\trelative = core.resolveUrl(baseUri.base, href);\r\n\t\t\t\t} else {\r\n\t\t\t\t\trelative = core.resolveUrl(baseDirectory, href);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\trelative = href;\r\n\t\t\t}\r\n\t\t\t*/\r\n\r\n\t\t\tif(linkUrl && linkUrl.fragment) {\r\n\t\t\t\t// do nothing with fragment yet\r\n\t\t\t} else {\r\n\t\t\t\tlink.onclick = function(){\r\n\t\t\t\t\trenderer.display(relative);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}.bind(this);\r\n\r\n\tfor (var i = 0; i < links.length; i++) {\r\n\t\treplaceLinks(links[i]);\r\n\t}\r\n\r\n\r\n};\r\n\r\nfunction substitute(content, urls, replacements) {\r\n\turls.forEach(function(url, i){\r\n\t\tif (url && replacements[i]) {\r\n\t\t\tcontent = content.replace(new RegExp(url, 'g'), replacements[i]);\r\n\t\t}\r\n\t});\r\n\treturn content;\r\n}\r\nmodule.exports = {\r\n\t'base': base,\r\n\t'canonical' : canonical,\r\n\t'links': links,\r\n\t'substitute': substitute\r\n};\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/replacements.js\n// module id = 9\n// module chunks = 0","var core = require('./core');\r\nvar Path = require('./core').Path;\r\n\r\nfunction request(url, type, withCredentials, headers) {\r\n\tvar supportsURL = (typeof window != \"undefined\") ? window.URL : false; // TODO: fallback for url if window isn't defined\r\n\tvar BLOB_RESPONSE = supportsURL ? \"blob\" : \"arraybuffer\";\r\n\tvar uri;\r\n\r\n\tvar deferred = new core.defer();\r\n\r\n\tvar xhr = new XMLHttpRequest();\r\n\r\n\t//-- Check from PDF.js:\r\n\t//   https://github.com/mozilla/pdf.js/blob/master/web/compatibility.js\r\n\tvar xhrPrototype = XMLHttpRequest.prototype;\r\n\r\n\tvar header;\r\n\r\n\tif (!('overrideMimeType' in xhrPrototype)) {\r\n\t\t// IE10 might have response, but not overrideMimeType\r\n\t\tObject.defineProperty(xhrPrototype, 'overrideMimeType', {\r\n\t\t\tvalue: function xmlHttpRequestOverrideMimeType(mimeType) {}\r\n\t\t});\r\n\t}\r\n\tif(withCredentials) {\r\n\t\txhr.withCredentials = true;\r\n\t}\r\n\r\n\txhr.onreadystatechange = handler;\r\n\txhr.onerror = err;\r\n\r\n\txhr.open(\"GET\", url, true);\r\n\r\n\tfor(header in headers) {\r\n\t\txhr.setRequestHeader(header, headers[header]);\r\n\t}\r\n\r\n\tif(type == \"json\") {\r\n\t\txhr.setRequestHeader(\"Accept\", \"application/json\");\r\n\t}\r\n\r\n\t// If type isn't set, determine it from the file extension\r\n\tif(!type) {\r\n\t\ttype = new Path(url).extension;\r\n\t}\r\n\r\n\tif(type == 'blob'){\r\n\t\txhr.responseType = BLOB_RESPONSE;\r\n\t}\r\n\r\n\r\n\tif(core.isXml(type)) {\r\n\t\t// xhr.responseType = \"document\";\r\n\t\txhr.overrideMimeType('text/xml'); // for OPF parsing\r\n\t}\r\n\r\n\tif(type == 'xhtml') {\r\n\t\t// xhr.responseType = \"document\";\r\n\t}\r\n\r\n\tif(type == 'html' || type == 'htm') {\r\n\t\t// xhr.responseType = \"document\";\r\n\t }\r\n\r\n\tif(type == \"binary\") {\r\n\t\txhr.responseType = \"arraybuffer\";\r\n\t}\r\n\r\n\txhr.send();\r\n\r\n\tfunction err(e) {\r\n\t\tconsole.error(e);\r\n\t\tdeferred.reject(e);\r\n\t}\r\n\r\n\tfunction handler() {\r\n\t\tif (this.readyState === XMLHttpRequest.DONE) {\r\n\t\t\tvar responseXML = false;\r\n\r\n\t\t\tif(this.responseType === '' || this.responseType === \"document\") {\r\n\t\t\t\tresponseXML = this.responseXML;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.status === 200 || responseXML ) { //-- Firefox is reporting 0 for blob urls\r\n\t\t\t\tvar r;\r\n\r\n\t\t\t\tif (!this.response && !responseXML) {\r\n\t\t\t\t\tdeferred.reject({\r\n\t\t\t\t\t\tstatus: this.status,\r\n\t\t\t\t\t\tmessage : \"Empty Response\",\r\n\t\t\t\t\t\tstack : new Error().stack\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn deferred.promise;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.status === 403) {\r\n\t\t\t\t\tdeferred.reject({\r\n\t\t\t\t\t\tstatus: this.status,\r\n\t\t\t\t\t\tresponse: this.response,\r\n\t\t\t\t\t\tmessage : \"Forbidden\",\r\n\t\t\t\t\t\tstack : new Error().stack\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn deferred.promise;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(responseXML){\r\n\t\t\t\t\tr = this.responseXML;\r\n\t\t\t\t} else\r\n\t\t\t\tif(core.isXml(type)){\r\n\t\t\t\t\t// xhr.overrideMimeType('text/xml'); // for OPF parsing\r\n\t\t\t\t\t// If this.responseXML wasn't set, try to parse using a DOMParser from text\r\n\t\t\t\t\tr = core.parse(this.response, \"text/xml\");\r\n\t\t\t\t}else\r\n\t\t\t\tif(type == 'xhtml'){\r\n\t\t\t\t\tr = core.parse(this.response, \"application/xhtml+xml\");\r\n\t\t\t\t}else\r\n\t\t\t\tif(type == 'html' || type == 'htm'){\r\n\t\t\t\t\tr = core.parse(this.response, \"text/html\");\r\n\t\t\t\t}else\r\n\t\t\t\tif(type == 'json'){\r\n\t\t\t\t\tr = JSON.parse(this.response);\r\n\t\t\t\t}else\r\n\t\t\t\tif(type == 'blob'){\r\n\r\n\t\t\t\t\tif(supportsURL) {\r\n\t\t\t\t\t\tr = this.response;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t//-- Safari doesn't support responseType blob, so create a blob from arraybuffer\r\n\t\t\t\t\t\tr = new Blob([this.response]);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}else{\r\n\t\t\t\t\tr = this.response;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdeferred.resolve(r);\r\n\t\t\t} else {\r\n\r\n\t\t\t\tdeferred.reject({\r\n\t\t\t\t\tstatus: this.status,\r\n\t\t\t\t\tmessage : this.response,\r\n\t\t\t\t\tstack : new Error().stack\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn deferred.promise;\r\n};\r\n\r\nmodule.exports = request;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/request.js\n// module id = 10\n// module chunks = 0","var EventEmitter = require('event-emitter');\r\nvar core = require('./core');\r\nvar EpubCFI = require('./epubcfi');\r\nvar Mapping = require('./mapping');\r\n\r\n\r\nfunction Contents(doc, content, cfiBase) {\r\n\t// Blank Cfi for Parsing\r\n\tthis.epubcfi = new EpubCFI();\r\n\r\n\tthis.document = doc;\r\n\tthis.documentElement =  this.document.documentElement;\r\n\tthis.content = content || this.document.body;\r\n\tthis.window = this.document.defaultView;\r\n\t// Dom events to listen for\r\n\tthis.listenedEvents = [\"keydown\", \"keyup\", \"keypressed\", \"mouseup\", \"mousedown\", \"click\", \"touchend\", \"touchstart\"];\r\n\r\n\tthis._size = {\r\n\t\twidth: 0,\r\n\t\theight: 0\r\n\t}\r\n\r\n\tthis.cfiBase = cfiBase || \"\";\r\n\r\n\tthis.listeners();\r\n};\r\n\r\nContents.prototype.width = function(w) {\r\n\t// var frame = this.documentElement;\r\n\tvar frame = this.content;\r\n\r\n\tif (w && core.isNumber(w)) {\r\n\t\tw = w + \"px\";\r\n\t}\r\n\r\n\tif (w) {\r\n\t\tframe.style.width = w;\r\n\t\t// this.content.style.width = w;\r\n\t}\r\n\r\n\treturn this.window.getComputedStyle(frame)['width'];\r\n\r\n\r\n};\r\n\r\nContents.prototype.height = function(h) {\r\n\t// var frame = this.documentElement;\r\n\tvar frame = this.content;\r\n\r\n\tif (h && core.isNumber(h)) {\r\n\t\th = h + \"px\";\r\n\t}\r\n\r\n\tif (h) {\r\n\t\tframe.style.height = h;\r\n\t\t// this.content.style.height = h;\r\n\t}\r\n\r\n\treturn this.window.getComputedStyle(frame)['height'];\r\n\r\n};\r\n\r\nContents.prototype.contentWidth = function(w) {\r\n\r\n\tvar content = this.content || this.document.body;\r\n\r\n\tif (w && core.isNumber(w)) {\r\n\t\tw = w + \"px\";\r\n\t}\r\n\r\n\tif (w) {\r\n\t\tcontent.style.width = w;\r\n\t}\r\n\r\n\treturn this.window.getComputedStyle(content)['width'];\r\n\r\n\r\n};\r\n\r\nContents.prototype.contentHeight = function(h) {\r\n\r\n\tvar content = this.content || this.document.body;\r\n\r\n\tif (h && core.isNumber(h)) {\r\n\t\th = h + \"px\";\r\n\t}\r\n\r\n\tif (h) {\r\n\t\tcontent.style.height = h;\r\n\t}\r\n\r\n\treturn this.window.getComputedStyle(content)['height'];\r\n\r\n};\r\n\r\nContents.prototype.textWidth = function() {\r\n\tvar width;\r\n\tvar range = this.document.createRange();\r\n\tvar content = this.content || this.document.body;\r\n\r\n\t// Select the contents of frame\r\n\trange.selectNodeContents(content);\r\n\r\n\t// get the width of the text content\r\n\twidth = range.getBoundingClientRect().width;\r\n\r\n\treturn width;\r\n\r\n};\r\n\r\nContents.prototype.textHeight = function() {\r\n\tvar height;\r\n\tvar range = this.document.createRange();\r\n\tvar content = this.content || this.document.body;\r\n\r\n\trange.selectNodeContents(content);\r\n\r\n\theight = range.getBoundingClientRect().height;\r\n\r\n\treturn height;\r\n};\r\n\r\nContents.prototype.scrollWidth = function() {\r\n\tvar width = this.documentElement.scrollWidth;\r\n\r\n\treturn width;\r\n};\r\n\r\nContents.prototype.scrollHeight = function() {\r\n\tvar height = this.documentElement.scrollHeight;\r\n\r\n\treturn height;\r\n};\r\n\r\nContents.prototype.overflow = function(overflow) {\r\n\r\n\tif (overflow) {\r\n\t\tthis.documentElement.style.overflow = overflow;\r\n\t}\r\n\r\n\treturn this.window.getComputedStyle(this.documentElement)['overflow'];\r\n};\r\n\r\nContents.prototype.overflowX = function(overflow) {\r\n\r\n\tif (overflow) {\r\n\t\tthis.documentElement.style.overflowX = overflow;\r\n\t}\r\n\r\n\treturn this.window.getComputedStyle(this.documentElement)['overflowX'];\r\n};\r\n\r\nContents.prototype.overflowY = function(overflow) {\r\n\r\n\tif (overflow) {\r\n\t\tthis.documentElement.style.overflowY = overflow;\r\n\t}\r\n\r\n\treturn this.window.getComputedStyle(this.documentElement)['overflowY'];\r\n};\r\n\r\nContents.prototype.css = function(property, value) {\r\n\tvar content = this.content || this.document.body;\r\n\r\n\tif (value) {\r\n\t\tcontent.style[property] = value;\r\n\t}\r\n\r\n\treturn this.window.getComputedStyle(content)[property];\r\n};\r\n\r\nContents.prototype.viewport = function(options) {\r\n\tvar width, height, scale, scalable;\r\n\tvar $viewport = this.document.querySelector(\"meta[name='viewport']\");\r\n\tvar newContent = '';\r\n\r\n\t/*\r\n\t* check for the viewport size\r\n\t* <meta name=\"viewport\" content=\"width=1024,height=697\" />\r\n\t*/\r\n\tif($viewport && $viewport.hasAttribute(\"content\")) {\r\n\t\tcontent = $viewport.getAttribute(\"content\");\r\n\t\tcontents = content.split(/\\s*,\\s*/);\r\n\t\tif(contents[0]){\r\n\t\t\twidth = contents[0].replace(\"width=\", '').trim();\r\n\t\t}\r\n\t\tif(contents[1]){\r\n\t\t\theight = contents[1].replace(\"height=\", '').trim();\r\n\t\t}\r\n\t\tif(contents[2]){\r\n\t\t\tscale = contents[2].replace(\"initial-scale=\", '').trim();\r\n\t\t}\r\n\t\tif(contents[3]){\r\n\t\t\tscalable = contents[3].replace(\"user-scalable=\", '').trim();\r\n\t\t}\r\n\t}\r\n\r\n\tif (options) {\r\n\r\n\t\tnewContent += \"width=\" + (options.width || width);\r\n\t\tnewContent += \", height=\" + (options.height || height);\r\n\t\tif (options.scale || scale) {\r\n\t\t\tnewContent += \", initial-scale=\" + (options.scale || scale);\r\n\t\t}\r\n\t\tif (options.scalable || scalable) {\r\n\t\t\tnewContent += \", user-scalable=\" + (options.scalable || scalable);\r\n\t\t}\r\n\r\n\t\tif (!$viewport) {\r\n\t\t\t$viewport = this.document.createElement(\"meta\");\r\n\t\t\t$viewport.setAttribute(\"name\", \"viewport\");\r\n\t\t\tthis.document.querySelector('head').appendChild($viewport);\r\n\t\t}\r\n\r\n\t\t$viewport.setAttribute(\"content\", newContent);\r\n\t}\r\n\r\n\r\n\treturn {\r\n\t\twidth: parseInt(width),\r\n\t\theight: parseInt(height)\r\n\t};\r\n};\r\n\r\n\r\n// Contents.prototype.layout = function(layoutFunc) {\r\n//\r\n//   this.iframe.style.display = \"inline-block\";\r\n//\r\n//   // Reset Body Styles\r\n//   this.content.style.margin = \"0\";\r\n//   //this.document.body.style.display = \"inline-block\";\r\n//   //this.document.documentElement.style.width = \"auto\";\r\n//\r\n//   if(layoutFunc){\r\n//     layoutFunc(this);\r\n//   }\r\n//\r\n//   this.onLayout(this);\r\n//\r\n// };\r\n//\r\n// Contents.prototype.onLayout = function(view) {\r\n//   // stub\r\n// };\r\n\r\nContents.prototype.expand = function() {\r\n\tthis.emit(\"expand\");\r\n};\r\n\r\nContents.prototype.listeners = function() {\r\n\r\n\tthis.imageLoadListeners();\r\n\r\n\tthis.mediaQueryListeners();\r\n\r\n\t// this.fontLoadListeners();\r\n\r\n\tthis.addEventListeners();\r\n\r\n\tthis.addSelectionListeners();\r\n\r\n\tthis.resizeListeners();\r\n\r\n};\r\n\r\nContents.prototype.removeListeners = function() {\r\n\r\n\tthis.removeEventListeners();\r\n\r\n\tthis.removeSelectionListeners();\r\n};\r\n\r\nContents.prototype.resizeListeners = function() {\r\n\tvar width, height;\r\n\t// Test size again\r\n\tclearTimeout(this.expanding);\r\n\r\n\twidth = this.scrollWidth();\r\n\theight = this.scrollHeight();\r\n\r\n\tif (width != this._size.width || height != this._size.height) {\r\n\r\n\t\tthis._size = {\r\n\t\t\twidth: width,\r\n\t\t\theight: height\r\n\t\t}\r\n\r\n\t\tthis.emit(\"resize\", this._size);\r\n\t}\r\n\r\n\tthis.expanding = setTimeout(this.resizeListeners.bind(this), 350);\r\n};\r\n\r\n//https://github.com/tylergaw/media-query-events/blob/master/js/mq-events.js\r\nContents.prototype.mediaQueryListeners = function() {\r\n\t\tvar sheets = this.document.styleSheets;\r\n\t\tvar mediaChangeHandler = function(m){\r\n\t\t\tif(m.matches && !this._expanding) {\r\n\t\t\t\tsetTimeout(this.expand.bind(this), 1);\r\n\t\t\t\t// this.expand();\r\n\t\t\t}\r\n\t\t}.bind(this);\r\n\r\n\t\tfor (var i = 0; i < sheets.length; i += 1) {\r\n\t\t\t\tvar rules;\r\n\t\t\t\t// Firefox errors if we access cssRules cross-domain\r\n\t\t\t\ttry {\r\n\t\t\t\t\trules = sheets[i].cssRules;\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif(!rules) return; // Stylesheets changed\r\n\t\t\t\tfor (var j = 0; j < rules.length; j += 1) {\r\n\t\t\t\t\t\t//if (rules[j].constructor === CSSMediaRule) {\r\n\t\t\t\t\t\tif(rules[j].media){\r\n\t\t\t\t\t\t\t\tvar mql = this.window.matchMedia(rules[j].media.mediaText);\r\n\t\t\t\t\t\t\t\tmql.addListener(mediaChangeHandler);\r\n\t\t\t\t\t\t\t\t//mql.onchange = mediaChangeHandler;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t}\r\n};\r\n\r\nContents.prototype.observe = function(target) {\r\n\tvar renderer = this;\r\n\r\n\t// create an observer instance\r\n\tvar observer = new MutationObserver(function(mutations) {\r\n\t\tif(renderer._expanding) {\r\n\t\t\trenderer.expand();\r\n\t\t}\r\n\t\t// mutations.forEach(function(mutation) {\r\n\t\t//   console.log(mutation);\r\n\t\t// });\r\n\t});\r\n\r\n\t// configuration of the observer:\r\n\tvar config = { attributes: true, childList: true, characterData: true, subtree: true };\r\n\r\n\t// pass in the target node, as well as the observer options\r\n\tobserver.observe(target, config);\r\n\r\n\treturn observer;\r\n};\r\n\r\nContents.prototype.imageLoadListeners = function(target) {\r\n\tvar images = this.document.querySelectorAll(\"img\");\r\n\tvar img;\r\n\tfor (var i = 0; i < images.length; i++) {\r\n\t\timg = images[i];\r\n\r\n\t\tif (typeof img.naturalWidth !== \"undefined\" &&\r\n\t\t\t\timg.naturalWidth === 0) {\r\n\t\t\timg.onload = this.expand.bind(this);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nContents.prototype.fontLoadListeners = function(target) {\r\n\tif (!this.document || !this.document.fonts) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tthis.document.fonts.ready.then(function () {\r\n\t\tthis.expand();\r\n\t}.bind(this));\r\n\r\n};\r\n\r\nContents.prototype.root = function() {\r\n\tif(!this.document) return null;\r\n\treturn this.document.documentElement;\r\n};\r\n\r\nContents.prototype.locationOf = function(target, ignoreClass) {\r\n\tvar position;\r\n\tvar targetPos = {\"left\": 0, \"top\": 0};\r\n\r\n\tif(!this.document) return;\r\n\r\n\tif(this.epubcfi.isCfiString(target)) {\r\n\t\trange = new EpubCFI(target).toRange(this.document, ignoreClass);\r\n\r\n\t\tif(range) {\r\n\t\t\tif (range.startContainer.nodeType === Node.ELEMENT_NODE) {\r\n\t\t\t\tposition = range.startContainer.getBoundingClientRect();\r\n\t\t\t\ttargetPos.left = position.left;\r\n\t\t\t\ttargetPos.top = position.top;\r\n\t\t\t} else {\r\n\t\t\t\t// Webkit does not handle collapsed range bounds correctly\r\n\t\t\t\t// https://bugs.webkit.org/show_bug.cgi?id=138949\r\n\t\t\t\tif (range.collapsed) {\r\n\t\t\t\t\tposition = range.getClientRects()[0];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tposition = range.getBoundingClientRect();\r\n\t\t\t\t}\r\n\t\t\t\ttargetPos.left = position.left;\r\n\t\t\t\ttargetPos.top = position.top;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t} else if(typeof target === \"string\" &&\r\n\t\ttarget.indexOf(\"#\") > -1) {\r\n\r\n\t\tid = target.substring(target.indexOf(\"#\")+1);\r\n\t\tel = this.document.getElementById(id);\r\n\r\n\t\tif(el) {\r\n\t\t\tposition = el.getBoundingClientRect();\r\n\t\t\ttargetPos.left = position.left;\r\n\t\t\ttargetPos.top = position.top;\r\n\t\t}\r\n\t}\r\n\r\n\treturn targetPos;\r\n};\r\n\r\nContents.prototype.addStylesheet = function(src) {\r\n\treturn new Promise(function(resolve, reject){\r\n\t\tvar $stylesheet;\r\n\t\tvar ready = false;\r\n\r\n\t\tif(!this.document) {\r\n\t\t\tresolve(false);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t$stylesheet = this.document.createElement('link');\r\n\t\t$stylesheet.type = 'text/css';\r\n\t\t$stylesheet.rel = \"stylesheet\";\r\n\t\t$stylesheet.href = src;\r\n\t\t$stylesheet.onload = $stylesheet.onreadystatechange = function() {\r\n\t\t\tif ( !ready && (!this.readyState || this.readyState == 'complete') ) {\r\n\t\t\t\tready = true;\r\n\t\t\t\t// Let apply\r\n\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\tresolve(true);\r\n\t\t\t\t}, 1);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.document.head.appendChild($stylesheet);\r\n\r\n\t}.bind(this));\r\n};\r\n\r\n// https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleSheet/insertRule\r\nContents.prototype.addStylesheetRules = function(rules) {\r\n\tvar styleEl;\r\n\tvar styleSheet;\r\n\r\n\tif(!this.document) return;\r\n\r\n\tstyleEl = this.document.createElement('style');\r\n\r\n\t// Append style element to head\r\n\tthis.document.head.appendChild(styleEl);\r\n\r\n\t// Grab style sheet\r\n\tstyleSheet = styleEl.sheet;\r\n\r\n\tfor (var i = 0, rl = rules.length; i < rl; i++) {\r\n\t\tvar j = 1, rule = rules[i], selector = rules[i][0], propStr = '';\r\n\t\t// If the second argument of a rule is an array of arrays, correct our variables.\r\n\t\tif (Object.prototype.toString.call(rule[1][0]) === '[object Array]') {\r\n\t\t\trule = rule[1];\r\n\t\t\tj = 0;\r\n\t\t}\r\n\r\n\t\tfor (var pl = rule.length; j < pl; j++) {\r\n\t\t\tvar prop = rule[j];\r\n\t\t\tpropStr += prop[0] + ':' + prop[1] + (prop[2] ? ' !important' : '') + ';\\n';\r\n\t\t}\r\n\r\n\t\t// Insert CSS Rule\r\n\t\tstyleSheet.insertRule(selector + '{' + propStr + '}', styleSheet.cssRules.length);\r\n\t}\r\n};\r\n\r\nContents.prototype.addScript = function(src) {\r\n\r\n\treturn new Promise(function(resolve, reject){\r\n\t\tvar $script;\r\n\t\tvar ready = false;\r\n\r\n\t\tif(!this.document) {\r\n\t\t\tresolve(false);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t$script = this.document.createElement('script');\r\n\t\t$script.type = 'text/javascript';\r\n\t\t$script.async = true;\r\n\t\t$script.src = src;\r\n\t\t$script.onload = $script.onreadystatechange = function() {\r\n\t\t\tif ( !ready && (!this.readyState || this.readyState == 'complete') ) {\r\n\t\t\t\tready = true;\r\n\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\tresolve(true);\r\n\t\t\t\t}, 1);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.document.head.appendChild($script);\r\n\r\n\t}.bind(this));\r\n};\r\n\r\nContents.prototype.addEventListeners = function(){\r\n\tif(!this.document) {\r\n\t\treturn;\r\n\t}\r\n\tthis.listenedEvents.forEach(function(eventName){\r\n\t\tthis.document.addEventListener(eventName, this.triggerEvent.bind(this), false);\r\n\t}, this);\r\n\r\n};\r\n\r\nContents.prototype.removeEventListeners = function(){\r\n\tif(!this.document) {\r\n\t\treturn;\r\n\t}\r\n\tthis.listenedEvents.forEach(function(eventName){\r\n\t\tthis.document.removeEventListener(eventName, this.triggerEvent, false);\r\n\t}, this);\r\n\r\n};\r\n\r\n// Pass browser events\r\nContents.prototype.triggerEvent = function(e){\r\n\tthis.emit(e.type, e);\r\n};\r\n\r\nContents.prototype.addSelectionListeners = function(){\r\n\tif(!this.document) {\r\n\t\treturn;\r\n\t}\r\n\tthis.document.addEventListener(\"selectionchange\", this.onSelectionChange.bind(this), false);\r\n};\r\n\r\nContents.prototype.removeSelectionListeners = function(){\r\n\tif(!this.document) {\r\n\t\treturn;\r\n\t}\r\n\tthis.document.removeEventListener(\"selectionchange\", this.onSelectionChange, false);\r\n};\r\n\r\nContents.prototype.onSelectionChange = function(e){\r\n\tif (this.selectionEndTimeout) {\r\n\t\tclearTimeout(this.selectionEndTimeout);\r\n\t}\r\n\tthis.selectionEndTimeout = setTimeout(function() {\r\n\t\tvar selection = this.window.getSelection();\r\n\t\tthis.triggerSelectedEvent(selection);\r\n\t}.bind(this), 500);\r\n};\r\n\r\nContents.prototype.triggerSelectedEvent = function(selection){\r\n\tvar range, cfirange;\r\n\r\n\tif (selection && selection.rangeCount > 0) {\r\n\t\trange = selection.getRangeAt(0);\r\n\t\tif(!range.collapsed) {\r\n\t\t\t// cfirange = this.section.cfiFromRange(range);\r\n\t\t\tcfirange = new EpubCFI(range, this.cfiBase).toString();\r\n\t\t\tthis.emit(\"selected\", cfirange);\r\n\t\t\tthis.emit(\"selectedRange\", range);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nContents.prototype.range = function(_cfi, ignoreClass){\r\n\tvar cfi = new EpubCFI(_cfi);\r\n\treturn cfi.toRange(this.document, ignoreClass);\r\n};\r\n\r\nContents.prototype.map = function(layout){\r\n\tvar map = new Mapping(layout);\r\n\treturn map.section();\r\n};\r\n\r\nContents.prototype.size = function(width, height){\r\n\r\n\tif (width >= 0) {\r\n\t\tthis.width(width);\r\n\t}\r\n\r\n\tif (height >= 0) {\r\n\t\tthis.height(height);\r\n\t}\r\n\r\n\tthis.css(\"margin\", \"0\");\r\n\tthis.css(\"boxSizing\", \"border-box\");\r\n\r\n};\r\n\r\nContents.prototype.columns = function(width, height, columnWidth, gap){\r\n\tvar COLUMN_AXIS = core.prefixed('columnAxis');\r\n\tvar COLUMN_GAP = core.prefixed('columnGap');\r\n\tvar COLUMN_WIDTH = core.prefixed('columnWidth');\r\n\tvar COLUMN_FILL = core.prefixed('columnFill');\r\n\tvar textWidth;\r\n\r\n\tthis.width(width);\r\n\tthis.height(height);\r\n\r\n\t// Deal with Mobile trying to scale to viewport\r\n\tthis.viewport({ width: width, height: height, scale: 1.0 });\r\n\r\n\t// this.overflowY(\"hidden\");\r\n\tthis.css(\"overflowY\", \"hidden\");\r\n\tthis.css(\"margin\", \"0\");\r\n\tthis.css(\"boxSizing\", \"border-box\");\r\n\tthis.css(\"maxWidth\", \"inherit\");\r\n\r\n\tthis.css(COLUMN_AXIS, \"horizontal\");\r\n\tthis.css(COLUMN_FILL, \"auto\");\r\n\r\n\tthis.css(COLUMN_GAP, gap+\"px\");\r\n\tthis.css(COLUMN_WIDTH, columnWidth+\"px\");\r\n};\r\n\r\nContents.prototype.scale = function(scale, offsetX, offsetY){\r\n\tvar scale = \"scale(\" + scale + \")\";\r\n\tvar translate = '';\r\n\t// this.css(\"position\", \"absolute\"));\r\n\tthis.css(\"transformOrigin\", \"top left\");\r\n\r\n\tif (offsetX >= 0 || offsetY >= 0) {\r\n\t\ttranslate = \" translate(\" + (offsetX || 0 )+ \"px, \" + (offsetY || 0 )+ \"px )\";\r\n\t}\r\n\r\n\tthis.css(\"transform\", scale + translate);\r\n};\r\n\r\nContents.prototype.fit = function(width, height){\r\n\tvar viewport = this.viewport();\r\n\tvar widthScale = width / viewport.width;\r\n\tvar heightScale = height / viewport.height;\r\n\tvar scale = widthScale < heightScale ? widthScale : heightScale;\r\n\r\n\tvar offsetY = (height - (viewport.height * scale)) / 2;\r\n\r\n\tthis.width(width);\r\n\tthis.height(height);\r\n\tthis.overflow(\"hidden\");\r\n\r\n\t// Deal with Mobile trying to scale to viewport\r\n\tthis.viewport({ scale: 1.0 });\r\n\r\n\t// Scale to the correct size\r\n\tthis.scale(scale, 0, offsetY);\r\n\r\n\tthis.css(\"backgroundColor\", \"transparent\");\r\n};\r\n\r\nContents.prototype.mapPage = function(cfiBase, start, end) {\r\n\tvar mapping = new Mapping();\r\n\r\n\treturn mapping.page(this, cfiBase, start, end);\r\n};\r\n\r\nContents.prototype.destroy = function() {\r\n\t// Stop observing\r\n\tif(this.observer) {\r\n\t\tthis.observer.disconnect();\r\n\t}\r\n\r\n\tthis.removeListeners();\r\n\r\n};\r\n\r\nEventEmitter(Contents.prototype);\r\n\r\nmodule.exports = Contents;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/contents.js\n// module id = 11\n// module chunks = 0","var EventEmitter = require('event-emitter');\r\nvar core = require('../../core');\r\nvar EpubCFI = require('../../epubcfi');\r\nvar Mapping = require('../../mapping');\r\nvar Queue = require('../../queue');\r\nvar Stage = require('../helpers/stage');\r\nvar Views = require('../helpers/views');\r\n\r\nfunction DefaultViewManager(options) {\r\n\r\n\tthis.name = \"default\";\r\n\tthis.View = options.view;\r\n\tthis.request = options.request;\r\n\tthis.renditionQueue = options.queue;\r\n\tthis.q = new Queue(this);\r\n\r\n\tthis.settings = core.extend(this.settings || {}, {\r\n\t\tinfinite: true,\r\n\t\thidden: false,\r\n\t\twidth: undefined,\r\n\t\theight: undefined,\r\n\t\t// globalLayoutProperties : { layout: 'reflowable', spread: 'auto', orientation: 'auto'},\r\n\t\t// layout: null,\r\n\t\taxis: \"vertical\",\r\n\t\tignoreClass: ''\r\n\t});\r\n\r\n\tcore.extend(this.settings, options.settings || {});\r\n\r\n\tthis.viewSettings = {\r\n\t\tignoreClass: this.settings.ignoreClass,\r\n\t\taxis: this.settings.axis,\r\n\t\tlayout: this.layout,\r\n\t\twidth: 0,\r\n\t\theight: 0\r\n\t};\r\n\r\n}\r\n\r\nDefaultViewManager.prototype.render = function(element, size){\r\n\r\n\t// Save the stage\r\n\tthis.stage = new Stage({\r\n\t\twidth: size.width,\r\n\t\theight: size.height,\r\n\t\toverflow: this.settings.overflow,\r\n\t\thidden: this.settings.hidden,\r\n\t\taxis: this.settings.axis\r\n\t});\r\n\r\n\tthis.stage.attachTo(element);\r\n\r\n\t// Get this stage container div\r\n\tthis.container = this.stage.getContainer();\r\n\r\n\t// Views array methods\r\n\tthis.views = new Views(this.container);\r\n\r\n\t// Calculate Stage Size\r\n\tthis._bounds = this.bounds();\r\n\tthis._stageSize = this.stage.size();\r\n\r\n\t// Set the dimensions for views\r\n\tthis.viewSettings.width = this._stageSize.width;\r\n\tthis.viewSettings.height = this._stageSize.height;\r\n\r\n\t// Function to handle a resize event.\r\n\t// Will only attach if width and height are both fixed.\r\n\tthis.stage.onResize(this.onResized.bind(this));\r\n\r\n\t// Add Event Listeners\r\n\tthis.addEventListeners();\r\n\r\n\t// Add Layout method\r\n\t// this.applyLayoutMethod();\r\n\tif (this.layout) {\r\n\t\tthis.updateLayout();\r\n\t}\r\n};\r\n\r\nDefaultViewManager.prototype.addEventListeners = function(){\r\n\twindow.addEventListener('unload', function(e){\r\n\t\tthis.destroy();\r\n\t}.bind(this));\r\n};\r\n\r\nDefaultViewManager.prototype.destroy = function(){\r\n\t// this.views.each(function(view){\r\n\t// \tview.destroy();\r\n\t// });\r\n\r\n\t/*\r\n\r\n\t\tclearTimeout(this.trimTimeout);\r\n\t\tif(this.settings.hidden) {\r\n\t\t\tthis.element.removeChild(this.wrapper);\r\n\t\t} else {\r\n\t\t\tthis.element.removeChild(this.container);\r\n\t\t}\r\n\t*/\r\n};\r\n\r\nDefaultViewManager.prototype.onResized = function(e) {\r\n\tclearTimeout(this.resizeTimeout);\r\n\tthis.resizeTimeout = setTimeout(function(){\r\n\t\tthis.resize();\r\n\t}.bind(this), 150);\r\n};\r\n\r\nDefaultViewManager.prototype.resize = function(width, height){\r\n\r\n\t// Clear the queue\r\n\tthis.q.clear();\r\n\r\n\tthis._stageSize = this.stage.size(width, height);\r\n\tthis._bounds = this.bounds();\r\n\r\n\t// Update for new views\r\n\tthis.viewSettings.width = this._stageSize.width;\r\n\tthis.viewSettings.height = this._stageSize.height;\r\n\r\n\t// Update for existing views\r\n\tthis.views.each(function(view) {\r\n\t\tview.size(this._stageSize.width, this._stageSize.height);\r\n\t}.bind(this));\r\n\r\n\tthis.updateLayout();\r\n\r\n\tthis.emit(\"resized\", {\r\n\t\twidth: this.stage.width,\r\n\t\theight: this.stage.height\r\n\t});\r\n\r\n};\r\n\r\nDefaultViewManager.prototype.createView = function(section) {\r\n\treturn new this.View(section, this.viewSettings);\r\n};\r\n\r\nDefaultViewManager.prototype.display = function(section, target){\r\n\r\n\tvar displaying = new core.defer();\r\n\tvar displayed = displaying.promise;\r\n\r\n\t// Check to make sure the section we want isn't already shown\r\n\tvar visible = this.views.find(section);\r\n\r\n\t// View is already shown, just move to correct location\r\n\tif(visible && target) {\r\n\t\toffset = visible.locationOf(target);\r\n\t\tthis.moveTo(offset);\r\n\t\tdisplaying.resolve();\r\n\t\treturn displayed;\r\n\t}\r\n\r\n\t// Hide all current views\r\n\tthis.views.hide();\r\n\r\n\tthis.views.clear();\r\n\r\n\tthis.add(section)\r\n\t\t.then(function(view){\r\n\r\n\t\t\t// Move to correct place within the section, if needed\r\n\t\t\tif(target) {\r\n\t\t\t\toffset = view.locationOf(target);\r\n\t\t\t\tthis.moveTo(offset);\r\n\t\t\t}\r\n\r\n\t\t}.bind(this))\r\n\t\t.then(function(){\r\n\t\t\tvar next;\r\n\t\t\tif (this.layout.name === \"pre-paginated\" &&\r\n\t\t\t\t\tthis.layout.divisor > 1) {\r\n\t\t\t\tnext = section.next();\r\n\t\t\t\tif (next) {\r\n\t\t\t\t\treturn this.add(next);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}.bind(this))\r\n\t\t.then(function(){\r\n\r\n\t\t\tthis.views.show();\r\n\r\n\t\t\tdisplaying.resolve();\r\n\r\n\t\t}.bind(this))\r\n\t\t// .then(function(){\r\n\t\t// \treturn this.hooks.display.trigger(view);\r\n\t\t// }.bind(this))\r\n\t\t// .then(function(){\r\n\t\t// \tthis.views.show();\r\n\t\t// }.bind(this));\r\n\t\treturn displayed;\r\n};\r\n\r\nDefaultViewManager.prototype.afterDisplayed = function(view){\r\n\tthis.emit(\"added\", view);\r\n};\r\n\r\nDefaultViewManager.prototype.afterResized = function(view){\r\n\tthis.emit(\"resize\", view.section);\r\n};\r\n\r\n// DefaultViewManager.prototype.moveTo = function(offset){\r\n// \tthis.scrollTo(offset.left, offset.top);\r\n// };\r\n\r\nDefaultViewManager.prototype.moveTo = function(offset){\r\n\tvar distX = 0,\r\n\t\t\tdistY = 0;\r\n\r\n\tif(this.settings.axis === \"vertical\") {\r\n\t\tdistY = offset.top;\r\n\t} else {\r\n\t\tdistX = Math.floor(offset.left / this.layout.delta) * this.layout.delta;\r\n\r\n\t\tif (distX + this.layout.delta > this.container.scrollWidth) {\r\n\t\t\tdistX = this.container.scrollWidth - this.layout.delta;\r\n\t\t}\r\n\t}\r\n\r\n\tthis.scrollTo(distX, distY);\r\n};\r\n\r\nDefaultViewManager.prototype.add = function(section){\r\n\tvar view = this.createView(section);\r\n\r\n\tthis.views.append(view);\r\n\r\n\t// view.on(\"shown\", this.afterDisplayed.bind(this));\r\n\tview.onDisplayed = this.afterDisplayed.bind(this);\r\n\tview.onResize = this.afterResized.bind(this);\r\n\r\n\treturn view.display(this.request);\r\n\r\n};\r\n\r\nDefaultViewManager.prototype.append = function(section){\r\n\tvar view = this.createView(section);\r\n\tthis.views.append(view);\r\n\treturn view.display(this.request);\r\n};\r\n\r\nDefaultViewManager.prototype.prepend = function(section){\r\n\tvar view = this.createView(section);\r\n\r\n\tthis.views.prepend(view);\r\n\treturn view.display(this.request);\r\n};\r\n// DefaultViewManager.prototype.resizeView = function(view) {\r\n//\r\n// \tif(this.settings.globalLayoutProperties.layout === \"pre-paginated\") {\r\n// \t\tview.lock(\"both\", this.bounds.width, this.bounds.height);\r\n// \t} else {\r\n// \t\tview.lock(\"width\", this.bounds.width, this.bounds.height);\r\n// \t}\r\n//\r\n// };\r\n\r\nDefaultViewManager.prototype.next = function(){\r\n\tvar next;\r\n\tvar view;\r\n\tvar left;\r\n\r\n\tif(!this.views.length) return;\r\n\r\n\tif(this.settings.axis === \"horizontal\") {\r\n\r\n\t\tthis.scrollLeft = this.container.scrollLeft;\r\n\r\n\t\tleft = this.container.scrollLeft + this.container.offsetWidth + this.layout.delta;\r\n\r\n\t\tif(left < this.container.scrollWidth) {\r\n\t\t\tthis.scrollBy(this.layout.delta, 0);\r\n\t\t} else if (left - this.layout.columnWidth === this.container.scrollWidth) {\r\n\t\t\tthis.scrollTo(this.container.scrollWidth - this.layout.delta, 0);\r\n\t\t} else {\r\n\t\t\tnext = this.views.last().section.next();\r\n\t\t}\r\n\r\n\r\n\t} else {\r\n\r\n\t\tnext = this.views.last().section.next();\r\n\r\n\t}\r\n\r\n\tif(next) {\r\n\t\tthis.views.clear();\r\n\r\n\t\treturn this.append(next)\r\n\t\t\t.then(function(){\r\n\t\t\t\tvar right;\r\n\t\t\t\tif (this.layout.name && this.layout.divisor > 1) {\r\n\t\t\t\t\tright = next.next();\r\n\t\t\t\t\tif (right) {\r\n\t\t\t\t\t\treturn this.append(right);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}.bind(this))\r\n\t\t\t.then(function(){\r\n\t\t\t\tthis.views.show();\r\n\t\t\t}.bind(this));\r\n\t}\r\n\r\n\r\n};\r\n\r\nDefaultViewManager.prototype.prev = function(){\r\n\tvar prev;\r\n\tvar view;\r\n\tvar left;\r\n\r\n\tif(!this.views.length) return;\r\n\r\n\tif(this.settings.axis === \"horizontal\") {\r\n\r\n\t\tthis.scrollLeft = this.container.scrollLeft;\r\n\r\n\t\tleft = this.container.scrollLeft;\r\n\r\n\t\tif(left > 0) {\r\n\t\t\tthis.scrollBy(-this.layout.delta, 0);\r\n\t\t} else {\r\n\t\t\tprev = this.views.first().section.prev();\r\n\t\t}\r\n\r\n\r\n\t} else {\r\n\r\n\t\tprev = this.views.first().section.prev();\r\n\r\n\t}\r\n\r\n\tif(prev) {\r\n\t\tthis.views.clear();\r\n\r\n\t\treturn this.prepend(prev)\r\n\t\t\t.then(function(){\r\n\t\t\t\tvar left;\r\n\t\t\t\tif (this.layout.name && this.layout.divisor > 1) {\r\n\t\t\t\t\tleft = prev.prev();\r\n\t\t\t\t\tif (left) {\r\n\t\t\t\t\t\treturn this.prepend(left);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}.bind(this))\r\n\t\t\t.then(function(){\r\n\t\t\t\tif(this.settings.axis === \"horizontal\") {\r\n\t\t\t\t\tthis.scrollTo(this.container.scrollWidth - this.layout.delta, 0);\r\n\t\t\t\t}\r\n\t\t\t\tthis.views.show();\r\n\t\t\t}.bind(this));\r\n\t}\r\n};\r\n\r\nDefaultViewManager.prototype.current = function(){\r\n\tvar visible = this.visible();\r\n\tif(visible.length){\r\n\t\t// Current is the last visible view\r\n\t\treturn visible[visible.length-1];\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nDefaultViewManager.prototype.currentLocation = function(){\r\n\r\n\tif (this.settings.axis === \"vertical\") {\r\n\t\tthis.location = this.scrolledLocation();\r\n\t} else {\r\n\t\tthis.location = this.paginatedLocation();\r\n\t}\r\n\treturn this.location;\r\n};\r\n\r\nDefaultViewManager.prototype.scrolledLocation = function(){\r\n\tvar view;\r\n\r\n\tif(this.views.length) {\r\n\t\tview = this.views.first();\r\n\t\treturn this.mapping.page(view, view.section.cfiBase);\r\n\t}\r\n\r\n};\r\n\r\nDefaultViewManager.prototype.paginatedLocation = function(){\r\n\tvar view;\r\n\tvar start, end;\r\n\r\n\tif(this.views.length) {\r\n\t\tview = this.views.first();\r\n\t\tstart = this._bounds.left - view.position().left;\r\n\t\tend = start + this.layout.spreadWidth;\r\n\t\treturn this.mapping.page(view, view.section.cfiBase, start, end);\r\n\t}\r\n\r\n};\r\n\r\nDefaultViewManager.prototype.isVisible = function(view, offsetPrev, offsetNext, _container){\r\n\tvar position = view.position();\r\n\tvar container = _container || this.bounds();\r\n\r\n\tif(this.settings.axis === \"horizontal\" &&\r\n\t\tposition.right > container.left - offsetPrev &&\r\n\t\tposition.left < container.right + offsetNext) {\r\n\r\n\t\treturn true;\r\n\r\n\t} else if(this.settings.axis === \"vertical\" &&\r\n\t\tposition.bottom > container.top - offsetPrev &&\r\n\t\tposition.top < container.bottom + offsetNext) {\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n\r\n};\r\n\r\nDefaultViewManager.prototype.visible = function(){\r\n\t// return this.views.displayed();\r\n\tvar container = this.bounds();\r\n\tvar views = this.views.displayed();\r\n\tvar viewsLength = views.length;\r\n\tvar visible = [];\r\n\tvar isVisible;\r\n\tvar view;\r\n\r\n\tfor (var i = 0; i < viewsLength; i++) {\r\n\t\tview = views[i];\r\n\t\tisVisible = this.isVisible(view, 0, 0, container);\r\n\r\n\t\tif(isVisible === true) {\r\n\t\t\tvisible.push(view);\r\n\t\t}\r\n\r\n\t}\r\n\treturn visible;\r\n};\r\n\r\nDefaultViewManager.prototype.scrollBy = function(x, y, silent){\r\n\tif(silent) {\r\n\t\tthis.ignore = true;\r\n\t}\r\n\r\n\tif(this.settings.height) {\r\n\r\n\t\tif(x) this.container.scrollLeft += x;\r\n\t\tif(y) this.container.scrollTop += y;\r\n\r\n\t} else {\r\n\t\twindow.scrollBy(x,y);\r\n\t}\r\n\t// console.log(\"scrollBy\", x, y);\r\n\tthis.scrolled = true;\r\n\tthis.onScroll();\r\n};\r\n\r\nDefaultViewManager.prototype.scrollTo = function(x, y, silent){\r\n\tif(silent) {\r\n\t\tthis.ignore = true;\r\n\t}\r\n\r\n\tif(this.settings.height) {\r\n\t\tthis.container.scrollLeft = x;\r\n\t\tthis.container.scrollTop = y;\r\n\t} else {\r\n\t\twindow.scrollTo(x,y);\r\n\t}\r\n\t// console.log(\"scrollTo\", x, y);\r\n\tthis.scrolled = true;\r\n\tthis.onScroll();\r\n\t// if(this.container.scrollLeft != x){\r\n\t//   setTimeout(function() {\r\n\t//     this.scrollTo(x, y, silent);\r\n\t//   }.bind(this), 10);\r\n\t//   return;\r\n\t// };\r\n };\r\n\r\nDefaultViewManager.prototype.onScroll = function(){\r\n\r\n};\r\n\r\nDefaultViewManager.prototype.bounds = function() {\r\n\tvar bounds;\r\n\r\n\tbounds = this.stage.bounds();\r\n\r\n\treturn bounds;\r\n};\r\n\r\nDefaultViewManager.prototype.applyLayout = function(layout) {\r\n\r\n\tthis.layout = layout;\r\n\tthis.updateLayout();\r\n\r\n\tthis.mapping = new Mapping(this.layout);\r\n\t // this.manager.layout(this.layout.format);\r\n};\r\n\r\nDefaultViewManager.prototype.updateLayout = function() {\r\n\tif (!this.stage) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tthis._stageSize = this.stage.size();\r\n\r\n\tif(this.settings.axis === \"vertical\") {\r\n\t\tthis.layout.calculate(this._stageSize.width, this._stageSize.height);\r\n\t} else {\r\n\t\tthis.layout.calculate(\r\n\t\t\tthis._stageSize.width,\r\n\t\t\tthis._stageSize.height,\r\n\t\t\tthis.settings.gap\r\n\t\t);\r\n\r\n\t\t// Set the look ahead offset for what is visible\r\n\t\tthis.settings.offset = this.layout.delta;\r\n\r\n\t\tthis.stage.addStyleRules(\"iframe\", [{\"margin-right\" : this.layout.gap + \"px\"}]);\r\n\r\n\t}\r\n\r\n\t// Set the dimensions for views\r\n\tthis.viewSettings.width = this.layout.width;\r\n\tthis.viewSettings.height = this.layout.height;\r\n\r\n\tthis.setLayout(this.layout);\r\n\r\n};\r\n\r\nDefaultViewManager.prototype.setLayout = function(layout){\r\n\r\n\tthis.viewSettings.layout = layout;\r\n\r\n\tif(this.views) {\r\n\r\n\t\tthis.views.each(function(view){\r\n\t\t\tview.setLayout(layout);\r\n\t\t});\r\n\r\n\t}\r\n\r\n};\r\n\r\nDefaultViewManager.prototype.updateFlow = function(flow){\r\n\tvar axis = (flow === \"paginated\") ? \"horizontal\" : \"vertical\";\r\n\r\n\tthis.settings.axis = axis;\r\n\r\n\tthis.viewSettings.axis = axis;\r\n\r\n\tthis.settings.overflow = (flow === \"paginated\") ? \"hidden\" : \"auto\";\r\n\t// this.views.each(function(view){\r\n\t// \tview.setAxis(axis);\r\n\t// });\r\n\r\n};\r\n\r\n //-- Enable binding events to Manager\r\n EventEmitter(DefaultViewManager.prototype);\r\n\r\n module.exports = DefaultViewManager;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/managers/default/index.js\n// module id = 12\n// module chunks = 0","var EventEmitter = require('event-emitter');\r\nvar path = require('path');\r\nvar core = require('./core');\r\nvar replace = require('./replacements');\r\nvar Hook = require('./hook');\r\nvar EpubCFI = require('./epubcfi');\r\nvar Queue = require('./queue');\r\nvar Layout = require('./layout');\r\nvar Mapping = require('./mapping');\r\nvar Path = require('./core').Path;\r\n\r\n/**\r\n * [Rendition description]\r\n * @class\r\n * @param {Book} book\r\n * @param {object} options\r\n * @param {int} options.width\r\n * @param {int} options.height\r\n * @param {string} options.ignoreClass\r\n * @param {string} options.manager\r\n * @param {string} options.view\r\n * @param {string} options.layout\r\n * @param {string} options.spread\r\n * @param {int} options.minSpreadWidth overridden by spread: none (never) / both (always)\r\n */\r\nfunction Rendition(book, options) {\r\n\r\n\tthis.settings = core.extend(this.settings || {}, {\r\n\t\twidth: null,\r\n\t\theight: null,\r\n\t\tignoreClass: '',\r\n\t\tmanager: \"default\",\r\n\t\tview: \"iframe\",\r\n\t\tflow: null,\r\n\t\tlayout: null,\r\n\t\tspread: null,\r\n\t\tminSpreadWidth: 800\r\n\t});\r\n\r\n\tcore.extend(this.settings, options);\r\n\r\n\tif (typeof(this.settings.manager) === \"object\") {\r\n\t\tthis.manager = this.settings.manager;\r\n\t}\r\n\r\n\tthis.viewSettings = {\r\n\t\tignoreClass: this.settings.ignoreClass\r\n\t};\r\n\r\n\tthis.book = book;\r\n\r\n\tthis.views = null;\r\n\r\n\t/**\r\n\t * Adds Hook methods to the Rendition prototype\r\n\t * @property {Hook} hooks\r\n\t */\r\n\tthis.hooks = {};\r\n\tthis.hooks.display = new Hook(this);\r\n\tthis.hooks.serialize = new Hook(this);\r\n\t/**\r\n\t * @property {method} hooks.content\r\n\t * @type {Hook}\r\n\t */\r\n\tthis.hooks.content = new Hook(this);\r\n\tthis.hooks.layout = new Hook(this);\r\n\tthis.hooks.render = new Hook(this);\r\n\tthis.hooks.show = new Hook(this);\r\n\r\n\tthis.hooks.content.register(replace.links.bind(this));\r\n\tthis.hooks.content.register(this.passViewEvents.bind(this));\r\n\r\n\t// this.hooks.display.register(this.afterDisplay.bind(this));\r\n\r\n\tthis.epubcfi = new EpubCFI();\r\n\r\n\tthis.q = new Queue(this);\r\n\r\n\tthis.q.enqueue(this.book.opened);\r\n\r\n\t// Block the queue until rendering is started\r\n\tthis.starting = new core.defer();\r\n\tthis.started = this.starting.promise;\r\n\tthis.q.enqueue(this.start);\r\n};\r\n\r\n/**\r\n * Set the manager function\r\n * @param {function} manager\r\n */\r\nRendition.prototype.setManager = function(manager) {\r\n\tthis.manager = manager;\r\n};\r\n\r\n/**\r\n * Require the manager from passed string, or as a function\r\n * @param  {string|function} manager [description]\r\n * @return {method}\r\n */\r\nRendition.prototype.requireManager = function(manager) {\r\n\tvar viewManager;\r\n\r\n\t// If manager is a string, try to load from register managers,\r\n\t// or require included managers directly\r\n\tif (typeof manager === \"string\") {\r\n\t\t// Use global or require\r\n\t\tviewManager = typeof ePub != \"undefined\" ? ePub.ViewManagers[manager] : undefined; //require('./managers/'+manager);\r\n\t} else {\r\n\t\t// otherwise, assume we were passed a function\r\n\t\tviewManager = manager\r\n\t}\r\n\r\n\treturn viewManager;\r\n};\r\n\r\n/**\r\n * Require the view from passed string, or as a function\r\n * @param  {string|function} view\r\n * @return {view}\r\n */\r\nRendition.prototype.requireView = function(view) {\r\n\tvar View;\r\n\r\n\tif (typeof view == \"string\") {\r\n\t\tView = typeof ePub != \"undefined\" ? ePub.Views[view] : undefined; //require('./views/'+view);\r\n\t} else {\r\n\t\t// otherwise, assume we were passed a function\r\n\t\tView = view\r\n\t}\r\n\r\n\treturn View;\r\n};\r\n\r\n/**\r\n * Start the rendering\r\n * @return {Promise} rendering has started\r\n */\r\nRendition.prototype.start = function(){\r\n\r\n\tif(!this.manager) {\r\n\t\tthis.ViewManager = this.requireManager(this.settings.manager);\r\n\t\tthis.View = this.requireView(this.settings.view);\r\n\r\n\t\tthis.manager = new this.ViewManager({\r\n\t\t\tview: this.View,\r\n\t\t\tqueue: this.q,\r\n\t\t\trequest: this.book.load.bind(this.book),\r\n\t\t\tsettings: this.settings\r\n\t\t});\r\n\t}\r\n\r\n\t// Parse metadata to get layout props\r\n\tthis.settings.globalLayoutProperties = this.determineLayoutProperties(this.book.package.metadata);\r\n\r\n\tthis.flow(this.settings.globalLayoutProperties.flow);\r\n\r\n\tthis.layout(this.settings.globalLayoutProperties);\r\n\r\n\t// Listen for displayed views\r\n\tthis.manager.on(\"added\", this.afterDisplayed.bind(this));\r\n\r\n\t// Listen for resizing\r\n\tthis.manager.on(\"resized\", this.onResized.bind(this));\r\n\r\n\t// Listen for scroll changes\r\n\tthis.manager.on(\"scroll\", this.reportLocation.bind(this));\r\n\r\n\r\n\tthis.on('displayed', this.reportLocation.bind(this));\r\n\r\n\t// Trigger that rendering has started\r\n\tthis.emit(\"started\");\r\n\r\n\t// Start processing queue\r\n\tthis.starting.resolve();\r\n};\r\n\r\n/**\r\n * Call to attach the container to an element in the dom\r\n * Container must be attached before rendering can begin\r\n * @param  {element} element to attach to\r\n * @return {Promise}\r\n */\r\nRendition.prototype.attachTo = function(element){\r\n\r\n\treturn this.q.enqueue(function () {\r\n\r\n\t\t// Start rendering\r\n\t\tthis.manager.render(element, {\r\n\t\t\t\"width\"  : this.settings.width,\r\n\t\t\t\"height\" : this.settings.height\r\n\t\t});\r\n\r\n\t\t// Trigger Attached\r\n\t\tthis.emit(\"attached\");\r\n\r\n\t}.bind(this));\r\n\r\n};\r\n\r\n/**\r\n * Display a point in the book\r\n * The request will be added to the rendering Queue,\r\n * so it will wait until book is opened, rendering started\r\n * and all other rendering tasks have finished to be called.\r\n * @param  {string} target Url or EpubCFI\r\n * @return {Promise}\r\n */\r\nRendition.prototype.display = function(target){\r\n\r\n\treturn this.q.enqueue(this._display, target);\r\n\r\n};\r\n\r\n/**\r\n * Tells the manager what to display immediately\r\n * @private\r\n * @param  {string} target Url or EpubCFI\r\n * @return {Promise}\r\n */\r\nRendition.prototype._display = function(target){\r\n\tvar isCfiString = this.epubcfi.isCfiString(target);\r\n\tvar displaying = new core.defer();\r\n\tvar displayed = displaying.promise;\r\n\tvar section;\r\n\tvar moveTo;\r\n\r\n\t// Check if this is a book percentage\r\n\tif (this.book.locations.length && core.isFloat(target)) {\r\n\t\tconsole.log(\"percentage\", target);\r\n\t\ttarget = book.locations.cfiFromPercentage(target);\r\n\t\tconsole.log(\"cfi\", target);\r\n\t}\r\n\r\n\tsection = this.book.spine.get(target);\r\n\r\n\tif(!section){\r\n\t\tdisplaying.reject(new Error(\"No Section Found\"));\r\n\t\treturn displayed;\r\n\t}\r\n\r\n\tmoveTo = target;\r\n\t\r\n\treturn this.manager.display(section, moveTo)\r\n\t\t.then(function(){\r\n\t\t\t// this.emit(\"displayed\", section);\r\n\t\t}.bind(this));\r\n\r\n};\r\n\r\n/*\r\nRendition.prototype.render = function(view, show) {\r\n\r\n\t// view.onLayout = this.layout.format.bind(this.layout);\r\n\tview.create();\r\n\r\n\t// Fit to size of the container, apply padding\r\n\tthis.manager.resizeView(view);\r\n\r\n\t// Render Chain\r\n\treturn view.section.render(this.book.request)\r\n\t\t.then(function(contents){\r\n\t\t\treturn view.load(contents);\r\n\t\t}.bind(this))\r\n\t\t.then(function(doc){\r\n\t\t\treturn this.hooks.content.trigger(view, this);\r\n\t\t}.bind(this))\r\n\t\t.then(function(){\r\n\t\t\tthis.layout.format(view.contents);\r\n\t\t\treturn this.hooks.layout.trigger(view, this);\r\n\t\t}.bind(this))\r\n\t\t.then(function(){\r\n\t\t\treturn view.display();\r\n\t\t}.bind(this))\r\n\t\t.then(function(){\r\n\t\t\treturn this.hooks.render.trigger(view, this);\r\n\t\t}.bind(this))\r\n\t\t.then(function(){\r\n\t\t\tif(show !== false) {\r\n\t\t\t\tthis.q.enqueue(function(view){\r\n\t\t\t\t\tview.show();\r\n\t\t\t\t}, view);\r\n\t\t\t}\r\n\t\t\t// this.map = new Map(view, this.layout);\r\n\t\t\tthis.hooks.show.trigger(view, this);\r\n\t\t\tthis.trigger(\"rendered\", view.section);\r\n\r\n\t\t}.bind(this))\r\n\t\t.catch(function(e){\r\n\t\t\tthis.trigger(\"loaderror\", e);\r\n\t\t}.bind(this));\r\n\r\n};\r\n*/\r\n\r\n/**\r\n * Report what has been displayed\r\n * @private\r\n * @param  {*} view\r\n */\r\nRendition.prototype.afterDisplayed = function(view){\r\n\tthis.hooks.content.trigger(view, this);\r\n\tthis.emit(\"rendered\", view.section);\r\n\tthis.reportLocation();\r\n};\r\n\r\n/**\r\n * Report resize events and display the last seen location\r\n * @private\r\n */\r\nRendition.prototype.onResized = function(size){\r\n\r\n\tif(this.location) {\r\n\t\tthis.display(this.location.start);\r\n\t}\r\n\r\n\tthis.emit(\"resized\", {\r\n\t\twidth: size.width,\r\n\t\theight: size.height\r\n\t});\r\n\r\n};\r\n\r\n/**\r\n * Move the Rendition to a specific offset\r\n * Usually you would be better off calling display()\r\n * @param {object} offset\r\n */\r\nRendition.prototype.moveTo = function(offset){\r\n\tthis.manager.moveTo(offset);\r\n};\r\n\r\n/**\r\n * Go to the next \"page\" in the rendition\r\n * @return {Promise}\r\n */\r\nRendition.prototype.next = function(){\r\n\treturn this.q.enqueue(this.manager.next.bind(this.manager))\r\n\t\t.then(this.reportLocation.bind(this));\r\n};\r\n\r\n/**\r\n * Go to the previous \"page\" in the rendition\r\n * @return {Promise}\r\n */\r\nRendition.prototype.prev = function(){\r\n\treturn this.q.enqueue(this.manager.prev.bind(this.manager))\r\n\t\t.then(this.reportLocation.bind(this));\r\n};\r\n\r\n//-- http://www.idpf.org/epub/301/spec/epub-publications.html#meta-properties-rendering\r\n/**\r\n * Determine the Layout properties from metadata and settings\r\n * @private\r\n * @param  {object} metadata\r\n * @return {object} properties\r\n */\r\nRendition.prototype.determineLayoutProperties = function(metadata){\r\n\tvar properties;\r\n\tvar layout = this.settings.layout || metadata.layout || \"reflowable\";\r\n\tvar spread = this.settings.spread || metadata.spread || \"auto\";\r\n\tvar orientation = this.settings.orientation || metadata.orientation || \"auto\";\r\n\tvar flow = this.settings.flow || metadata.flow || \"auto\";\r\n\tvar viewport = metadata.viewport || \"\";\r\n\tvar minSpreadWidth = this.settings.minSpreadWidth || metadata.minSpreadWidth || 800;\r\n\r\n\tif (this.settings.width >= 0 && this.settings.height >= 0) {\r\n\t\tviewport = \"width=\"+this.settings.width+\", height=\"+this.settings.height+\"\";\r\n\t}\r\n\r\n\tproperties = {\r\n\t\tlayout : layout,\r\n\t\tspread : spread,\r\n\t\torientation : orientation,\r\n\t\tflow : flow,\r\n\t\tviewport : viewport,\r\n\t\tminSpreadWidth : minSpreadWidth\r\n\t};\r\n\r\n\treturn properties;\r\n};\r\n\r\n// Rendition.prototype.applyLayoutProperties = function(){\r\n// \tvar settings = this.determineLayoutProperties(this.book.package.metadata);\r\n//\r\n// \tthis.flow(settings.flow);\r\n//\r\n// \tthis.layout(settings);\r\n// };\r\n\r\n/**\r\n * Adjust the flow of the rendition to paginated or scrolled\r\n * (scrolled-continuous vs scrolled-doc are handled by different view managers)\r\n * @param  {string} flow\r\n */\r\nRendition.prototype.flow = function(flow){\r\n\tvar _flow;\r\n\tif (flow === \"scrolled-doc\" || flow === \"scrolled-continuous\") {\r\n\t\t_flow = \"scrolled\";\r\n\t}\r\n\r\n\tif (flow === \"auto\" || flow === \"paginated\") {\r\n\t\t_flow = \"paginated\";\r\n\t}\r\n\r\n\tif (this._layout) {\r\n\t\tthis._layout.flow(_flow);\r\n\t}\r\n\r\n\tif (this.manager) {\r\n\t\tthis.manager.updateFlow(_flow);\r\n\t}\r\n};\r\n\r\n/**\r\n * Adjust the layout of the rendition to reflowable or pre-paginated\r\n * @param  {object} settings\r\n */\r\nRendition.prototype.layout = function(settings){\r\n\tif (settings) {\r\n\t\tthis._layout = new Layout(settings);\r\n\t\tthis._layout.spread(settings.spread, this.settings.minSpreadWidth);\r\n\r\n\t\tthis.mapping = new Mapping(this._layout);\r\n\t}\r\n\r\n\tif (this.manager && this._layout) {\r\n\t\tthis.manager.applyLayout(this._layout);\r\n\t}\r\n\r\n\treturn this._layout;\r\n};\r\n\r\n/**\r\n * Adjust if the rendition uses spreads\r\n * @param  {string} spread none | auto (TODO: implement landscape, portrait, both)\r\n * @param  {int} min min width to use spreads at\r\n */\r\nRendition.prototype.spread = function(spread, min){\r\n\r\n\tthis._layout.spread(spread, min);\r\n\r\n\tif (this.manager.isRendered()) {\r\n\t\tthis.manager.updateLayout();\r\n\t}\r\n};\r\n\r\n/**\r\n * Report the current location\r\n * @private\r\n */\r\nRendition.prototype.reportLocation = function(){\r\n\treturn this.q.enqueue(function(){\r\n\t\tvar location = this.manager.currentLocation();\r\n\t\tif (location && location.then && typeof location.then === 'function') {\r\n\t\t\tlocation.then(function(result) {\r\n\t\t\t\tthis.location = result;\r\n\r\n\t\t\t\tthis.percentage = this.book.locations.percentageFromCfi(result);\r\n\t\t\t\tif (this.percentage != null) {\r\n\t\t\t\t\tthis.location.percentage = this.percentage;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.emit(\"locationChanged\", this.location);\r\n\t\t\t}.bind(this));\r\n\t\t} else if (location) {\r\n\t\t\tthis.location = location;\r\n\t\t\tthis.percentage = this.book.locations.percentageFromCfi(location);\r\n\t\t\tif (this.percentage != null) {\r\n\t\t\t\tthis.location.percentage = this.percentage;\r\n\t\t\t}\r\n\r\n\t\t\tthis.emit(\"locationChanged\", this.location);\r\n\t\t}\r\n\r\n\t}.bind(this));\r\n};\r\n\r\n/**\r\n * Get the Current Location CFI\r\n * @return {EpubCFI} location (may be a promise)\r\n */\r\nRendition.prototype.currentLocation = function(){\r\n\tvar location = this.manager.currentLocation();\r\n\tif (location && location.then && typeof location.then === 'function') {\r\n\t\tlocation.then(function(result) {\r\n\t\t\tvar percentage = this.book.locations.percentageFromCfi(result);\r\n\t\t\tif (percentage != null) {\r\n\t\t\t\tresult.percentage = percentage;\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}.bind(this));\r\n\t} else if (location) {\r\n\t\tvar percentage = this.book.locations.percentageFromCfi(location);\r\n\t\tif (percentage != null) {\r\n\t\t\tlocation.percentage = percentage;\r\n\t\t}\r\n\t\treturn location;\r\n\t}\r\n};\r\n\r\n/**\r\n * Remove and Clean Up the Rendition\r\n */\r\nRendition.prototype.destroy = function(){\r\n\t// Clear the queue\r\n\tthis.q.clear();\r\n\r\n\tthis.manager.destroy();\r\n};\r\n\r\n/**\r\n * Pass the events from a view\r\n * @private\r\n * @param  {View} view\r\n */\r\nRendition.prototype.passViewEvents = function(view){\r\n\tview.contents.listenedEvents.forEach(function(e){\r\n\t\tview.on(e, this.triggerViewEvent.bind(this));\r\n\t}.bind(this));\r\n\r\n\tview.on(\"selected\", this.triggerSelectedEvent.bind(this));\r\n};\r\n\r\n/**\r\n * Emit events passed by a view\r\n * @private\r\n * @param  {event} e\r\n */\r\nRendition.prototype.triggerViewEvent = function(e){\r\n\tthis.emit(e.type, e);\r\n};\r\n\r\n/**\r\n * Emit a selection event's CFI Range passed from a a view\r\n * @private\r\n * @param  {EpubCFI} cfirange\r\n */\r\nRendition.prototype.triggerSelectedEvent = function(cfirange){\r\n\tthis.emit(\"selected\", cfirange);\r\n};\r\n\r\n/**\r\n * Get a Range from a Visible CFI\r\n * @param  {string} cfi EpubCfi String\r\n * @param  {string} ignoreClass\r\n * @return {range}\r\n */\r\nRendition.prototype.range = function(cfi, ignoreClass){\r\n\tvar _cfi = new EpubCFI(cfi);\r\n\tvar found = this.visible().filter(function (view) {\r\n\t\tif(_cfi.spinePos === view.index) return true;\r\n\t});\r\n\r\n\t// Should only every return 1 item\r\n\tif (found.length) {\r\n\t\treturn found[0].range(_cfi, ignoreClass);\r\n\t}\r\n};\r\n\r\n/**\r\n * Hook to adjust images to fit in columns\r\n * @param  {View} view\r\n */\r\nRendition.prototype.adjustImages = function(view) {\r\n\r\n\tview.addStylesheetRules([\r\n\t\t\t[\"img\",\r\n\t\t\t\t[\"max-width\", (view.layout.spreadWidth) + \"px\"],\r\n\t\t\t\t[\"max-height\", (view.layout.height) + \"px\"]\r\n\t\t\t]\r\n\t]);\r\n\treturn new Promise(function(resolve, reject){\r\n\t\t// Wait to apply\r\n\t\tsetTimeout(function() {\r\n\t\t\tresolve();\r\n\t\t}, 1);\r\n\t});\r\n};\r\n\r\n//-- Enable binding events to Renderer\r\nEventEmitter(Rendition.prototype);\r\n\r\nmodule.exports = Rendition;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/rendition.js\n// module id = 13\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_14__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"xmldom\"\n// module id = 14\n// module chunks = 0","var EventEmitter = require('event-emitter');\r\nvar path = require('path');\r\nvar core = require('./core');\r\nvar Url = require('./core').Url;\r\nvar Path = require('./core').Path;\r\nvar Spine = require('./spine');\r\nvar Locations = require('./locations');\r\nvar Container = require('./container');\r\nvar Packaging = require('./packaging');\r\nvar Navigation = require('./navigation');\r\nvar Resources = require('./resources');\r\nvar PageList = require('./pagelist');\r\nvar Rendition = require('./rendition');\r\nvar Archive = require('./archive');\r\nvar request = require('./request');\r\nvar EpubCFI = require('./epubcfi');\r\n\r\n// Const\r\nvar CONTAINER_PATH = \"META-INF/container.xml\";\r\n\r\n/**\r\n * Creates a new Book\r\n * @class\r\n * @param {string} url\r\n * @param {object} options\r\n * @param {method} options.requestMethod a request function to use instead of the default\r\n * @param {boolean} [options.requestCredentials=undefined] send the xhr request withCredentials\r\n * @param {object} [options.requestHeaders=undefined] send the xhr request headers\r\n * @param {string} [options.encoding=binary] optional to pass 'binary' or base64' for archived Epubs\r\n * @param {string} [options.replacements=base64] use base64, blobUrl, or none for replacing assets in archived Epubs\r\n * @returns {Book}\r\n * @example new Book(\"/path/to/book.epub\", {})\r\n * @example new Book({ replacements: \"blobUrl\" })\r\n */\r\nfunction Book(url, options){\r\n\r\n\t// Allow passing just options to the Book\r\n\tif (typeof(options) === \"undefined\"\r\n\t\t&& typeof(url) === \"object\") {\r\n\t\toptions = url;\r\n\t\turl = undefined;\r\n\t}\r\n\r\n\tthis.settings = core.extend(this.settings || {}, {\r\n\t\trequestMethod: undefined,\r\n\t\trequestCredentials: undefined,\r\n\t\trequestHeaders: undefined,\r\n\t\tencoding: undefined,\r\n\t\treplacements: 'base64'\r\n\t});\r\n\r\n\tcore.extend(this.settings, options);\r\n\r\n\r\n\t// Promises\r\n\tthis.opening = new core.defer();\r\n\t/**\r\n\t * @property {promise} opened returns after the book is loaded\r\n\t */\r\n\tthis.opened = this.opening.promise;\r\n\tthis.isOpen = false;\r\n\r\n\tthis.loading = {\r\n\t\tmanifest: new core.defer(),\r\n\t\tspine: new core.defer(),\r\n\t\tmetadata: new core.defer(),\r\n\t\tcover: new core.defer(),\r\n\t\tnavigation: new core.defer(),\r\n\t\tpageList: new core.defer(),\r\n\t\tresources: new core.defer()\r\n\t};\r\n\r\n\tthis.loaded = {\r\n\t\tmanifest: this.loading.manifest.promise,\r\n\t\tspine: this.loading.spine.promise,\r\n\t\tmetadata: this.loading.metadata.promise,\r\n\t\tcover: this.loading.cover.promise,\r\n\t\tnavigation: this.loading.navigation.promise,\r\n\t\tpageList: this.loading.pageList.promise,\r\n\t\tresources: this.loading.resources.promise\r\n\t};\r\n\r\n\t// this.ready = RSVP.hash(this.loaded);\r\n\t/**\r\n\t * @property {promise} ready returns after the book is loaded and parsed\r\n\t * @private\r\n\t */\r\n\tthis.ready = Promise.all([this.loaded.manifest,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.loaded.spine,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.loaded.metadata,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.loaded.cover,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.loaded.navigation,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.loaded.resources ]);\r\n\r\n\r\n\t// Queue for methods used before opening\r\n\tthis.isRendered = false;\r\n\t// this._q = core.queue(this);\r\n\r\n\t/**\r\n\t * @property {method} request\r\n\t * @private\r\n\t */\r\n\tthis.request = this.settings.requestMethod || request;\r\n\r\n\t/**\r\n\t * @property {Spine} spine\r\n\t */\r\n\tthis.spine = new Spine();\r\n\r\n\t/**\r\n\t * @property {Locations} locations\r\n\t */\r\n\tthis.locations = new Locations(this.spine, this.load.bind(this));\r\n\r\n\t/**\r\n\t * @property {Navigation} navigation\r\n\t */\r\n\tthis.navigation = undefined;\r\n\r\n\t/**\r\n\t * @property {PageList} pagelist\r\n\t */\r\n\tthis.pageList = new PageList();\r\n\r\n\t/**\r\n\t * @property {Url} url\r\n\t * @private\r\n\t */\r\n\tthis.url = undefined;\r\n\r\n\t/**\r\n\t * @property {Path} path\r\n\t * @private\r\n\t */\r\n\tthis.path = undefined;\r\n\r\n\t/**\r\n\t * @property {boolean} archived\r\n\t * @private\r\n\t */\r\n\tthis.archived = false;\r\n\r\n\tif(url) {\r\n\t\tthis.open(url).catch(function (error) {\r\n\t\t\tvar err = new Error(\"Cannot load book at \"+ url );\r\n\t\t\tconsole.error(err);\r\n\t\t\tthis.emit(\"openFailed\", err);\r\n\t\t\tconsole.log(error);\r\n\t\t}.bind(this));\r\n\t}\r\n};\r\n\r\n/**\r\n * Open a epub or url\r\n * @param {string} input URL, Path or ArrayBuffer\r\n * @param {string} [what] to force opening\r\n * @returns {Promise} of when the book has been loaded\r\n * @example book.open(\"/path/to/book.epub\")\r\n */\r\nBook.prototype.open = function(input, what){\r\n\tvar opening;\r\n\tvar type = what || this.determineType(input);\r\n\r\n\tif (type === \"binary\") {\r\n\t\tthis.archived = true;\r\n\t\tthis.url = new Url(\"/\", \"\");\r\n\t\topening = this.openEpub(input);\r\n\t} else if (type === \"epub\") {\r\n\t\tthis.archived = true;\r\n\t\tthis.url = new Url(\"/\", \"\");\r\n\t\topening = this.request(input, 'binary')\r\n\t\t\t.then(this.openEpub.bind(this));\r\n\t} else if(type == \"opf\") {\r\n\t\tthis.url = new Url(input);\r\n\t\topening = this.openPackaging(this.url.Path.toString());\r\n\t} else {\r\n\t\tthis.url = new Url(input);\r\n\t\topening = this.openContainer(CONTAINER_PATH)\r\n\t\t\t.then(this.openPackaging.bind(this));\r\n\t}\r\n\r\n\treturn opening;\r\n};\r\n\r\n/**\r\n * Open an archived epub\r\n * @private\r\n * @param  {binary} data\r\n * @param  {[string]} encoding\r\n * @return {Promise}\r\n */\r\nBook.prototype.openEpub = function(data, encoding){\r\n\treturn this.unarchive(data, encoding || this.settings.encoding)\r\n\t\t.then(function() {\r\n\t\t\treturn this.openContainer(CONTAINER_PATH);\r\n\t\t}.bind(this))\r\n\t\t.then(function(packagePath) {\r\n\t\t\treturn this.openPackaging(packagePath);\r\n\t\t}.bind(this));\r\n};\r\n\r\n/**\r\n * Open the epub container\r\n * @private\r\n * @param  {string} url\r\n * @return {string} packagePath\r\n */\r\nBook.prototype.openContainer = function(url){\r\n\treturn this.load(url)\r\n\t\t.then(function(xml) {\r\n\t\t\tthis.container = new Container(xml);\r\n\t\t\treturn this.resolve(this.container.packagePath);\r\n\t\t}.bind(this));\r\n};\r\n\r\n/**\r\n * Open the Open Packaging Format Xml\r\n * @private\r\n * @param  {string} url\r\n * @return {Promise}\r\n */\r\nBook.prototype.openPackaging = function(url){\r\n\tvar packageUrl;\r\n\tthis.path = new Path(url);\r\n\treturn this.load(url)\r\n\t\t.then(function(xml) {\r\n\t\t\tthis.packaging = new Packaging(xml);\r\n\t\t\treturn this.unpack(this.packaging);\r\n\t\t}.bind(this));\r\n};\r\n\r\n/**\r\n * Load a resource from the Book\r\n * @param  {string} path path to the resource to load\r\n * @return {Promise}     returns a promise with the requested resource\r\n */\r\nBook.prototype.load = function (path) {\r\n\tvar resolved;\r\n\r\n\tif(this.archived) {\r\n\t\tresolved = this.resolve(path);\r\n\t\treturn this.archive.request(resolved);\r\n\t} else {\r\n\t\tresolved = this.resolve(path);\r\n\t\treturn this.request(resolved, null, this.settings.requestCredentials, this.settings.requestHeaders);\r\n\t}\r\n};\r\n\r\n/**\r\n * Resolve a path to it's absolute position in the Book\r\n * @param  {string} path\r\n * @param  {[boolean]} absolute force resolving the full URL\r\n * @return {string}          the resolved path string\r\n */\r\nBook.prototype.resolve = function (path, absolute) {\r\n\tvar resolved = path;\r\n\tvar isAbsolute = (path.indexOf('://') > -1);\r\n\r\n\tif (isAbsolute) {\r\n\t\treturn path;\r\n\t}\r\n\r\n\tif (this.path) {\r\n\t\tresolved = this.path.resolve(path);\r\n\t}\r\n\r\n\tif(absolute != false && this.url) {\r\n\t\tresolved = this.url.resolve(resolved);\r\n\t}\r\n\r\n\treturn resolved;\r\n}\r\n\r\n/**\r\n * Determine the type of they input passed to open\r\n * @private\r\n * @param  {string} input\r\n * @return {string}  binary | directory | epub | opf\r\n */\r\nBook.prototype.determineType = function(input) {\r\n\tvar url;\r\n\tvar path;\r\n\tvar extension;\r\n\r\n\tif (typeof(input) != \"string\") {\r\n\t\treturn \"binary\";\r\n\t}\r\n\r\n\turl = new Url(input);\r\n\tpath = url.path();\r\n\textension = path.extension;\r\n\r\n\tif (!extension) {\r\n\t\treturn \"directory\";\r\n\t}\r\n\r\n\tif(extension === \"epub\"){\r\n\t\treturn \"epub\";\r\n\t}\r\n\r\n\tif(extension === \"opf\"){\r\n\t\treturn \"opf\";\r\n\t}\r\n};\r\n\r\n\r\n/**\r\n * unpack the contents of the Books packageXml\r\n * @private\r\n * @param {document} packageXml XML Document\r\n */\r\nBook.prototype.unpack = function(opf){\r\n\tthis.package = opf;\r\n\r\n\tthis.spine.unpack(this.package, this.resolve.bind(this));\r\n\r\n\tthis.resources = new Resources(this.package.manifest, {\r\n\t\tarchive: this.archive,\r\n\t\tresolver: this.resolve.bind(this),\r\n\t\treplacements: this.settings.replacements\r\n\t});\r\n\r\n\tthis.loadNavigation(this.package).then(function(){\r\n\t\tthis.toc = this.navigation.toc;\r\n\t\tthis.loading.navigation.resolve(this.navigation);\r\n\t}.bind(this));\r\n\r\n\tthis.cover = this.resolve(this.package.coverPath);\r\n\r\n\t// Resolve promises\r\n\tthis.loading.manifest.resolve(this.package.manifest);\r\n\tthis.loading.metadata.resolve(this.package.metadata);\r\n\tthis.loading.spine.resolve(this.spine);\r\n\tthis.loading.cover.resolve(this.cover);\r\n\tthis.loading.resources.resolve(this.resources);\r\n\tthis.loading.pageList.resolve(this.pageList);\r\n\r\n\r\n\tthis.isOpen = true;\r\n\r\n\tif(this.archived) {\r\n\t\tthis.replacements().then(function() {\r\n\t\t\tthis.opening.resolve(this);\r\n\t\t}.bind(this));\r\n\t} else {\r\n\t\t// Resolve book opened promise\r\n\t\tthis.opening.resolve(this);\r\n\t}\r\n\r\n};\r\n\r\n/**\r\n * Load Navigation and PageList from package\r\n * @private\r\n * @param {document} opf XML Document\r\n */\r\nBook.prototype.loadNavigation = function(opf){\r\n\tvar navPath = opf.navPath || opf.ncxPath;\r\n\r\n\tif (!navPath) {\r\n\t\treturn;\r\n\t}\r\n\r\n\treturn this.load(navPath, 'xml')\r\n\t\t.then(function(xml) {\r\n\t\t\tthis.navigation = new Navigation(xml);\r\n\t\t\tthis.pageList = new PageList(xml);\r\n\t\t\treturn this.navigation;\r\n\t\t}.bind(this));\r\n};\r\n\r\n/**\r\n * Alias for book.spine.get\r\n * @param {string} target\r\n */\r\nBook.prototype.section = function(target) {\r\n\treturn this.spine.get(target);\r\n};\r\n\r\n/**\r\n * Sugar to render a book\r\n * @param  {element} element element to add the views to\r\n * @param  {[object]} options\r\n * @return {Rendition}\r\n */\r\nBook.prototype.renderTo = function(element, options) {\r\n\t// var renderMethod = (options && options.method) ?\r\n\t//     options.method :\r\n\t//     \"single\";\r\n\r\n\tthis.rendition = new Rendition(this, options);\r\n\tthis.rendition.attachTo(element);\r\n\r\n\treturn this.rendition;\r\n};\r\n\r\n/**\r\n * Set if request should use withCredentials\r\n * @param {boolean} credentials\r\n */\r\nBook.prototype.setRequestCredentials = function(credentials) {\r\n\tthis.settings.requestCredentials = credentials;\r\n};\r\n\r\n/**\r\n * Set headers request should use\r\n * @param {object} headers\r\n */\r\nBook.prototype.setRequestHeaders = function(headers) {\r\n\tthis.settings.requestHeaders = headers;\r\n};\r\n\r\n/**\r\n * Unarchive a zipped epub\r\n * @private\r\n * @param  {binary} input epub data\r\n * @param  {[string]} encoding\r\n * @return {Archive}\r\n */\r\nBook.prototype.unarchive = function(input, encoding){\r\n\tthis.archive = new Archive();\r\n\treturn this.archive.open(input, encoding);\r\n};\r\n\r\n/**\r\n * Get the cover url\r\n * @return {string} coverUrl\r\n */\r\nBook.prototype.coverUrl = function(){\r\n\tvar retrieved = this.loaded.cover.\r\n\t\tthen(function(url) {\r\n\t\t\tif(this.archived) {\r\n\t\t\t\t// return this.archive.createUrl(this.cover);\r\n\t\t\t\treturn this.resources.get(this.cover);\r\n\t\t\t}else{\r\n\t\t\t\treturn this.cover;\r\n\t\t\t}\r\n\t\t}.bind(this));\r\n\r\n\r\n\r\n\treturn retrieved;\r\n};\r\n\r\n/**\r\n * load replacement urls\r\n * @private\r\n * @return {Promise} completed loading urls\r\n */\r\nBook.prototype.replacements = function(){\r\n\tthis.spine.hooks.serialize.register(function(output, section) {\r\n\t\tsection.output = this.resources.substitute(output, section.url);\r\n\t}.bind(this));\r\n\r\n\treturn this.resources.replacements().\r\n\t\tthen(function() {\r\n\t\t\treturn this.resources.replaceCss();\r\n\t\t}.bind(this));\r\n};\r\n\r\n/**\r\n * Find a DOM Range for a given CFI Range\r\n * @param  {EpubCFI} cfiRange a epub cfi range\r\n * @return {Range}\r\n */\r\nBook.prototype.range = function(cfiRange) {\r\n\tvar cfi = new EpubCFI(cfiRange);\r\n\tvar item = this.spine.get(cfi.spinePos);\r\n\r\n\treturn item.load().then(function (contents) {\r\n\t\tvar range = cfi.toRange(item.document);\r\n\t\treturn range;\r\n\t})\r\n};\r\n\r\n/**\r\n * Generates the Book Key using the identifer in the manifest or other string provided\r\n * @param  {[string]} identifier to use instead of metadata identifier\r\n * @return {string} key\r\n */\r\nBook.prototype.key = function(identifier){\r\n\tvar ident = identifier || this.package.metadata.identifier || this.url.filename;\r\n\treturn \"epubjs:\" + (EPUBJS_VERSION || ePub.VERSION) + \":\" + ident;\r\n};\r\n\r\n//-- Enable binding events to book\r\nEventEmitter(Book.prototype);\r\n\r\nmodule.exports = Book;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/book.js\n// module id = 17\n// module chunks = 0","var core = require('../../core');\r\nvar DefaultViewManager = require('../default');\r\n\r\nfunction ContinuousViewManager(options) {\r\n\r\n\tDefaultViewManager.apply(this, arguments); // call super constructor.\r\n\r\n\tthis.name = \"continuous\";\r\n\r\n\tthis.settings = core.extend(this.settings || {}, {\r\n\t\tinfinite: true,\r\n\t\toverflow: \"auto\",\r\n\t\taxis: \"vertical\",\r\n\t\toffset: 500,\r\n\t\toffsetDelta: 250,\r\n\t\twidth: undefined,\r\n\t\theight: undefined\r\n\t});\r\n\r\n\tcore.extend(this.settings, options.settings || {});\r\n\r\n\t// Gap can be 0, byt defaults doesn't handle that\r\n\tif (options.settings.gap != \"undefined\" && options.settings.gap === 0) {\r\n\t\tthis.settings.gap = options.settings.gap;\r\n\t}\r\n\r\n\t// this.viewSettings.axis = this.settings.axis;\r\n\tthis.viewSettings = {\r\n\t\tignoreClass: this.settings.ignoreClass,\r\n\t\taxis: this.settings.axis,\r\n\t\tlayout: this.layout,\r\n\t\twidth: 0,\r\n\t\theight: 0\r\n\t};\r\n\r\n\tthis.scrollTop = 0;\r\n\tthis.scrollLeft = 0;\r\n};\r\n\r\n// subclass extends superclass\r\nContinuousViewManager.prototype = Object.create(DefaultViewManager.prototype);\r\nContinuousViewManager.prototype.constructor = ContinuousViewManager;\r\n\r\nContinuousViewManager.prototype.display = function(section, target){\r\n\treturn DefaultViewManager.prototype.display.call(this, section, target)\r\n\t\t.then(function () {\r\n\t\t\treturn this.fill();\r\n\t\t}.bind(this));\r\n};\r\n\r\nContinuousViewManager.prototype.fill = function(_full){\r\n\tvar full = _full || new core.defer();\r\n\r\n\tthis.check().then(function(result) {\r\n\t\tif (result) {\r\n\t\t\tthis.fill(full);\r\n\t\t} else {\r\n\t\t\tfull.resolve();\r\n\t\t}\r\n\t}.bind(this));\r\n\r\n\treturn full.promise;\r\n}\r\n\r\nContinuousViewManager.prototype.moveTo = function(offset){\r\n\t// var bounds = this.stage.bounds();\r\n\t// var dist = Math.floor(offset.top / bounds.height) * bounds.height;\r\n\tvar distX = 0,\r\n\t\t\tdistY = 0;\r\n\r\n\tvar offsetX = 0,\r\n\t\t\toffsetY = 0;\r\n\r\n\tif(this.settings.axis === \"vertical\") {\r\n\t\tdistY = offset.top;\r\n\t\toffsetY = offset.top+this.settings.offset;\r\n\t} else {\r\n\t\tdistX = Math.floor(offset.left / this.layout.delta) * this.layout.delta;\r\n\t\toffsetX = distX+this.settings.offset;\r\n\t}\r\n\r\n\treturn this.check(offsetX, offsetY)\r\n\t\t.then(function(){\r\n\t\t\tthis.scrollBy(distX, distY);\r\n\t\t}.bind(this));\r\n};\r\n\r\n/*\r\nContinuousViewManager.prototype.afterDisplayed = function(currView){\r\n\tvar next = currView.section.next();\r\n\tvar prev = currView.section.prev();\r\n\tvar index = this.views.indexOf(currView);\r\n\tvar prevView, nextView;\r\n\r\n\tif(index + 1 === this.views.length && next) {\r\n\t\tnextView = this.createView(next);\r\n\t\tthis.q.enqueue(this.append.bind(this), nextView);\r\n\t}\r\n\r\n\tif(index === 0 && prev) {\r\n\t\tprevView = this.createView(prev, this.viewSettings);\r\n\t\tthis.q.enqueue(this.prepend.bind(this), prevView);\r\n\t}\r\n\r\n\t// this.removeShownListeners(currView);\r\n\t// currView.onShown = this.afterDisplayed.bind(this);\r\n\tthis.emit(\"added\", currView.section);\r\n\r\n};\r\n*/\r\n\r\nContinuousViewManager.prototype.resize = function(width, height){\r\n\r\n\t// Clear the queue\r\n\tthis.q.clear();\r\n\r\n\tthis._stageSize = this.stage.size(width, height);\r\n\tthis._bounds = this.bounds();\r\n\r\n\t// Update for new views\r\n\tthis.viewSettings.width = this._stageSize.width;\r\n\tthis.viewSettings.height = this._stageSize.height;\r\n\r\n\t// Update for existing views\r\n\tthis.views.each(function(view) {\r\n\t\tview.size(this._stageSize.width, this._stageSize.height);\r\n\t}.bind(this));\r\n\r\n\tthis.updateLayout();\r\n\r\n\t// if(this.location) {\r\n\t//   this.rendition.display(this.location.start);\r\n\t// }\r\n\r\n\tthis.emit(\"resized\", {\r\n\t\twidth: this.stage.width,\r\n\t\theight: this.stage.height\r\n\t});\r\n\r\n};\r\n\r\nContinuousViewManager.prototype.onResized = function(e) {\r\n\r\n\t// this.views.clear();\r\n\r\n\tclearTimeout(this.resizeTimeout);\r\n\tthis.resizeTimeout = setTimeout(function(){\r\n\t\tthis.resize();\r\n\t}.bind(this), 150);\r\n};\r\n\r\nContinuousViewManager.prototype.afterResized = function(view){\r\n\tthis.emit(\"resize\", view.section);\r\n};\r\n\r\n// Remove Previous Listeners if present\r\nContinuousViewManager.prototype.removeShownListeners = function(view){\r\n\r\n\t// view.off(\"shown\", this.afterDisplayed);\r\n\t// view.off(\"shown\", this.afterDisplayedAbove);\r\n\tview.onDisplayed = function(){};\r\n\r\n};\r\n\r\n\r\n// ContinuousViewManager.prototype.append = function(section){\r\n// \treturn this.q.enqueue(function() {\r\n//\r\n// \t\tthis._append(section);\r\n//\r\n//\r\n// \t}.bind(this));\r\n// };\r\n//\r\n// ContinuousViewManager.prototype.prepend = function(section){\r\n// \treturn this.q.enqueue(function() {\r\n//\r\n// \t\tthis._prepend(section);\r\n//\r\n// \t}.bind(this));\r\n//\r\n// };\r\n\r\nContinuousViewManager.prototype.append = function(section){\r\n\tvar view = this.createView(section);\r\n\tthis.views.append(view);\r\n\treturn view;\r\n};\r\n\r\nContinuousViewManager.prototype.prepend = function(section){\r\n\tvar view = this.createView(section);\r\n\r\n\tview.on(\"resized\", this.counter.bind(this));\r\n\r\n\tthis.views.prepend(view);\r\n\treturn view;\r\n};\r\n\r\nContinuousViewManager.prototype.counter = function(bounds){\r\n\r\n\tif(this.settings.axis === \"vertical\") {\r\n\t\tthis.scrollBy(0, bounds.heightDelta, true);\r\n\t} else {\r\n\t\tthis.scrollBy(bounds.widthDelta, 0, true);\r\n\t}\r\n\r\n};\r\n\r\nContinuousViewManager.prototype.update = function(_offset){\r\n\tvar container = this.bounds();\r\n\tvar views = this.views.all();\r\n\tvar viewsLength = views.length;\r\n\tvar visible = [];\r\n\tvar offset = typeof _offset != \"undefined\" ? _offset : (this.settings.offset || 0);\r\n\tvar isVisible;\r\n\tvar view;\r\n\r\n\tvar updating = new core.defer();\r\n\tvar promises = [];\r\n\r\n\tfor (var i = 0; i < viewsLength; i++) {\r\n\t\tview = views[i];\r\n\r\n\t\tisVisible = this.isVisible(view, offset, offset, container);\r\n\r\n\t\tif(isVisible === true) {\r\n\t\t\tif (!view.displayed) {\r\n\t\t\t\tpromises.push(view.display(this.request).then(function (view) {\r\n\t\t\t\t\tview.show();\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t\tvisible.push(view);\r\n\t\t} else {\r\n\t\t\tthis.q.enqueue(view.destroy.bind(view));\r\n\r\n\t\t\tclearTimeout(this.trimTimeout);\r\n\t\t\tthis.trimTimeout = setTimeout(function(){\r\n\t\t\t\tthis.q.enqueue(this.trim.bind(this));\r\n\t\t\t}.bind(this), 250);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tif(promises.length){\r\n\t\treturn Promise.all(promises);\r\n\t} else {\r\n\t\tupdating.resolve();\r\n\t\treturn updating.promise;\r\n\t}\r\n\r\n};\r\n\r\nContinuousViewManager.prototype.check = function(_offsetLeft, _offsetTop){\r\n\tvar last, first, next, prev;\r\n\r\n\tvar checking = new core.defer();\r\n\tvar newViews = [];\r\n\r\n\tvar horizontal = (this.settings.axis === \"horizontal\");\r\n\tvar delta = this.settings.offset || 0;\r\n\r\n\tif (_offsetLeft && horizontal) {\r\n\t\tdelta = _offsetLeft;\r\n\t}\r\n\r\n\tif (_offsetTop && !horizontal) {\r\n\t\tdelta = _offsetTop;\r\n\t}\r\n\r\n\tvar bounds = this._bounds; // bounds saved this until resize\r\n\r\n\tvar offset = horizontal ? this.scrollLeft : this.scrollTop;\r\n\tvar visibleLength = horizontal ? bounds.width : bounds.height;\r\n\tvar contentLength = horizontal ? this.container.scrollWidth : this.container.scrollHeight;\r\n\r\n\tif (offset + visibleLength + delta >= contentLength) {\r\n\t\tlast = this.views.last();\r\n\t\tnext = last && last.section.next();\r\n\t\tif(next) {\r\n\t\t\tnewViews.push(this.append(next));\r\n\t\t}\r\n\t}\r\n\r\n\tif (offset - delta < 0 ) {\r\n\t\tfirst = this.views.first();\r\n\t\tprev = first && first.section.prev();\r\n\t\tif(prev) {\r\n\t\t\tnewViews.push(this.prepend(prev));\r\n\t\t}\r\n\t}\r\n\r\n\tif(newViews.length){\r\n\t\t// Promise.all(promises)\r\n\t\t\t// .then(function() {\r\n\t\t\t\t// Check to see if anything new is on screen after rendering\r\n\t\t\t\treturn this.q.enqueue(function(){\r\n\t\t\t\t\treturn this.update(delta);\r\n\t\t\t\t}.bind(this));\r\n\r\n\r\n\t\t\t// }.bind(this));\r\n\r\n\t} else {\r\n\t\tchecking.resolve(false);\r\n\t\treturn checking.promise;\r\n\t}\r\n\r\n\r\n};\r\n\r\nContinuousViewManager.prototype.trim = function(){\r\n\tvar task = new core.defer();\r\n\tvar displayed = this.views.displayed();\r\n\tvar first = displayed[0];\r\n\tvar last = displayed[displayed.length-1];\r\n\tvar firstIndex = this.views.indexOf(first);\r\n\tvar lastIndex = this.views.indexOf(last);\r\n\tvar above = this.views.slice(0, firstIndex);\r\n\tvar below = this.views.slice(lastIndex+1);\r\n\r\n\t// Erase all but last above\r\n\tfor (var i = 0; i < above.length-1; i++) {\r\n\t\tthis.erase(above[i], above);\r\n\t}\r\n\r\n\t// Erase all except first below\r\n\tfor (var j = 1; j < below.length; j++) {\r\n\t\tthis.erase(below[j]);\r\n\t}\r\n\r\n\ttask.resolve();\r\n\treturn task.promise;\r\n};\r\n\r\nContinuousViewManager.prototype.erase = function(view, above){ //Trim\r\n\r\n\tvar prevTop;\r\n\tvar prevLeft;\r\n\r\n\tif(this.settings.height) {\r\n\t\tprevTop = this.container.scrollTop;\r\n\t\tprevLeft = this.container.scrollLeft;\r\n\t} else {\r\n\t\tprevTop = window.scrollY;\r\n\t\tprevLeft = window.scrollX;\r\n\t}\r\n\r\n\tvar bounds = view.bounds();\r\n\r\n\tthis.views.remove(view);\r\n\r\n\tif(above) {\r\n\r\n\t\tif(this.settings.axis === \"vertical\") {\r\n\t\t\tthis.scrollTo(0, prevTop - bounds.height, true);\r\n\t\t} else {\r\n\t\t\tthis.scrollTo(prevLeft - bounds.width, 0, true);\r\n\t\t}\r\n\t}\r\n\r\n};\r\n\r\nContinuousViewManager.prototype.addEventListeners = function(stage){\r\n\r\n\twindow.addEventListener('unload', function(e){\r\n\t\tthis.ignore = true;\r\n\t\t// this.scrollTo(0,0);\r\n\t\tthis.destroy();\r\n\t}.bind(this));\r\n\r\n\tthis.addScrollListeners();\r\n};\r\n\r\nContinuousViewManager.prototype.addScrollListeners = function() {\r\n\tvar scroller;\r\n\r\n\tthis.tick = core.requestAnimationFrame;\r\n\r\n\tif(this.settings.height) {\r\n\t\tthis.prevScrollTop = this.container.scrollTop;\r\n\t\tthis.prevScrollLeft = this.container.scrollLeft;\r\n\t} else {\r\n\t\tthis.prevScrollTop = window.scrollY;\r\n\t\tthis.prevScrollLeft = window.scrollX;\r\n\t}\r\n\r\n\tthis.scrollDeltaVert = 0;\r\n\tthis.scrollDeltaHorz = 0;\r\n\r\n\tif(this.settings.height) {\r\n\t\tscroller = this.container;\r\n\t\tthis.scrollTop = this.container.scrollTop;\r\n\t\tthis.scrollLeft = this.container.scrollLeft;\r\n\t} else {\r\n\t\tscroller = window;\r\n\t\tthis.scrollTop = window.scrollY;\r\n\t\tthis.scrollLeft = window.scrollX;\r\n\t}\r\n\r\n\tscroller.addEventListener(\"scroll\", this.onScroll.bind(this));\r\n\r\n\t// this.tick.call(window, this.onScroll.bind(this));\r\n\r\n\tthis.scrolled = false;\r\n\r\n};\r\n\r\nContinuousViewManager.prototype.onScroll = function(){\r\n\r\n\t// if(!this.ignore) {\r\n\r\n\t\tif(this.settings.height) {\r\n\t\t\tscrollTop = this.container.scrollTop;\r\n\t\t\tscrollLeft = this.container.scrollLeft;\r\n\t\t} else {\r\n\t\t\tscrollTop = window.scrollY;\r\n\t\t\tscrollLeft = window.scrollX;\r\n\t\t}\r\n\r\n\t\tthis.scrollTop = scrollTop;\r\n\t\tthis.scrollLeft = scrollLeft;\r\n\r\n\t\tif(!this.ignore) {\r\n\r\n\t\t\tif((this.scrollDeltaVert === 0 &&\r\n\t\t\t\t this.scrollDeltaHorz === 0) ||\r\n\t\t\t\t this.scrollDeltaVert > this.settings.offsetDelta ||\r\n\t\t\t\t this.scrollDeltaHorz > this.settings.offsetDelta) {\r\n\r\n\t\t\t\tthis.q.enqueue(function() {\r\n\t\t\t\t\tthis.check();\r\n\t\t\t\t}.bind(this));\r\n\t\t\t\t// this.check();\r\n\r\n\t\t\t\tthis.scrollDeltaVert = 0;\r\n\t\t\t\tthis.scrollDeltaHorz = 0;\r\n\r\n\t\t\t\tthis.emit(\"scroll\", {\r\n\t\t\t\t\ttop: scrollTop,\r\n\t\t\t\t\tleft: scrollLeft\r\n\t\t\t\t});\r\n\r\n\t\t\t\tclearTimeout(this.afterScrolled);\r\n\t\t\t\tthis.afterScrolled = setTimeout(function () {\r\n\t\t\t\t\tthis.emit(\"scrolled\", {\r\n\t\t\t\t\t\ttop: this.scrollTop,\r\n\t\t\t\t\t\tleft: this.scrollLeft\r\n\t\t\t\t\t});\r\n\t\t\t\t}.bind(this));\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tthis.ignore = false;\r\n\t\t}\r\n\r\n\t\tthis.scrollDeltaVert += Math.abs(scrollTop-this.prevScrollTop);\r\n\t\tthis.scrollDeltaHorz += Math.abs(scrollLeft-this.prevScrollLeft);\r\n\r\n\t\tthis.prevScrollTop = scrollTop;\r\n\t\tthis.prevScrollLeft = scrollLeft;\r\n\r\n\t\tclearTimeout(this.scrollTimeout);\r\n\t\tthis.scrollTimeout = setTimeout(function(){\r\n\t\t\tthis.scrollDeltaVert = 0;\r\n\t\t\tthis.scrollDeltaHorz = 0;\r\n\t\t}.bind(this), 150);\r\n\r\n\r\n\t\tthis.scrolled = false;\r\n\t// }\r\n\r\n\t// this.tick.call(window, this.onScroll.bind(this));\r\n\r\n};\r\n\r\n\r\n//  ContinuousViewManager.prototype.resizeView = function(view) {\r\n//\r\n// \tif(this.settings.axis === \"horizontal\") {\r\n// \t\tview.lock(\"height\", this.stage.width, this.stage.height);\r\n// \t} else {\r\n// \t\tview.lock(\"width\", this.stage.width, this.stage.height);\r\n// \t}\r\n//\r\n// };\r\n\r\nContinuousViewManager.prototype.currentLocation = function(){\r\n\r\n\tif (this.settings.axis === \"vertical\") {\r\n\t\tthis.location = this.scrolledLocation();\r\n\t} else {\r\n\t\tthis.location = this.paginatedLocation();\r\n\t}\r\n\r\n\treturn this.location;\r\n};\r\n\r\nContinuousViewManager.prototype.scrolledLocation = function(){\r\n\r\n\tvar visible = this.visible();\r\n\tvar startPage, endPage;\r\n\r\n\tvar container = this.container.getBoundingClientRect();\r\n\r\n\tif(visible.length === 1) {\r\n\t\treturn this.mapping.page(visible[0].contents, visible[0].section.cfiBase);\r\n\t}\r\n\r\n\tif(visible.length > 1) {\r\n\r\n\t\tstartPage = this.mapping.page(visible[0].contents, visible[0].section.cfiBase);\r\n\t\tendPage = this.mapping.page(visible[visible.length-1].contents, visible[visible.length-1].section.cfiBase);\r\n\r\n\t\treturn {\r\n\t\t\tstart: startPage.start,\r\n\t\t\tend: endPage.end\r\n\t\t};\r\n\t}\r\n\r\n};\r\n\r\nContinuousViewManager.prototype.paginatedLocation = function(){\r\n\tvar visible = this.visible();\r\n\tvar startA, startB, endA, endB;\r\n\tvar pageLeft, pageRight;\r\n\tvar container = this.container.getBoundingClientRect();\r\n\r\n\tif(visible.length === 1) {\r\n\t\tstartA = container.left - visible[0].position().left;\r\n\t\tendA = startA + this.layout.spreadWidth;\r\n\r\n\t\treturn this.mapping.page(visible[0].contents, visible[0].section.cfiBase, startA, endA);\r\n\t}\r\n\r\n\tif(visible.length > 1) {\r\n\r\n\t\t// Left Col\r\n\t\tstartA = container.left - visible[0].position().left;\r\n\t\tendA = startA + this.layout.columnWidth;\r\n\r\n\t\t// Right Col\r\n\t\tstartB = container.left + this.layout.spreadWidth - visible[visible.length-1].position().left;\r\n\t\tendB = startB + this.layout.columnWidth;\r\n\r\n\t\tpageLeft = this.mapping.page(visible[0].contents, visible[0].section.cfiBase, startA, endA);\r\n\t\tpageRight = this.mapping.page(visible[visible.length-1].contents, visible[visible.length-1].section.cfiBase, startB, endB);\r\n\r\n\t\treturn {\r\n\t\t\tstart: pageLeft.start,\r\n\t\t\tend: pageRight.end\r\n\t\t};\r\n\t}\r\n};\r\n\r\n/*\r\nContinuous.prototype.current = function(what){\r\n\tvar view, top;\r\n\tvar container = this.container.getBoundingClientRect();\r\n\tvar length = this.views.length - 1;\r\n\r\n\tif(this.settings.axis === \"horizontal\") {\r\n\r\n\t\tfor (var i = length; i >= 0; i--) {\r\n\t\t\tview = this.views[i];\r\n\t\t\tleft = view.position().left;\r\n\r\n\t\t\tif(left < container.right) {\r\n\r\n\t\t\t\tif(this._current == view) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._current = view;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t} else {\r\n\r\n\t\tfor (var i = length; i >= 0; i--) {\r\n\t\t\tview = this.views[i];\r\n\t\t\ttop = view.bounds().top;\r\n\t\t\tif(top < container.bottom) {\r\n\r\n\t\t\t\tif(this._current == view) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._current = view;\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn this._current;\r\n};\r\n*/\r\n\r\nContinuousViewManager.prototype.updateLayout = function() {\r\n\r\n\tif (!this.stage) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif(this.settings.axis === \"vertical\") {\r\n\t\tthis.layout.calculate(this._stageSize.width, this._stageSize.height);\r\n\t} else {\r\n\t\tthis.layout.calculate(\r\n\t\t\tthis._stageSize.width,\r\n\t\t\tthis._stageSize.height,\r\n\t\t\tthis.settings.gap\r\n\t\t);\r\n\r\n\t\t// Set the look ahead offset for what is visible\r\n\t\tthis.settings.offset = this.layout.delta;\r\n\r\n\t\tthis.stage.addStyleRules(\"iframe\", [{\"margin-right\" : this.layout.gap + \"px\"}]);\r\n\r\n\t}\r\n\r\n\t// Set the dimensions for views\r\n\tthis.viewSettings.width = this.layout.width;\r\n\tthis.viewSettings.height = this.layout.height;\r\n\r\n\tthis.setLayout(this.layout);\r\n\r\n};\r\n\r\nContinuousViewManager.prototype.next = function(){\r\n\r\n\tif(this.settings.axis === \"horizontal\") {\r\n\r\n\t\tthis.scrollLeft = this.container.scrollLeft;\r\n\r\n\t\tif(this.container.scrollLeft +\r\n\t\t\t this.container.offsetWidth +\r\n\t\t\t this.layout.delta < this.container.scrollWidth) {\r\n\t\t\tthis.scrollBy(this.layout.delta, 0);\r\n\t\t} else {\r\n\t\t\tthis.scrollTo(this.container.scrollWidth - this.layout.delta, 0);\r\n\t\t}\r\n\r\n\t} else {\r\n\t\tthis.scrollBy(0, this.layout.height);\r\n\t}\r\n};\r\n\r\nContinuousViewManager.prototype.prev = function(){\r\n\tif(this.settings.axis === \"horizontal\") {\r\n\t\tthis.scrollBy(-this.layout.delta, 0);\r\n\t} else {\r\n\t\tthis.scrollBy(0, -this.layout.height);\r\n\t}\r\n};\r\n\r\nContinuousViewManager.prototype.updateFlow = function(flow){\r\n\tvar axis = (flow === \"paginated\") ? \"horizontal\" : \"vertical\";\r\n\r\n\tthis.settings.axis = axis;\r\n\r\n\tthis.viewSettings.axis = axis;\r\n\r\n\tthis.settings.overflow = (flow === \"paginated\") ? \"hidden\" : \"auto\";\r\n\r\n\t// this.views.each(function(view){\r\n\t// \tview.setAxis(axis);\r\n\t// });\r\n\r\n\tif (this.settings.axis === \"vertical\") {\r\n\t\tthis.settings.infinite = true;\r\n\t} else {\r\n\t\tthis.settings.infinite = false;\r\n\t}\r\n\r\n};\r\nmodule.exports = ContinuousViewManager;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/managers/continuous/index.js\n// module id = 18\n// module chunks = 0","var EventEmitter = require('event-emitter');\r\nvar core = require('../../core');\r\nvar EpubCFI = require('../../epubcfi');\r\nvar Contents = require('../../contents');\r\n\r\nfunction IframeView(section, options) {\r\n\tthis.settings = core.extend({\r\n\t\tignoreClass : '',\r\n\t\taxis: 'vertical',\r\n\t\twidth: 0,\r\n\t\theight: 0,\r\n\t\tlayout: undefined,\r\n\t\tglobalLayoutProperties: {},\r\n\t}, options || {});\r\n\r\n\tthis.id = \"epubjs-view-\" + core.uuid();\r\n\tthis.section = section;\r\n\tthis.index = section.index;\r\n\r\n\tthis.element = this.container(this.settings.axis);\r\n\r\n\tthis.added = false;\r\n\tthis.displayed = false;\r\n\tthis.rendered = false;\r\n\r\n\tthis.width  = this.settings.width;\r\n\tthis.height = this.settings.height;\r\n\r\n\tthis.fixedWidth  = 0;\r\n\tthis.fixedHeight = 0;\r\n\r\n\t// Blank Cfi for Parsing\r\n\tthis.epubcfi = new EpubCFI();\r\n\r\n\tthis.layout = this.settings.layout;\r\n\t// Dom events to listen for\r\n\t// this.listenedEvents = [\"keydown\", \"keyup\", \"keypressed\", \"mouseup\", \"mousedown\", \"click\", \"touchend\", \"touchstart\"];\r\n};\r\n\r\nIframeView.prototype.container = function(axis) {\r\n\tvar element = document.createElement('div');\r\n\r\n\telement.classList.add(\"epub-view\");\r\n\r\n\t// this.element.style.minHeight = \"100px\";\r\n\telement.style.height = \"0px\";\r\n\telement.style.width = \"0px\";\r\n\telement.style.overflow = \"hidden\";\r\n\r\n\tif(axis && axis == \"horizontal\"){\r\n\t\telement.style.display = \"inline-block\";\r\n\t} else {\r\n\t\telement.style.display = \"block\";\r\n\t}\r\n\r\n\treturn element;\r\n};\r\n\r\nIframeView.prototype.create = function() {\r\n\r\n\tif(this.iframe) {\r\n\t\treturn this.iframe;\r\n\t}\r\n\r\n\tif(!this.element) {\r\n\t\tthis.element = this.createContainer();\r\n\t}\r\n\r\n\tthis.iframe = document.createElement('iframe');\r\n\tthis.iframe.id = this.id;\r\n\tthis.iframe.scrolling = \"no\"; // Might need to be removed: breaks ios width calculations\r\n\tthis.iframe.style.overflow = \"hidden\";\r\n\tthis.iframe.seamless = \"seamless\";\r\n\t// Back up if seamless isn't supported\r\n\tthis.iframe.style.border = \"none\";\r\n\r\n\tthis.resizing = true;\r\n\r\n\t// this.iframe.style.display = \"none\";\r\n\tthis.element.style.visibility = \"hidden\";\r\n\tthis.iframe.style.visibility = \"hidden\";\r\n\r\n\tthis.iframe.style.width = \"0\";\r\n\tthis.iframe.style.height = \"0\";\r\n\tthis._width = 0;\r\n\tthis._height = 0;\r\n\r\n\tthis.element.appendChild(this.iframe);\r\n\tthis.added = true;\r\n\r\n\tthis.elementBounds = core.bounds(this.element);\r\n\r\n\t// if(width || height){\r\n\t//   this.resize(width, height);\r\n\t// } else if(this.width && this.height){\r\n\t//   this.resize(this.width, this.height);\r\n\t// } else {\r\n\t//   this.iframeBounds = core.bounds(this.iframe);\r\n\t// }\r\n\r\n\t// Firefox has trouble with baseURI and srcdoc\r\n\t// TODO: Disable for now in firefox\r\n\r\n\tif(!!(\"srcdoc\" in this.iframe)) {\r\n\t\tthis.supportsSrcdoc = true;\r\n\t} else {\r\n\t\tthis.supportsSrcdoc = false;\r\n\t}\r\n\r\n\treturn this.iframe;\r\n};\r\n\r\nIframeView.prototype.render = function(request, show) {\r\n\r\n\t// view.onLayout = this.layout.format.bind(this.layout);\r\n\tthis.create();\r\n\r\n\t// Fit to size of the container, apply padding\r\n\tthis.size();\r\n\r\n\tif(!this.sectionRender) {\r\n\t\tthis.sectionRender = this.section.render(request);\r\n\t}\r\n\r\n\t// Render Chain\r\n\treturn this.sectionRender\r\n\t\t.then(function(contents){\r\n\t\t\treturn this.load(contents);\r\n\t\t}.bind(this))\r\n\t\t// .then(function(doc){\r\n\t\t// \treturn this.hooks.content.trigger(view, this);\r\n\t\t// }.bind(this))\r\n\t\t.then(function(){\r\n\t\t\t// this.settings.layout.format(view.contents);\r\n\t\t\t// return this.hooks.layout.trigger(view, this);\r\n\t\t}.bind(this))\r\n\t\t// .then(function(){\r\n\t\t// \treturn this.display();\r\n\t\t// }.bind(this))\r\n\t\t// .then(function(){\r\n\t\t// \treturn this.hooks.render.trigger(view, this);\r\n\t\t// }.bind(this))\r\n\t\t.then(function(){\r\n\r\n\t\t\t// apply the layout function to the contents\r\n\t\t\tthis.settings.layout.format(this.contents);\r\n\r\n\t\t\t// Expand the iframe to the full size of the content\r\n\t\t\tthis.expand();\r\n\r\n\t\t\t// Listen for events that require an expansion of the iframe\r\n\t\t\tthis.addListeners();\r\n\r\n\t\t\tif(show !== false) {\r\n\t\t\t\t//this.q.enqueue(function(view){\r\n\t\t\t\t\t// this.show();\r\n\t\t\t\t//}, view);\r\n\t\t\t}\r\n\t\t\t// this.map = new Map(view, this.layout);\r\n\t\t\t//this.hooks.show.trigger(view, this);\r\n\t\t\tthis.emit(\"rendered\", this.section);\r\n\r\n\t\t}.bind(this))\r\n\t\t.catch(function(e){\r\n\t\t\tconsole.error(e);\r\n\t\t\tthis.emit(\"loaderror\", e);\r\n\t\t}.bind(this));\r\n\r\n};\r\n\r\n// Determine locks base on settings\r\nIframeView.prototype.size = function(_width, _height) {\r\n\tvar width = _width || this.settings.width;\r\n\tvar height = _height || this.settings.height;\r\n\r\n\tif(this.layout.name === \"pre-paginated\") {\r\n\t\tthis.lock(\"both\", width, height);\r\n\t} else if(this.settings.axis === \"horizontal\") {\r\n\t\tthis.lock(\"height\", width, height);\r\n\t} else {\r\n\t\tthis.lock(\"width\", width, height);\r\n\t}\r\n\r\n};\r\n\r\n// Lock an axis to element dimensions, taking borders into account\r\nIframeView.prototype.lock = function(what, width, height) {\r\n\tvar elBorders = core.borders(this.element);\r\n\tvar iframeBorders;\r\n\r\n\tif(this.iframe) {\r\n\t\tiframeBorders = core.borders(this.iframe);\r\n\t} else {\r\n\t\tiframeBorders = {width: 0, height: 0};\r\n\t}\r\n\r\n\tif(what == \"width\" && core.isNumber(width)){\r\n\t\tthis.lockedWidth = width - elBorders.width - iframeBorders.width;\r\n\t\tthis.resize(this.lockedWidth, width); //  width keeps ratio correct\r\n\t}\r\n\r\n\tif(what == \"height\" && core.isNumber(height)){\r\n\t\tthis.lockedHeight = height - elBorders.height - iframeBorders.height;\r\n\t\tthis.resize(width, this.lockedHeight);\r\n\t}\r\n\r\n\tif(what === \"both\" &&\r\n\t\t core.isNumber(width) &&\r\n\t\t core.isNumber(height)){\r\n\r\n\t\tthis.lockedWidth = width - elBorders.width - iframeBorders.width;\r\n\t\tthis.lockedHeight = height - elBorders.height - iframeBorders.height;\r\n\r\n\t\tthis.resize(this.lockedWidth, this.lockedHeight);\r\n\t}\r\n\r\n\tif(this.displayed && this.iframe) {\r\n\r\n\t\t\t// this.contents.layout();\r\n\t\t\tthis.expand();\r\n\r\n\t}\r\n\r\n\r\n\r\n};\r\n\r\n// Resize a single axis based on content dimensions\r\nIframeView.prototype.expand = function(force) {\r\n\tvar width = this.lockedWidth;\r\n\tvar height = this.lockedHeight;\r\n\tvar columns;\r\n\r\n\tvar textWidth, textHeight;\r\n\r\n\tif(!this.iframe || this._expanding) return;\r\n\r\n\tthis._expanding = true;\r\n\r\n\t// Expand Horizontally\r\n\t// if(height && !width) {\r\n\tif(this.settings.axis === \"horizontal\") {\r\n\t\t// Get the width of the text\r\n\t\ttextWidth = this.contents.textWidth();\r\n\t\t// Check if the textWidth has changed\r\n\t\tif(textWidth != this._textWidth){\r\n\t\t\t// Get the contentWidth by resizing the iframe\r\n\t\t\t// Check with a min reset of the textWidth\r\n\t\t\twidth = this.contentWidth(textWidth);\r\n\r\n\t\t\tcolumns = Math.ceil(width / (this.settings.layout.columnWidth + this.settings.layout.gap));\r\n\r\n\t\t\tif ( this.settings.layout.divisor > 1 &&\r\n\t\t\t\t\t this.settings.layout.name === \"reflowable\" &&\r\n\t\t\t\t\t(columns % 2 > 0)) {\r\n\t\t\t\t\t// add a blank page\r\n\t\t\t\t\twidth += this.settings.layout.gap + this.settings.layout.columnWidth;\r\n\t\t\t}\r\n\r\n\t\t\t// Save the textWdith\r\n\t\t\tthis._textWidth = textWidth;\r\n\t\t\t// Save the contentWidth\r\n\t\t\tthis._contentWidth = width;\r\n\t\t} else {\r\n\t\t\t// Otherwise assume content height hasn't changed\r\n\t\t\twidth = this._contentWidth;\r\n\t\t}\r\n\t} // Expand Vertically\r\n\telse if(this.settings.axis === \"vertical\") {\r\n\t\ttextHeight = this.contents.textHeight();\r\n\t\tif(textHeight != this._textHeight){\r\n\t\t\theight = this.contentHeight(textHeight);\r\n\t\t\tthis._textHeight = textHeight;\r\n\t\t\tthis._contentHeight = height;\r\n\t\t} else {\r\n\t\t\theight = this._contentHeight;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Only Resize if dimensions have changed or\r\n\t// if Frame is still hidden, so needs reframing\r\n\tif(this._needsReframe || width != this._width || height != this._height){\r\n\t\tthis.resize(width, height);\r\n\t}\r\n\r\n\tthis._expanding = false;\r\n};\r\n\r\nIframeView.prototype.contentWidth = function(min) {\r\n\tvar prev;\r\n\tvar width;\r\n\r\n\t// Save previous width\r\n\tprev = this.iframe.style.width;\r\n\t// Set the iframe size to min, width will only ever be greater\r\n\t// Will preserve the aspect ratio\r\n\tthis.iframe.style.width = (min || 0) + \"px\";\r\n\t// Get the scroll overflow width\r\n\twidth = this.contents.scrollWidth();\r\n\t// Reset iframe size back\r\n\tthis.iframe.style.width = prev;\r\n\treturn width;\r\n};\r\n\r\nIframeView.prototype.contentHeight = function(min) {\r\n\tvar prev;\r\n\tvar height;\r\n\r\n\tprev = this.iframe.style.height;\r\n\tthis.iframe.style.height = (min || 0) + \"px\";\r\n\theight = this.contents.scrollHeight();\r\n\r\n\tthis.iframe.style.height = prev;\r\n\treturn height;\r\n};\r\n\r\n\r\nIframeView.prototype.resize = function(width, height) {\r\n\r\n\tif(!this.iframe) return;\r\n\r\n\tif(core.isNumber(width)){\r\n\t\tthis.iframe.style.width = width + \"px\";\r\n\t\tthis._width = width;\r\n\t}\r\n\r\n\tif(core.isNumber(height)){\r\n\t\tthis.iframe.style.height = height + \"px\";\r\n\t\tthis._height = height;\r\n\t}\r\n\r\n\tthis.iframeBounds = core.bounds(this.iframe);\r\n\r\n\tthis.reframe(this.iframeBounds.width, this.iframeBounds.height);\r\n\r\n};\r\n\r\nIframeView.prototype.reframe = function(width, height) {\r\n\tvar size;\r\n\r\n\t// if(!this.displayed) {\r\n\t//   this._needsReframe = true;\r\n\t//   return;\r\n\t// }\r\n\tif(core.isNumber(width)){\r\n\t\tthis.element.style.width = width + \"px\";\r\n\t}\r\n\r\n\tif(core.isNumber(height)){\r\n\t\tthis.element.style.height = height + \"px\";\r\n\t}\r\n\r\n\tthis.prevBounds = this.elementBounds;\r\n\r\n\tthis.elementBounds = core.bounds(this.element);\r\n\r\n\tsize = {\r\n\t\twidth: this.elementBounds.width,\r\n\t\theight: this.elementBounds.height,\r\n\t\twidthDelta: this.elementBounds.width - this.prevBounds.width,\r\n\t\theightDelta: this.elementBounds.height - this.prevBounds.height,\r\n\t};\r\n\r\n\tthis.onResize(this, size);\r\n\r\n\tthis.emit(\"resized\", size);\r\n\r\n};\r\n\r\n\r\nIframeView.prototype.load = function(contents) {\r\n\tvar loading = new core.defer();\r\n\tvar loaded = loading.promise;\r\n\r\n\tif(!this.iframe) {\r\n\t\tloading.reject(new Error(\"No Iframe Available\"));\r\n\t\treturn loaded;\r\n\t}\r\n\r\n\tthis.iframe.onload = function(event) {\r\n\r\n\t\tthis.onLoad(event, loading);\r\n\r\n\t}.bind(this);\r\n\r\n\tif(this.supportsSrcdoc){\r\n\t\tthis.iframe.srcdoc = contents;\r\n\t} else {\r\n\r\n\t\tthis.document = this.iframe.contentDocument;\r\n\r\n\t\tif(!this.document) {\r\n\t\t\tloading.reject(new Error(\"No Document Available\"));\r\n\t\t\treturn loaded;\r\n\t\t}\r\n\r\n\t\tthis.iframe.contentDocument.open();\r\n\t\tthis.iframe.contentDocument.write(contents);\r\n\t\tthis.iframe.contentDocument.close();\r\n\r\n\t}\r\n\r\n\treturn loaded;\r\n};\r\n\r\nIframeView.prototype.onLoad = function(event, promise) {\r\n\r\n\t\tthis.window = this.iframe.contentWindow;\r\n\t\tthis.document = this.iframe.contentDocument;\r\n\r\n\t\tthis.contents = new Contents(this.document, this.document.body, this.section.cfiBase);\r\n\r\n\t\tthis.rendering = false;\r\n\r\n\t\tvar link = this.document.querySelector(\"link[rel='canonical']\");\r\n\t\tif (link) {\r\n\t\t\tlink.setAttribute(\"href\", this.section.url);\r\n\t\t} else {\r\n\t\t\tlink = this.document.createElement(\"link\");\r\n\t\t\tlink.setAttribute(\"rel\", \"canonical\");\r\n\t\t\tlink.setAttribute(\"href\", this.section.url);\r\n\t\t\tthis.document.querySelector(\"head\").appendChild(link);\r\n\t\t}\r\n\r\n\t\tthis.contents.on(\"expand\", function () {\r\n\t\t\tif(this.displayed && this.iframe) {\r\n\t\t\t\t\tthis.expand();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tpromise.resolve(this.contents);\r\n};\r\n\r\n\r\n\r\n// IframeView.prototype.layout = function(layoutFunc) {\r\n//\r\n//   this.iframe.style.display = \"inline-block\";\r\n//\r\n//   // Reset Body Styles\r\n//   // this.document.body.style.margin = \"0\";\r\n//   //this.document.body.style.display = \"inline-block\";\r\n//   //this.document.documentElement.style.width = \"auto\";\r\n//\r\n//   if(layoutFunc){\r\n//     this.layoutFunc = layoutFunc;\r\n//   }\r\n//\r\n//   this.contents.layout(this.layoutFunc);\r\n//\r\n// };\r\n//\r\n// IframeView.prototype.onLayout = function(view) {\r\n//   // stub\r\n// };\r\n\r\nIframeView.prototype.setLayout = function(layout) {\r\n\tthis.layout = layout;\r\n};\r\n\r\nIframeView.prototype.setAxis = function(axis) {\r\n\tthis.settings.axis = axis;\r\n};\r\n\r\nIframeView.prototype.resizeListenters = function() {\r\n\t// Test size again\r\n\tclearTimeout(this.expanding);\r\n\tthis.expanding = setTimeout(this.expand.bind(this), 350);\r\n};\r\n\r\nIframeView.prototype.addListeners = function() {\r\n\t//TODO: Add content listeners for expanding\r\n};\r\n\r\nIframeView.prototype.removeListeners = function(layoutFunc) {\r\n\t//TODO: remove content listeners for expanding\r\n};\r\n\r\nIframeView.prototype.display = function(request) {\r\n\tvar displayed = new core.defer();\r\n\r\n\tif (!this.displayed) {\r\n\r\n\t\tthis.render(request).then(function () {\r\n\r\n\t\t\tthis.emit(\"displayed\", this);\r\n\t\t\tthis.onDisplayed(this);\r\n\r\n\t\t\tthis.displayed = true;\r\n\t\t\tdisplayed.resolve(this);\r\n\r\n\t\t}.bind(this));\r\n\r\n\t} else {\r\n\t\tdisplayed.resolve(this);\r\n\t}\r\n\r\n\r\n\treturn displayed.promise;\r\n};\r\n\r\nIframeView.prototype.show = function() {\r\n\r\n\tthis.element.style.visibility = \"visible\";\r\n\r\n\tif(this.iframe){\r\n\t\tthis.iframe.style.visibility = \"visible\";\r\n\t}\r\n\r\n\tthis.emit(\"shown\", this);\r\n};\r\n\r\nIframeView.prototype.hide = function() {\r\n\t// this.iframe.style.display = \"none\";\r\n\tthis.element.style.visibility = \"hidden\";\r\n\tthis.iframe.style.visibility = \"hidden\";\r\n\r\n\tthis.stopExpanding = true;\r\n\tthis.emit(\"hidden\", this);\r\n};\r\n\r\nIframeView.prototype.position = function() {\r\n\treturn this.element.getBoundingClientRect();\r\n};\r\n\r\nIframeView.prototype.locationOf = function(target) {\r\n\tvar parentPos = this.iframe.getBoundingClientRect();\r\n\tvar targetPos = this.contents.locationOf(target, this.settings.ignoreClass);\r\n\r\n\treturn {\r\n\t\t\"left\": window.scrollX + parentPos.left + targetPos.left,\r\n\t\t\"top\": window.scrollY + parentPos.top + targetPos.top\r\n\t};\r\n};\r\n\r\nIframeView.prototype.onDisplayed = function(view) {\r\n\t// Stub, override with a custom functions\r\n};\r\n\r\nIframeView.prototype.onResize = function(view, e) {\r\n\t// Stub, override with a custom functions\r\n};\r\n\r\nIframeView.prototype.bounds = function() {\r\n\tif(!this.elementBounds) {\r\n\t\tthis.elementBounds = core.bounds(this.element);\r\n\t}\r\n\treturn this.elementBounds;\r\n};\r\n\r\nIframeView.prototype.destroy = function() {\r\n\r\n\tif(this.displayed){\r\n\t\tthis.displayed = false;\r\n\r\n\t\tthis.removeListeners();\r\n\r\n\t\tthis.stopExpanding = true;\r\n\t\tthis.element.removeChild(this.iframe);\r\n\t\tthis.displayed = false;\r\n\t\tthis.iframe = null;\r\n\r\n\t\tthis._textWidth = null;\r\n\t\tthis._textHeight = null;\r\n\t\tthis._width = null;\r\n\t\tthis._height = null;\r\n\t}\r\n\t// this.element.style.height = \"0px\";\r\n\t// this.element.style.width = \"0px\";\r\n};\r\n\r\nEventEmitter(IframeView.prototype);\r\n\r\nmodule.exports = IframeView;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/managers/views/iframe.js\n// module id = 19\n// module chunks = 0","/*\r\n From Zip.js, by Gildas Lormeau\r\nedited down\r\n */\r\n\r\nvar table = {\r\n\t\"application\" : {\r\n\t\t\"ecmascript\" : [ \"es\", \"ecma\" ],\r\n\t\t\"javascript\" : \"js\",\r\n\t\t\"ogg\" : \"ogx\",\r\n\t\t\"pdf\" : \"pdf\",\r\n\t\t\"postscript\" : [ \"ps\", \"ai\", \"eps\", \"epsi\", \"epsf\", \"eps2\", \"eps3\" ],\r\n\t\t\"rdf+xml\" : \"rdf\",\r\n\t\t\"smil\" : [ \"smi\", \"smil\" ],\r\n\t\t\"xhtml+xml\" : [ \"xhtml\", \"xht\" ],\r\n\t\t\"xml\" : [ \"xml\", \"xsl\", \"xsd\", \"opf\", \"ncx\" ],\r\n\t\t\"zip\" : \"zip\",\r\n\t\t\"x-httpd-eruby\" : \"rhtml\",\r\n\t\t\"x-latex\" : \"latex\",\r\n\t\t\"x-maker\" : [ \"frm\", \"maker\", \"frame\", \"fm\", \"fb\", \"book\", \"fbdoc\" ],\r\n\t\t\"x-object\" : \"o\",\r\n\t\t\"x-shockwave-flash\" : [ \"swf\", \"swfl\" ],\r\n\t\t\"x-silverlight\" : \"scr\",\r\n\t\t\"epub+zip\" : \"epub\",\r\n\t\t\"font-tdpfr\" : \"pfr\",\r\n\t\t\"inkml+xml\" : [ \"ink\", \"inkml\" ],\r\n\t\t\"json\" : \"json\",\r\n\t\t\"jsonml+json\" : \"jsonml\",\r\n\t\t\"mathml+xml\" : \"mathml\",\r\n\t\t\"metalink+xml\" : \"metalink\",\r\n\t\t\"mp4\" : \"mp4s\",\r\n\t\t// \"oebps-package+xml\" : \"opf\",\r\n\t\t\"omdoc+xml\" : \"omdoc\",\r\n\t\t\"oxps\" : \"oxps\",\r\n\t\t\"vnd.amazon.ebook\" : \"azw\",\r\n\t\t\"widget\" : \"wgt\",\r\n\t\t// \"x-dtbncx+xml\" : \"ncx\",\r\n\t\t\"x-dtbook+xml\" : \"dtb\",\r\n\t\t\"x-dtbresource+xml\" : \"res\",\r\n\t\t\"x-font-bdf\" : \"bdf\",\r\n\t\t\"x-font-ghostscript\" : \"gsf\",\r\n\t\t\"x-font-linux-psf\" : \"psf\",\r\n\t\t\"x-font-otf\" : \"otf\",\r\n\t\t\"x-font-pcf\" : \"pcf\",\r\n\t\t\"x-font-snf\" : \"snf\",\r\n\t\t\"x-font-ttf\" : [ \"ttf\", \"ttc\" ],\r\n\t\t\"x-font-type1\" : [ \"pfa\", \"pfb\", \"pfm\", \"afm\" ],\r\n\t\t\"x-font-woff\" : \"woff\",\r\n\t\t\"x-mobipocket-ebook\" : [ \"prc\", \"mobi\" ],\r\n\t\t\"x-mspublisher\" : \"pub\",\r\n\t\t\"x-nzb\" : \"nzb\",\r\n\t\t\"x-tgif\" : \"obj\",\r\n\t\t\"xaml+xml\" : \"xaml\",\r\n\t\t\"xml-dtd\" : \"dtd\",\r\n\t\t\"xproc+xml\" : \"xpl\",\r\n\t\t\"xslt+xml\" : \"xslt\",\r\n\t\t\"internet-property-stream\" : \"acx\",\r\n\t\t\"x-compress\" : \"z\",\r\n\t\t\"x-compressed\" : \"tgz\",\r\n\t\t\"x-gzip\" : \"gz\",\r\n\t},\r\n\t\"audio\" : {\r\n\t\t\"flac\" : \"flac\",\r\n\t\t\"midi\" : [ \"mid\", \"midi\", \"kar\", \"rmi\" ],\r\n\t\t\"mpeg\" : [ \"mpga\", \"mpega\", \"mp2\", \"mp3\", \"m4a\", \"mp2a\", \"m2a\", \"m3a\" ],\r\n\t\t\"mpegurl\" : \"m3u\",\r\n\t\t\"ogg\" : [ \"oga\", \"ogg\", \"spx\" ],\r\n\t\t\"x-aiff\" : [ \"aif\", \"aiff\", \"aifc\" ],\r\n\t\t\"x-ms-wma\" : \"wma\",\r\n\t\t\"x-wav\" : \"wav\",\r\n\t\t\"adpcm\" : \"adp\",\r\n\t\t\"mp4\" : \"mp4a\",\r\n\t\t\"webm\" : \"weba\",\r\n\t\t\"x-aac\" : \"aac\",\r\n\t\t\"x-caf\" : \"caf\",\r\n\t\t\"x-matroska\" : \"mka\",\r\n\t\t\"x-pn-realaudio-plugin\" : \"rmp\",\r\n\t\t\"xm\" : \"xm\",\r\n\t\t\"mid\" : [ \"mid\", \"rmi\" ]\r\n\t},\r\n\t\"image\" : {\r\n\t\t\"gif\" : \"gif\",\r\n\t\t\"ief\" : \"ief\",\r\n\t\t\"jpeg\" : [ \"jpeg\", \"jpg\", \"jpe\" ],\r\n\t\t\"pcx\" : \"pcx\",\r\n\t\t\"png\" : \"png\",\r\n\t\t\"svg+xml\" : [ \"svg\", \"svgz\" ],\r\n\t\t\"tiff\" : [ \"tiff\", \"tif\" ],\r\n\t\t\"x-icon\" : \"ico\",\r\n\t\t\"bmp\" : \"bmp\",\r\n\t\t\"webp\" : \"webp\",\r\n\t\t\"x-pict\" : [ \"pic\", \"pct\" ],\r\n\t\t\"x-tga\" : \"tga\",\r\n\t\t\"cis-cod\" : \"cod\"\r\n\t},\r\n\t\"text\" : {\r\n\t\t\"cache-manifest\" : [ \"manifest\", \"appcache\" ],\r\n\t\t\"css\" : \"css\",\r\n\t\t\"csv\" : \"csv\",\r\n\t\t\"html\" : [ \"html\", \"htm\", \"shtml\", \"stm\" ],\r\n\t\t\"mathml\" : \"mml\",\r\n\t\t\"plain\" : [ \"txt\", \"text\", \"brf\", \"conf\", \"def\", \"list\", \"log\", \"in\", \"bas\" ],\r\n\t\t\"richtext\" : \"rtx\",\r\n\t\t\"tab-separated-values\" : \"tsv\",\r\n\t\t\"x-bibtex\" : \"bib\"\r\n\t},\r\n\t\"video\" : {\r\n\t\t\"mpeg\" : [ \"mpeg\", \"mpg\", \"mpe\", \"m1v\", \"m2v\", \"mp2\", \"mpa\", \"mpv2\" ],\r\n\t\t\"mp4\" : [ \"mp4\", \"mp4v\", \"mpg4\" ],\r\n\t\t\"quicktime\" : [ \"qt\", \"mov\" ],\r\n\t\t\"ogg\" : \"ogv\",\r\n\t\t\"vnd.mpegurl\" : [ \"mxu\", \"m4u\" ],\r\n\t\t\"x-flv\" : \"flv\",\r\n\t\t\"x-la-asf\" : [ \"lsf\", \"lsx\" ],\r\n\t\t\"x-mng\" : \"mng\",\r\n\t\t\"x-ms-asf\" : [ \"asf\", \"asx\", \"asr\" ],\r\n\t\t\"x-ms-wm\" : \"wm\",\r\n\t\t\"x-ms-wmv\" : \"wmv\",\r\n\t\t\"x-ms-wmx\" : \"wmx\",\r\n\t\t\"x-ms-wvx\" : \"wvx\",\r\n\t\t\"x-msvideo\" : \"avi\",\r\n\t\t\"x-sgi-movie\" : \"movie\",\r\n\t\t\"x-matroska\" : [ \"mpv\", \"mkv\", \"mk3d\", \"mks\" ],\r\n\t\t\"3gpp2\" : \"3g2\",\r\n\t\t\"h261\" : \"h261\",\r\n\t\t\"h263\" : \"h263\",\r\n\t\t\"h264\" : \"h264\",\r\n\t\t\"jpeg\" : \"jpgv\",\r\n\t\t\"jpm\" : [ \"jpm\", \"jpgm\" ],\r\n\t\t\"mj2\" : [ \"mj2\", \"mjp2\" ],\r\n\t\t\"vnd.ms-playready.media.pyv\" : \"pyv\",\r\n\t\t\"vnd.uvvu.mp4\" : [ \"uvu\", \"uvvu\" ],\r\n\t\t\"vnd.vivo\" : \"viv\",\r\n\t\t\"webm\" : \"webm\",\r\n\t\t\"x-f4v\" : \"f4v\",\r\n\t\t\"x-m4v\" : \"m4v\",\r\n\t\t\"x-ms-vob\" : \"vob\",\r\n\t\t\"x-smv\" : \"smv\"\r\n\t}\r\n};\r\n\r\nvar mimeTypes = (function() {\r\n\tvar type, subtype, val, index, mimeTypes = {};\r\n\tfor (type in table) {\r\n\t\tif (table.hasOwnProperty(type)) {\r\n\t\t\tfor (subtype in table[type]) {\r\n\t\t\t\tif (table[type].hasOwnProperty(subtype)) {\r\n\t\t\t\t\tval = table[type][subtype];\r\n\t\t\t\t\tif (typeof val == \"string\") {\r\n\t\t\t\t\t\tmimeTypes[val] = type + \"/\" + subtype;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfor (index = 0; index < val.length; index++) {\r\n\t\t\t\t\t\t\tmimeTypes[val[index]] = type + \"/\" + subtype;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn mimeTypes;\r\n})();\r\n\r\nvar defaultValue = \"text/plain\";//\"application/octet-stream\";\r\n\r\nfunction lookup(filename) {\r\n\treturn filename && mimeTypes[filename.split(\".\").pop().toLowerCase()] || defaultValue;\r\n};\r\n\r\nmodule.exports = {\r\n\t'lookup': lookup\r\n}\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./libs/mime/mime.js\n// module id = 20\n// module chunks = 0","'use strict'\n\nexports.byteLength = byteLength\nexports.toByteArray = toByteArray\nexports.fromByteArray = fromByteArray\n\nvar lookup = []\nvar revLookup = []\nvar Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array\n\nvar code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\nfor (var i = 0, len = code.length; i < len; ++i) {\n  lookup[i] = code[i]\n  revLookup[code.charCodeAt(i)] = i\n}\n\nrevLookup['-'.charCodeAt(0)] = 62\nrevLookup['_'.charCodeAt(0)] = 63\n\nfunction placeHoldersCount (b64) {\n  var len = b64.length\n  if (len % 4 > 0) {\n    throw new Error('Invalid string. Length must be a multiple of 4')\n  }\n\n  // the number of equal signs (place holders)\n  // if there are two placeholders, than the two characters before it\n  // represent one byte\n  // if there is only one, then the three characters before it represent 2 bytes\n  // this is just a cheap hack to not do indexOf twice\n  return b64[len - 2] === '=' ? 2 : b64[len - 1] === '=' ? 1 : 0\n}\n\nfunction byteLength (b64) {\n  // base64 is 4/3 + up to two characters of the original data\n  return b64.length * 3 / 4 - placeHoldersCount(b64)\n}\n\nfunction toByteArray (b64) {\n  var i, j, l, tmp, placeHolders, arr\n  var len = b64.length\n  placeHolders = placeHoldersCount(b64)\n\n  arr = new Arr(len * 3 / 4 - placeHolders)\n\n  // if there are placeholders, only get up to the last complete 4 chars\n  l = placeHolders > 0 ? len - 4 : len\n\n  var L = 0\n\n  for (i = 0, j = 0; i < l; i += 4, j += 3) {\n    tmp = (revLookup[b64.charCodeAt(i)] << 18) | (revLookup[b64.charCodeAt(i + 1)] << 12) | (revLookup[b64.charCodeAt(i + 2)] << 6) | revLookup[b64.charCodeAt(i + 3)]\n    arr[L++] = (tmp >> 16) & 0xFF\n    arr[L++] = (tmp >> 8) & 0xFF\n    arr[L++] = tmp & 0xFF\n  }\n\n  if (placeHolders === 2) {\n    tmp = (revLookup[b64.charCodeAt(i)] << 2) | (revLookup[b64.charCodeAt(i + 1)] >> 4)\n    arr[L++] = tmp & 0xFF\n  } else if (placeHolders === 1) {\n    tmp = (revLookup[b64.charCodeAt(i)] << 10) | (revLookup[b64.charCodeAt(i + 1)] << 4) | (revLookup[b64.charCodeAt(i + 2)] >> 2)\n    arr[L++] = (tmp >> 8) & 0xFF\n    arr[L++] = tmp & 0xFF\n  }\n\n  return arr\n}\n\nfunction tripletToBase64 (num) {\n  return lookup[num >> 18 & 0x3F] + lookup[num >> 12 & 0x3F] + lookup[num >> 6 & 0x3F] + lookup[num & 0x3F]\n}\n\nfunction encodeChunk (uint8, start, end) {\n  var tmp\n  var output = []\n  for (var i = start; i < end; i += 3) {\n    tmp = (uint8[i] << 16) + (uint8[i + 1] << 8) + (uint8[i + 2])\n    output.push(tripletToBase64(tmp))\n  }\n  return output.join('')\n}\n\nfunction fromByteArray (uint8) {\n  var tmp\n  var len = uint8.length\n  var extraBytes = len % 3 // if we have 1 byte left, pad 2 bytes\n  var output = ''\n  var parts = []\n  var maxChunkLength = 16383 // must be multiple of 3\n\n  // go through the array every three bytes, we'll deal with trailing stuff later\n  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {\n    parts.push(encodeChunk(uint8, i, (i + maxChunkLength) > len2 ? len2 : (i + maxChunkLength)))\n  }\n\n  // pad the end with zeros, but make sure to not forget the extra bytes\n  if (extraBytes === 1) {\n    tmp = uint8[len - 1]\n    output += lookup[tmp >> 2]\n    output += lookup[(tmp << 4) & 0x3F]\n    output += '=='\n  } else if (extraBytes === 2) {\n    tmp = (uint8[len - 2] << 8) + (uint8[len - 1])\n    output += lookup[tmp >> 10]\n    output += lookup[(tmp >> 4) & 0x3F]\n    output += lookup[(tmp << 2) & 0x3F]\n    output += '='\n  }\n\n  parts.push(output)\n\n  return parts.join('')\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/base64-js/index.js\n// module id = 21\n// module chunks = 0","'use strict';\n\nvar assign        = require('es5-ext/object/assign')\n  , normalizeOpts = require('es5-ext/object/normalize-options')\n  , isCallable    = require('es5-ext/object/is-callable')\n  , contains      = require('es5-ext/string/#/contains')\n\n  , d;\n\nd = module.exports = function (dscr, value/*, options*/) {\n\tvar c, e, w, options, desc;\n\tif ((arguments.length < 2) || (typeof dscr !== 'string')) {\n\t\toptions = value;\n\t\tvalue = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[2];\n\t}\n\tif (dscr == null) {\n\t\tc = w = true;\n\t\te = false;\n\t} else {\n\t\tc = contains.call(dscr, 'c');\n\t\te = contains.call(dscr, 'e');\n\t\tw = contains.call(dscr, 'w');\n\t}\n\n\tdesc = { value: value, configurable: c, enumerable: e, writable: w };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n};\n\nd.gs = function (dscr, get, set/*, options*/) {\n\tvar c, e, options, desc;\n\tif (typeof dscr !== 'string') {\n\t\toptions = set;\n\t\tset = get;\n\t\tget = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[3];\n\t}\n\tif (get == null) {\n\t\tget = undefined;\n\t} else if (!isCallable(get)) {\n\t\toptions = get;\n\t\tget = set = undefined;\n\t} else if (set == null) {\n\t\tset = undefined;\n\t} else if (!isCallable(set)) {\n\t\toptions = set;\n\t\tset = undefined;\n\t}\n\tif (dscr == null) {\n\t\tc = true;\n\t\te = false;\n\t} else {\n\t\tc = contains.call(dscr, 'c');\n\t\te = contains.call(dscr, 'e');\n\t}\n\n\tdesc = { get: get, set: set, configurable: c, enumerable: e };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/d/index.js\n// module id = 22\n// module chunks = 0","'use strict';\n\nmodule.exports = require('./is-implemented')()\n\t? Object.assign\n\t: require('./shim');\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/object/assign/index.js\n// module id = 23\n// module chunks = 0","'use strict';\n\nmodule.exports = function () {\n\tvar assign = Object.assign, obj;\n\tif (typeof assign !== 'function') return false;\n\tobj = { foo: 'raz' };\n\tassign(obj, { bar: 'dwa' }, { trzy: 'trzy' });\n\treturn (obj.foo + obj.bar + obj.trzy) === 'razdwatrzy';\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/object/assign/is-implemented.js\n// module id = 24\n// module chunks = 0","'use strict';\n\nvar keys  = require('../keys')\n  , value = require('../valid-value')\n\n  , max = Math.max;\n\nmodule.exports = function (dest, src/*, …srcn*/) {\n\tvar error, i, l = max(arguments.length, 2), assign;\n\tdest = Object(value(dest));\n\tassign = function (key) {\n\t\ttry { dest[key] = src[key]; } catch (e) {\n\t\t\tif (!error) error = e;\n\t\t}\n\t};\n\tfor (i = 1; i < l; ++i) {\n\t\tsrc = arguments[i];\n\t\tkeys(src).forEach(assign);\n\t}\n\tif (error !== undefined) throw error;\n\treturn dest;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/object/assign/shim.js\n// module id = 25\n// module chunks = 0","// Deprecated\n\n'use strict';\n\nmodule.exports = function (obj) { return typeof obj === 'function'; };\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/object/is-callable.js\n// module id = 26\n// module chunks = 0","'use strict';\n\nmodule.exports = require('./is-implemented')()\n\t? Object.keys\n\t: require('./shim');\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/object/keys/index.js\n// module id = 27\n// module chunks = 0","'use strict';\n\nmodule.exports = function () {\n\ttry {\n\t\tObject.keys('primitive');\n\t\treturn true;\n\t} catch (e) { return false; }\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/object/keys/is-implemented.js\n// module id = 28\n// module chunks = 0","'use strict';\n\nvar keys = Object.keys;\n\nmodule.exports = function (object) {\n\treturn keys(object == null ? object : Object(object));\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/object/keys/shim.js\n// module id = 29\n// module chunks = 0","'use strict';\n\nvar forEach = Array.prototype.forEach, create = Object.create;\n\nvar process = function (src, obj) {\n\tvar key;\n\tfor (key in src) obj[key] = src[key];\n};\n\nmodule.exports = function (options/*, …options*/) {\n\tvar result = create(null);\n\tforEach.call(arguments, function (options) {\n\t\tif (options == null) return;\n\t\tprocess(Object(options), result);\n\t});\n\treturn result;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/object/normalize-options.js\n// module id = 30\n// module chunks = 0","'use strict';\n\nmodule.exports = function (fn) {\n\tif (typeof fn !== 'function') throw new TypeError(fn + \" is not a function\");\n\treturn fn;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/object/valid-callable.js\n// module id = 31\n// module chunks = 0","'use strict';\n\nmodule.exports = function (value) {\n\tif (value == null) throw new TypeError(\"Cannot use null or undefined\");\n\treturn value;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/object/valid-value.js\n// module id = 32\n// module chunks = 0","'use strict';\n\nmodule.exports = require('./is-implemented')()\n\t? String.prototype.contains\n\t: require('./shim');\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/string/#/contains/index.js\n// module id = 33\n// module chunks = 0","'use strict';\n\nvar str = 'razdwatrzy';\n\nmodule.exports = function () {\n\tif (typeof str.contains !== 'function') return false;\n\treturn ((str.contains('dwa') === true) && (str.contains('foo') === false));\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/string/#/contains/is-implemented.js\n// module id = 34\n// module chunks = 0","'use strict';\n\nvar indexOf = String.prototype.indexOf;\n\nmodule.exports = function (searchString/*, position*/) {\n\treturn indexOf.call(this, searchString, arguments[1]) > -1;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/es5-ext/string/#/contains/shim.js\n// module id = 35\n// module chunks = 0","var core = require('./core');\r\nvar request = require('./request');\r\nvar mime = require('../libs/mime/mime');\r\nvar Path = require('./core').Path;\r\n\r\n/**\r\n * Handles Unzipping a requesting files from an Epub Archive\r\n * @class\r\n */\r\nfunction Archive() {\r\n\tthis.zip = undefined;\r\n\tthis.checkRequirements();\r\n\tthis.urlCache = {};\r\n}\r\n\r\n/**\r\n * Checks to see if JSZip exists in global namspace,\r\n * Requires JSZip if it isn't there\r\n * @private\r\n */\r\nArchive.prototype.checkRequirements = function(){\r\n\ttry {\r\n\t\tif (typeof JSZip === 'undefined') {\r\n\t\t\tJSZip = require('jszip');\r\n\t\t}\r\n\t\tthis.zip = new JSZip();\r\n\t} catch (e) {\r\n\t\tconsole.error(\"JSZip lib not loaded\");\r\n\t}\r\n};\r\n\r\n/**\r\n * Open an archive\r\n * @param  {binary} input\r\n * @param  {boolean} isBase64 tells JSZip if the input data is base64 encoded\r\n * @return {Promise} zipfile\r\n */\r\nArchive.prototype.open = function(input, isBase64){\r\n\treturn this.zip.loadAsync(input, {\"base64\": isBase64});\r\n};\r\n\r\n/**\r\n * Load and Open an archive\r\n * @param  {string} zipUrl\r\n * @param  {boolean} isBase64 tells JSZip if the input data is base64 encoded\r\n * @return {Promise} zipfile\r\n */\r\nArchive.prototype.openUrl = function(zipUrl, isBase64){\r\n\treturn request(zipUrl, \"binary\")\r\n\t\t.then(function(data){\r\n\t\t\treturn this.zip.loadAsync(data, {\"base64\": isBase64});\r\n\t\t}.bind(this));\r\n};\r\n\r\n/**\r\n * Request\r\n * @param  {string} url  a url to request from the archive\r\n * @param  {[string]} type specify the type of the returned result\r\n * @return {Promise}\r\n */\r\nArchive.prototype.request = function(url, type){\r\n\tvar deferred = new core.defer();\r\n\tvar response;\r\n\tvar r;\r\n\tvar path = new Path(url);\r\n\r\n\t// If type isn't set, determine it from the file extension\r\n\tif(!type) {\r\n\t\ttype = path.extension;\r\n\t}\r\n\r\n\tif(type == 'blob'){\r\n\t\tresponse = this.getBlob(url);\r\n\t} else {\r\n\t\tresponse = this.getText(url);\r\n\t}\r\n\r\n\tif (response) {\r\n\t\tresponse.then(function (r) {\r\n\t\t\tresult = this.handleResponse(r, type);\r\n\t\t\tdeferred.resolve(result);\r\n\t\t}.bind(this));\r\n\t} else {\r\n\t\tdeferred.reject({\r\n\t\t\tmessage : \"File not found in the epub: \" + url,\r\n\t\t\tstack : new Error().stack\r\n\t\t});\r\n\t}\r\n\treturn deferred.promise;\r\n};\r\n\r\n/**\r\n * Handle the response from request\r\n * @private\r\n * @param  {any} response\r\n * @param  {[string]} type\r\n * @return {any} the parsed result\r\n */\r\nArchive.prototype.handleResponse = function(response, type){\r\n\tvar r;\r\n\r\n\tif(type == \"json\") {\r\n\t\tr = JSON.parse(response);\r\n\t}\r\n\telse\r\n\tif(core.isXml(type)) {\r\n\t\tr = core.parse(response, \"text/xml\");\r\n\t}\r\n\telse\r\n\tif(type == 'xhtml') {\r\n\t\tr = core.parse(response, \"application/xhtml+xml\");\r\n\t}\r\n\telse\r\n\tif(type == 'html' || type == 'htm') {\r\n\t\tr = core.parse(response, \"text/html\");\r\n\t } else {\r\n\t\t r = response;\r\n\t }\r\n\r\n\treturn r;\r\n};\r\n\r\n/**\r\n * Get a Blob from Archive by Url\r\n * @param  {string} url\r\n * @param  {[string]} mimeType\r\n * @return {Blob}\r\n */\r\nArchive.prototype.getBlob = function(url, mimeType){\r\n\tvar decodededUrl = window.decodeURIComponent(url.substr(1)); // Remove first slash\r\n\tvar entry = this.zip.file(decodededUrl);\r\n\r\n\tif(entry) {\r\n\t\tmimeType = mimeType || mime.lookup(entry.name);\r\n\t\treturn entry.async(\"uint8array\").then(function(uint8array) {\r\n\t\t\treturn new Blob([uint8array], {type : mimeType});\r\n\t\t});\r\n\t}\r\n};\r\n\r\n/**\r\n * Get Text from Archive by Url\r\n * @param  {string} url\r\n * @param  {[string]} encoding\r\n * @return {string}\r\n */\r\nArchive.prototype.getText = function(url, encoding){\r\n\tvar decodededUrl = window.decodeURIComponent(url.substr(1)); // Remove first slash\r\n\tvar entry = this.zip.file(decodededUrl);\r\n\r\n\tif(entry) {\r\n\t\treturn entry.async(\"string\").then(function(text) {\r\n\t\t\treturn text;\r\n\t\t});\r\n\t}\r\n};\r\n\r\n/**\r\n * Get a base64 encoded result from Archive by Url\r\n * @param  {string} url\r\n * @param  {[string]} mimeType\r\n * @return {string} base64 encoded\r\n */\r\nArchive.prototype.getBase64 = function(url, mimeType){\r\n\tvar decodededUrl = window.decodeURIComponent(url.substr(1)); // Remove first slash\r\n\tvar entry = this.zip.file(decodededUrl);\r\n\r\n\tif(entry) {\r\n\t\tmimeType = mimeType || mime.lookup(entry.name);\r\n\t\treturn entry.async(\"base64\").then(function(data) {\r\n\t\t\treturn \"data:\" + mimeType + \";base64,\" + data;\r\n\t\t});\r\n\t}\r\n};\r\n\r\n/**\r\n * Create a Url from an unarchived item\r\n * @param  {string} url\r\n * @param  {[object]} options.base64 use base64 encoding or blob url\r\n * @return {Promise} url promise with Url string\r\n */\r\nArchive.prototype.createUrl = function(url, options){\r\n\tvar deferred = new core.defer();\r\n\tvar _URL = window.URL || window.webkitURL || window.mozURL;\r\n\tvar tempUrl;\r\n\tvar blob;\r\n\tvar response;\r\n\tvar useBase64 = options && options.base64;\r\n\r\n\tif(url in this.urlCache) {\r\n\t\tdeferred.resolve(this.urlCache[url]);\r\n\t\treturn deferred.promise;\r\n\t}\r\n\r\n\tif (useBase64) {\r\n\t\tresponse = this.getBase64(url);\r\n\r\n\t\tif (response) {\r\n\t\t\tresponse.then(function(tempUrl) {\r\n\r\n\t\t\t\tthis.urlCache[url] = tempUrl;\r\n\t\t\t\tdeferred.resolve(tempUrl);\r\n\r\n\t\t\t}.bind(this));\r\n\r\n\t\t}\r\n\r\n\t} else {\r\n\r\n\t\tresponse = this.getBlob(url);\r\n\r\n\t\tif (response) {\r\n\t\t\tresponse.then(function(blob) {\r\n\r\n\t\t\t\ttempUrl = _URL.createObjectURL(blob);\r\n\t\t\t\tthis.urlCache[url] = tempUrl;\r\n\t\t\t\tdeferred.resolve(tempUrl);\r\n\r\n\t\t\t}.bind(this));\r\n\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tif (!response) {\r\n\t\tdeferred.reject({\r\n\t\t\tmessage : \"File not found in the epub: \" + url,\r\n\t\t\tstack : new Error().stack\r\n\t\t});\r\n\t}\r\n\r\n\treturn deferred.promise;\r\n};\r\n\r\n/**\r\n * Revoke Temp Url for a achive item\r\n * @param  {string} url url of the item in the archive\r\n */\r\nArchive.prototype.revokeUrl = function(url){\r\n\tvar _URL = window.URL || window.webkitURL || window.mozURL;\r\n\tvar fromCache = this.urlCache[url];\r\n\tif(fromCache) _URL.revokeObjectURL(fromCache);\r\n};\r\n\r\nmodule.exports = Archive;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/archive.js\n// module id = 36\n// module chunks = 0","var path = require('path');\r\nvar core = require('./core');\r\nvar EpubCFI = require('./epubcfi');\r\n\r\n/**\r\n * Handles Parsing and Accessing an Epub Container\r\n * @class\r\n * @param {[document]} containerDocument xml document\r\n */\r\nfunction Container(containerDocument) {\r\n\tif (containerDocument) {\r\n\t\tthis.parse(containerDocument);\r\n\t}\r\n};\r\n\r\n/**\r\n * Parse the Container XML\r\n * @param  {document} containerDocument\r\n */\r\nContainer.prototype.parse = function(containerDocument){\r\n\t\t//-- <rootfile full-path=\"OPS/package.opf\" media-type=\"application/oebps-package+xml\"/>\r\n\t\tvar rootfile, fullpath, folder, encoding;\r\n\r\n\t\tif(!containerDocument) {\r\n\t\t\tconsole.error(\"Container File Not Found\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\trootfile = core.qs(containerDocument, \"rootfile\");\r\n\r\n\t\tif(!rootfile) {\r\n\t\t\tconsole.error(\"No RootFile Found\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.packagePath = rootfile.getAttribute('full-path');\r\n\t\tthis.directory = path.dirname(this.packagePath);\r\n\t\tthis.encoding = containerDocument.xmlEncoding;\r\n};\r\n\r\nmodule.exports = Container;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/container.js\n// module id = 37\n// module chunks = 0","var core = require('./core');\r\n\r\n/**\r\n * Figures out the CSS to apply for a layout\r\n * @class\r\n * @param {object} settings\r\n * @param {[string=reflowable]} settings.layout\r\n * @param {[string]} settings.spread\r\n * @param {[int=800]} settings.minSpreadWidth\r\n * @param {[boolean=false]} settings.evenSpreads\r\n */\r\nfunction Layout(settings){\r\n\tthis.name = settings.layout || \"reflowable\";\r\n\tthis._spread = (settings.spread === \"none\") ? false : true;\r\n\tthis._minSpreadWidth = settings.minSpreadWidth || 800;\r\n\tthis._evenSpreads = settings.evenSpreads || false;\r\n\r\n\tif (settings.flow === \"scrolled-continuous\" ||\r\n\t\t\tsettings.flow === \"scrolled-doc\") {\r\n\t\tthis._flow = \"scrolled\";\r\n\t} else {\r\n\t\tthis._flow = \"paginated\";\r\n\t}\r\n\r\n\r\n\tthis.width = 0;\r\n\tthis.height = 0;\r\n\tthis.spreadWidth = 0;\r\n\tthis.delta = 0;\r\n\r\n\tthis.columnWidth = 0;\r\n\tthis.gap = 0;\r\n\tthis.divisor = 1;\r\n};\r\n\r\n/**\r\n * Switch the flow between paginated and scrolled\r\n * @param  {string} flow paginated | scrolled\r\n */\r\nLayout.prototype.flow = function(flow) {\r\n\tthis._flow = (flow === \"paginated\") ? \"paginated\" : \"scrolled\";\r\n}\r\n\r\n/**\r\n * Switch between using spreads or not, and set the\r\n * width at which they switch to single.\r\n * @param  {string} spread true | false\r\n * @param  {boolean} min integer in pixels\r\n */\r\nLayout.prototype.spread = function(spread, min) {\r\n\r\n\tthis._spread = (spread === \"none\") ? false : true;\r\n\r\n\tif (min >= 0) {\r\n\t\tthis._minSpreadWidth = min;\r\n\t}\r\n}\r\n\r\n/**\r\n * Calculate the dimensions of the pagination\r\n * @param  {number} _width  [description]\r\n * @param  {number} _height [description]\r\n * @param  {number} _gap    [description]\r\n */\r\nLayout.prototype.calculate = function(_width, _height, _gap){\r\n\r\n\tvar divisor = 1;\r\n\tvar gap = _gap || 0;\r\n\r\n\t//-- Check the width and create even width columns\r\n\tvar fullWidth = Math.floor(_width);\r\n\tvar width = _width;\r\n\r\n\tvar section = Math.floor(width / 8);\r\n\r\n\tvar colWidth;\r\n\tvar spreadWidth;\r\n\tvar delta;\r\n\r\n\tif (this._spread && width >= this._minSpreadWidth) {\r\n\t\tdivisor = 2;\r\n\t} else {\r\n\t\tdivisor = 1;\r\n\t}\r\n\r\n\tif (this.name === \"reflowable\" && this._flow === \"paginated\" && !(_gap >= 0)) {\r\n\t\tgap = ((section % 2 === 0) ? section : section - 1);\r\n\t}\r\n\r\n\tif (this.name === \"pre-paginated\" ) {\r\n\t\tgap = 0;\r\n\t}\r\n\r\n\t//-- Double Page\r\n\tif(divisor > 1) {\r\n\t\tcolWidth = (width - gap) / divisor;\r\n\t} else {\r\n\t\tcolWidth = width;\r\n\t}\r\n\r\n\tif (this.name === \"pre-paginated\" && divisor > 1) {\r\n\t\twidth = colWidth;\r\n\t}\r\n\r\n\tspreadWidth = colWidth * divisor;\r\n\r\n\tdelta = (colWidth + gap) * divisor;\r\n\r\n\tthis.width = width;\r\n\tthis.height = _height;\r\n\tthis.spreadWidth = spreadWidth;\r\n\tthis.delta = delta;\r\n\r\n\tthis.columnWidth = colWidth;\r\n\tthis.gap = gap;\r\n\tthis.divisor = divisor;\r\n};\r\n\r\n/**\r\n * Apply Css to a Document\r\n * @param  {Contents} contents\r\n * @return {[Promise]}\r\n */\r\nLayout.prototype.format = function(contents){\r\n\tvar formating;\r\n\r\n\tif (this.name === \"pre-paginated\") {\r\n\t\tformating = contents.fit(this.columnWidth, this.height);\r\n\t} else if (this._flow === \"paginated\") {\r\n\t\tformating = contents.columns(this.width, this.height, this.columnWidth, this.gap);\r\n\t} else { // scrolled\r\n\t\tformating = contents.size(this.width, null);\r\n\t}\r\n\r\n\treturn formating; // might be a promise in some View Managers\r\n};\r\n\r\n/**\r\n * Count number of pages\r\n * @param  {number} totalWidth\r\n * @return {number} spreads\r\n * @return {number} pages\r\n */\r\nLayout.prototype.count = function(totalWidth) {\r\n\t// var totalWidth = contents.scrollWidth();\r\n\tvar spreads = Math.ceil( totalWidth / this.spreadWidth);\r\n\r\n\treturn {\r\n\t\tspreads : spreads,\r\n\t\tpages : spreads * this.divisor\r\n\t};\r\n};\r\n\r\nmodule.exports = Layout;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/layout.js\n// module id = 38\n// module chunks = 0","var core = require('./core');\r\nvar Queue = require('./queue');\r\nvar EpubCFI = require('./epubcfi');\r\nvar EventEmitter = require('event-emitter');\r\n\r\n/**\r\n * Find Locations for a Book\r\n * @param {Spine} spine\r\n * @param {request} request\r\n */\r\nfunction Locations(spine, request) {\r\n\tthis.spine = spine;\r\n\tthis.request = request;\r\n\r\n\tthis.q = new Queue(this);\r\n\tthis.epubcfi = new EpubCFI();\r\n\r\n\tthis._locations = [];\r\n\tthis.total = 0;\r\n\r\n\tthis.break = 150;\r\n\r\n\tthis._current = 0;\r\n\r\n};\r\n\r\n/**\r\n * Load all of sections in the book to generate locations\r\n * @param  {int} chars how many chars to split on\r\n * @return {object} locations\r\n */\r\nLocations.prototype.generate = function(chars) {\r\n\r\n\tif (chars) {\r\n\t\tthis.break = chars;\r\n\t}\r\n\r\n\tthis.q.pause();\r\n\r\n\tthis.spine.each(function(section) {\r\n\r\n\t\tthis.q.enqueue(this.process.bind(this), section);\r\n\r\n\t}.bind(this));\r\n\r\n\treturn this.q.run().then(function() {\r\n\t\tthis.total = this._locations.length-1;\r\n\r\n\t\tif (this._currentCfi) {\r\n\t\t\tthis.currentLocation = this._currentCfi;\r\n\t\t}\r\n\r\n\t\treturn this._locations;\r\n\t\t// console.log(this.percentage(this.book.rendition.location.start), this.percentage(this.book.rendition.location.end));\r\n\t}.bind(this));\r\n\r\n};\r\n\r\nLocations.prototype.createRange = function () {\r\n\treturn {\r\n\t\tstartContainer: undefined,\r\n\t\tstartOffset: undefined,\r\n\t\tendContainer: undefined,\r\n\t\tendOffset: undefined\r\n\t}\r\n};\r\n\r\nLocations.prototype.process = function(section) {\r\n\r\n\treturn section.load(this.request)\r\n\t\t.then(function(contents) {\r\n\t\t\tvar locations = this.parse(contents, section.cfiBase);\r\n\t\t\tthis._locations = this._locations.concat(locations);\r\n\t\t}.bind(this));\r\n\r\n};\r\n\r\nLocations.prototype.parse = function(contents, cfiBase, chars) {\r\n\tvar locations = [];\r\n\tvar range;\r\n\tvar doc = contents.ownerDocument;\r\n\tvar body = core.qs(doc, 'body');\r\n\tvar counter = 0;\r\n\tvar prev;\r\n\tvar _break = chars || this.break;\r\n\tvar parser = function(node) {\r\n\t\tvar len = node.length;\r\n\t\tvar dist;\r\n\t\tvar pos = 0;\r\n\r\n\t\tif (node.textContent.trim().length === 0) {\r\n\t\t\treturn false; // continue\r\n\t\t}\r\n\r\n\t\t// Start range\r\n\t\tif (counter == 0) {\r\n\t\t\trange = this.createRange();\r\n\t\t\trange.startContainer = node;\r\n\t\t\trange.startOffset = 0;\r\n\t\t}\r\n\r\n\t\tdist = _break - counter;\r\n\r\n\t\t// Node is smaller than a break,\r\n\t\t// skip over it\r\n\t\tif(dist > len){\r\n\t\t\tcounter += len;\r\n\t\t\tpos = len;\r\n\t\t}\r\n\r\n\t\twhile (pos < len) {\r\n\t\t\t// counter = this.break;\r\n\t\t\tpos += dist;\r\n\t\t\t// Gone over\r\n\t\t\tif(pos >= len){\r\n\t\t\t\t// Continue counter for next node\r\n\t\t\t\tcounter = len - (pos - _break);\r\n\t\t\t// At End\r\n\t\t\t} else {\r\n\t\t\t\t// End the previous range\r\n\t\t\t\trange.endContainer = node;\r\n\t\t\t\trange.endOffset = pos;\r\n\t\t\t\t// cfi = section.cfiFromRange(range);\r\n\t\t\t\tcfi = new EpubCFI(range, cfiBase).toString();\r\n\t\t\t\tlocations.push(cfi);\r\n\t\t\t\tcounter = 0;\r\n\r\n\t\t\t\t// Start new range\r\n\t\t\t\tpos += 1;\r\n\t\t\t\trange = this.createRange();\r\n\t\t\t\trange.startContainer = node;\r\n\t\t\t\trange.startOffset = pos;\r\n\r\n\t\t\t\tdist = _break;\r\n\t\t\t}\r\n\t\t}\r\n\t\tprev = node;\r\n\t};\r\n\r\n\tcore.sprint(body, parser.bind(this));\r\n\r\n\t// Close remaining\r\n\tif (range && range.startContainer && prev) {\r\n\t\trange.endContainer = prev;\r\n\t\trange.endOffset = prev.length;\r\n\t\t// cfi = section.cfiFromRange(range);\r\n\t\tcfi = new EpubCFI(range, cfiBase).toString();\r\n\t\tlocations.push(cfi);\r\n\t\tcounter = 0;\r\n\t}\r\n\r\n\treturn locations;\r\n};\r\n\r\nLocations.prototype.locationFromCfi = function(cfi){\r\n\t// Check if the location has not been set yet\r\n\tif(this._locations.length === 0) {\r\n\t\treturn -1;\r\n\t}\r\n\treturn core.locationOf(cfi.start, this._locations, this.epubcfi.compare);\r\n};\r\n\r\nLocations.prototype.percentageFromCfi = function(cfi) {\r\n\tif(this._locations.length === 0) {\r\n\t\treturn null;\r\n\t}\r\n\t// Find closest cfi\r\n\tvar loc = this.locationFromCfi(cfi);\r\n\t// Get percentage in total\r\n\treturn this.percentageFromLocation(loc);\r\n};\r\n\r\nLocations.prototype.percentageFromLocation = function(loc) {\r\n\tif (!loc || !this.total) {\r\n\t\treturn 0;\r\n\t}\r\n\treturn (loc / this.total);\r\n};\r\n\r\nLocations.prototype.cfiFromLocation = function(loc){\r\n\tvar cfi = -1;\r\n\t// check that pg is an int\r\n\tif(typeof loc != \"number\"){\r\n\t\tloc = parseInt(pg);\r\n\t}\r\n\r\n\tif(loc >= 0 && loc < this._locations.length) {\r\n\t\tcfi = this._locations[loc];\r\n\t}\r\n\r\n\treturn cfi;\r\n};\r\n\r\nLocations.prototype.cfiFromPercentage = function(value){\r\n\tvar percentage = (value > 1) ? value / 100 : value; // Normalize value to 0-1\r\n\tvar loc = Math.ceil(this.total * percentage);\r\n\r\n\treturn this.cfiFromLocation(loc);\r\n};\r\n\r\nLocations.prototype.load = function(locations){\r\n\tthis._locations = JSON.parse(locations);\r\n\tthis.total = this._locations.length-1;\r\n\treturn this._locations;\r\n};\r\n\r\nLocations.prototype.save = function(json){\r\n\treturn JSON.stringify(this._locations);\r\n};\r\n\r\nLocations.prototype.getCurrent = function(json){\r\n\treturn this._current;\r\n};\r\n\r\nLocations.prototype.setCurrent = function(curr){\r\n\tvar loc;\r\n\r\n\tif(typeof curr == \"string\"){\r\n\t\tthis._currentCfi = curr;\r\n\t} else if (typeof curr == \"number\") {\r\n\t\tthis._current = curr;\r\n\t} else {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif(this._locations.length === 0) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif(typeof curr == \"string\"){\r\n\t\tloc = this.locationFromCfi(curr);\r\n\t\tthis._current = loc;\r\n\t} else {\r\n\t\tloc = curr;\r\n\t}\r\n\r\n\tthis.emit(\"changed\", {\r\n\t\tpercentage: this.percentageFromLocation(loc)\r\n\t});\r\n};\r\n\r\nObject.defineProperty(Locations.prototype, 'currentLocation', {\r\n\tget: function () {\r\n\t\treturn this._current;\r\n\t},\r\n\tset: function (curr) {\r\n\t\tthis.setCurrent(curr);\r\n\t}\r\n});\r\n\r\nLocations.prototype.length = function () {\r\n\treturn this._locations.length;\r\n};\r\n\r\nEventEmitter(Locations.prototype);\r\n\r\nmodule.exports = Locations;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/locations.js\n// module id = 39\n// module chunks = 0","var core = require('../../core');\r\n\r\nfunction Stage(_options) {\r\n\tthis.settings = _options || {};\r\n\tthis.id = \"epubjs-container-\" + core.uuid();\r\n\r\n\tthis.container = this.create(this.settings);\r\n\r\n\tif(this.settings.hidden) {\r\n\t\tthis.wrapper = this.wrap(this.container);\r\n\t}\r\n\r\n}\r\n\r\n/*\r\n* Creates an element to render to.\r\n* Resizes to passed width and height or to the elements size\r\n*/\r\nStage.prototype.create = function(options){\r\n\tvar height  = options.height;// !== false ? options.height : \"100%\";\r\n\tvar width   = options.width;// !== false ? options.width : \"100%\";\r\n\tvar overflow  = options.overflow || false;\r\n\tvar axis = options.axis || \"vertical\";\r\n\r\n\tif(options.height && core.isNumber(options.height)) {\r\n\t\theight = options.height + \"px\";\r\n\t}\r\n\r\n\tif(options.width && core.isNumber(options.width)) {\r\n\t\twidth = options.width + \"px\";\r\n\t}\r\n\r\n\t// Create new container element\r\n\tcontainer = document.createElement(\"div\");\r\n\r\n\tcontainer.id = this.id;\r\n\tcontainer.classList.add(\"epub-container\");\r\n\r\n\t// Style Element\r\n\t// container.style.fontSize = \"0\";\r\n\tcontainer.style.wordSpacing = \"0\";\r\n\tcontainer.style.lineHeight = \"0\";\r\n\tcontainer.style.verticalAlign = \"top\";\r\n\r\n\tif(axis === \"horizontal\") {\r\n\t\tcontainer.style.whiteSpace = \"nowrap\";\r\n\t}\r\n\r\n\tif(width){\r\n\t\tcontainer.style.width = width;\r\n\t}\r\n\r\n\tif(height){\r\n\t\tcontainer.style.height = height;\r\n\t}\r\n\r\n\tif (overflow) {\r\n\t\tcontainer.style.overflow = overflow;\r\n\t}\r\n\r\n\treturn container;\r\n};\r\n\r\nStage.wrap = function(container) {\r\n\tvar wrapper = document.createElement(\"div\");\r\n\r\n\twrapper.style.visibility = \"hidden\";\r\n\twrapper.style.overflow = \"hidden\";\r\n\twrapper.style.width = \"0\";\r\n\twrapper.style.height = \"0\";\r\n\r\n\twrapper.appendChild(container);\r\n\treturn wrapper;\r\n};\r\n\r\n\r\nStage.prototype.getElement = function(_element){\r\n\tvar element;\r\n\r\n\tif(core.isElement(_element)) {\r\n\t\telement = _element;\r\n\t} else if (typeof _element === \"string\") {\r\n\t\telement = document.getElementById(_element);\r\n\t}\r\n\r\n\tif(!element){\r\n\t\tconsole.error(\"Not an Element\");\r\n\t\treturn;\r\n\t}\r\n\r\n\treturn element;\r\n};\r\n\r\nStage.prototype.attachTo = function(what){\r\n\r\n\tvar element = this.getElement(what);\r\n\tvar base;\r\n\r\n\tif(!element){\r\n\t\treturn;\r\n\t}\r\n\r\n\tif(this.settings.hidden) {\r\n\t\tbase = this.wrapper;\r\n\t} else {\r\n\t\tbase = this.container;\r\n\t}\r\n\r\n\telement.appendChild(base);\r\n\r\n\tthis.element = element;\r\n\r\n\treturn element;\r\n\r\n};\r\n\r\nStage.prototype.getContainer = function() {\r\n\treturn this.container;\r\n};\r\n\r\nStage.prototype.onResize = function(func){\r\n\t// Only listen to window for resize event if width and height are not fixed.\r\n\t// This applies if it is set to a percent or auto.\r\n\tif(!core.isNumber(this.settings.width) ||\r\n\t\t !core.isNumber(this.settings.height) ) {\r\n\t\twindow.addEventListener(\"resize\", func, false);\r\n\t}\r\n\r\n};\r\n\r\nStage.prototype.size = function(width, height){\r\n\tvar bounds;\r\n\t// var width = _width || this.settings.width;\r\n\t// var height = _height || this.settings.height;\r\n\r\n\t// If width or height are set to false, inherit them from containing element\r\n\tif(width === null) {\r\n\t\tbounds = this.element.getBoundingClientRect();\r\n\r\n\t\tif(bounds.width) {\r\n\t\t\twidth = bounds.width;\r\n\t\t\tthis.container.style.width = bounds.width + \"px\";\r\n\t\t}\r\n\t}\r\n\r\n\tif(height === null) {\r\n\t\tbounds = bounds || this.element.getBoundingClientRect();\r\n\r\n\t\tif(bounds.height) {\r\n\t\t\theight = bounds.height;\r\n\t\t\tthis.container.style.height = bounds.height + \"px\";\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tif(!core.isNumber(width)) {\r\n\t\tbounds = this.container.getBoundingClientRect();\r\n\t\twidth = bounds.width;\r\n\t\t//height = bounds.height;\r\n\t}\r\n\r\n\tif(!core.isNumber(height)) {\r\n\t\tbounds = bounds || this.container.getBoundingClientRect();\r\n\t\t//width = bounds.width;\r\n\t\theight = bounds.height;\r\n\t}\r\n\r\n\r\n\tthis.containerStyles = window.getComputedStyle(this.container);\r\n\r\n\tthis.containerPadding = {\r\n\t\tleft: parseFloat(this.containerStyles[\"padding-left\"]) || 0,\r\n\t\tright: parseFloat(this.containerStyles[\"padding-right\"]) || 0,\r\n\t\ttop: parseFloat(this.containerStyles[\"padding-top\"]) || 0,\r\n\t\tbottom: parseFloat(this.containerStyles[\"padding-bottom\"]) || 0\r\n\t};\r\n\r\n\treturn {\r\n\t\twidth: width -\r\n\t\t\t\t\t\tthis.containerPadding.left -\r\n\t\t\t\t\t\tthis.containerPadding.right,\r\n\t\theight: height -\r\n\t\t\t\t\t\tthis.containerPadding.top -\r\n\t\t\t\t\t\tthis.containerPadding.bottom\r\n\t};\r\n\r\n};\r\n\r\nStage.prototype.bounds = function(){\r\n\r\n\tif(!this.container) {\r\n\t\treturn core.windowBounds();\r\n\t} else {\r\n\t\treturn this.container.getBoundingClientRect();\r\n\t}\r\n\r\n}\r\n\r\nStage.prototype.getSheet = function(){\r\n\tvar style = document.createElement(\"style\");\r\n\r\n\t// WebKit hack --> https://davidwalsh.name/add-rules-stylesheets\r\n\tstyle.appendChild(document.createTextNode(\"\"));\r\n\r\n\tdocument.head.appendChild(style);\r\n\r\n\treturn style.sheet;\r\n}\r\n\r\nStage.prototype.addStyleRules = function(selector, rulesArray){\r\n\tvar scope = \"#\" + this.id + \" \";\r\n\tvar rules = \"\";\r\n\r\n\tif(!this.sheet){\r\n\t\tthis.sheet = this.getSheet();\r\n\t}\r\n\r\n\trulesArray.forEach(function(set) {\r\n\t\tfor (var prop in set) {\r\n\t\t\tif(set.hasOwnProperty(prop)) {\r\n\t\t\t\trules += prop + \":\" + set[prop] + \";\";\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\r\n\tthis.sheet.insertRule(scope + selector + \" {\" + rules + \"}\", 0);\r\n}\r\n\r\n\r\n\r\nmodule.exports = Stage;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/managers/helpers/stage.js\n// module id = 40\n// module chunks = 0","function Views(container) {\r\n\tthis.container = container;\r\n\tthis._views = [];\r\n\tthis.length = 0;\r\n\tthis.hidden = false;\r\n};\r\n\r\nViews.prototype.all = function() {\r\n\treturn this._views;\r\n};\r\n\r\nViews.prototype.first = function() {\r\n\treturn this._views[0];\r\n};\r\n\r\nViews.prototype.last = function() {\r\n\treturn this._views[this._views.length-1];\r\n};\r\n\r\nViews.prototype.indexOf = function(view) {\r\n\treturn this._views.indexOf(view);\r\n};\r\n\r\nViews.prototype.slice = function() {\r\n\treturn this._views.slice.apply(this._views, arguments);\r\n};\r\n\r\nViews.prototype.get = function(i) {\r\n\treturn this._views[i];\r\n};\r\n\r\nViews.prototype.append = function(view){\r\n\tthis._views.push(view);\r\n\tif(this.container){\r\n\t\tthis.container.appendChild(view.element);\r\n\t}\r\n\tthis.length++;\r\n\treturn view;\r\n};\r\n\r\nViews.prototype.prepend = function(view){\r\n\tthis._views.unshift(view);\r\n\tif(this.container){\r\n\t\tthis.container.insertBefore(view.element, this.container.firstChild);\r\n\t}\r\n\tthis.length++;\r\n\treturn view;\r\n};\r\n\r\nViews.prototype.insert = function(view, index) {\r\n\tthis._views.splice(index, 0, view);\r\n\r\n\tif(this.container){\r\n\t\tif(index < this.container.children.length){\r\n\t\t\tthis.container.insertBefore(view.element, this.container.children[index]);\r\n\t\t} else {\r\n\t\t\tthis.container.appendChild(view.element);\r\n\t\t}\r\n\t}\r\n\r\n\tthis.length++;\r\n\treturn view;\r\n};\r\n\r\nViews.prototype.remove = function(view) {\r\n\tvar index = this._views.indexOf(view);\r\n\r\n\tif(index > -1) {\r\n\t\tthis._views.splice(index, 1);\r\n\t}\r\n\r\n\r\n\tthis.destroy(view);\r\n\r\n\tthis.length--;\r\n};\r\n\r\nViews.prototype.destroy = function(view) {\r\n\tif(view.displayed){\r\n\t\tview.destroy();\r\n\t}\r\n\r\n\tif(this.container){\r\n\t\t this.container.removeChild(view.element);\r\n\t}\r\n\tview = null;\r\n};\r\n\r\n// Iterators\r\n\r\nViews.prototype.each = function() {\r\n\treturn this._views.forEach.apply(this._views, arguments);\r\n};\r\n\r\nViews.prototype.clear = function(){\r\n\t// Remove all views\r\n\tvar view;\r\n\tvar len = this.length;\r\n\r\n\tif(!this.length) return;\r\n\r\n\tfor (var i = 0; i < len; i++) {\r\n\t\tview = this._views[i];\r\n\t\tthis.destroy(view);\r\n\t}\r\n\r\n\tthis._views = [];\r\n\tthis.length = 0;\r\n};\r\n\r\nViews.prototype.find = function(section){\r\n\r\n\tvar view;\r\n\tvar len = this.length;\r\n\r\n\tfor (var i = 0; i < len; i++) {\r\n\t\tview = this._views[i];\r\n\t\tif(view.displayed && view.section.index == section.index) {\r\n\t\t\treturn view;\r\n\t\t}\r\n\t}\r\n\r\n};\r\n\r\nViews.prototype.displayed = function(){\r\n\tvar displayed = [];\r\n\tvar view;\r\n\tvar len = this.length;\r\n\r\n\tfor (var i = 0; i < len; i++) {\r\n\t\tview = this._views[i];\r\n\t\tif(view.displayed){\r\n\t\t\tdisplayed.push(view);\r\n\t\t}\r\n\t}\r\n\treturn displayed;\r\n};\r\n\r\nViews.prototype.show = function(){\r\n\tvar view;\r\n\tvar len = this.length;\r\n\r\n\tfor (var i = 0; i < len; i++) {\r\n\t\tview = this._views[i];\r\n\t\tif(view.displayed){\r\n\t\t\tview.show();\r\n\t\t}\r\n\t}\r\n\tthis.hidden = false;\r\n};\r\n\r\nViews.prototype.hide = function(){\r\n\tvar view;\r\n\tvar len = this.length;\r\n\r\n\tfor (var i = 0; i < len; i++) {\r\n\t\tview = this._views[i];\r\n\t\tif(view.displayed){\r\n\t\t\tview.hide();\r\n\t\t}\r\n\t}\r\n\tthis.hidden = true;\r\n};\r\n\r\nmodule.exports = Views;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/managers/helpers/views.js\n// module id = 41\n// module chunks = 0","var core = require('./core');\r\nvar path = require('path');\r\n\r\n/**\r\n * Navigation Parser\r\n * @param {document} xml navigation html / xhtml / ncx\r\n */\r\nfunction Navigation(xml){\r\n\tthis.toc = [];\r\n\tthis.tocByHref = {};\r\n\tthis.tocById = {};\r\n\r\n\tif (xml) {\r\n\t\tthis.parse(xml);\r\n\t}\r\n};\r\n\r\n/**\r\n * Parse out the navigation items\r\n * @param {document} xml navigation html / xhtml / ncx\r\n */\r\nNavigation.prototype.parse = function(xml) {\r\n\tvar html = core.qs(xml, \"html\");\r\n\tvar ncx = core.qs(xml, \"ncx\");\r\n\r\n\tif(html) {\r\n\t\tthis.toc = this.parseNav(xml);\r\n\t} else if(ncx){\r\n\t\tthis.toc = this.parseNcx(xml);\r\n\t}\r\n\r\n\tthis.unpack(this.toc);\r\n};\r\n\r\n/**\r\n * Unpack navigation items\r\n * @private\r\n * @param  {array} toc\r\n */\r\nNavigation.prototype.unpack = function(toc) {\r\n\tvar item;\r\n\r\n\tfor (var i = 0; i < toc.length; i++) {\r\n\t\titem = toc[i];\r\n\t\tthis.tocByHref[item.href] = i;\r\n\t\tthis.tocById[item.id] = i;\r\n\t}\r\n\r\n};\r\n\r\n/**\r\n * Get an item from the navigation\r\n * @param  {string} target\r\n * @return {object} navItems\r\n */\r\nNavigation.prototype.get = function(target) {\r\n\tvar index;\r\n\r\n\tif(!target) {\r\n\t\treturn this.toc;\r\n\t}\r\n\r\n\tif(target.indexOf(\"#\") === 0) {\r\n\t\tindex = this.tocById[target.substring(1)];\r\n\t} else if(target in this.tocByHref){\r\n\t\tindex = this.tocByHref[target];\r\n\t}\r\n\r\n\treturn this.toc[index];\r\n};\r\n\r\n/**\r\n * Parse from a Epub > 3.0 Nav\r\n * @private\r\n * @param  {document} navHtml\r\n * @return {array} navigation list\r\n */\r\nNavigation.prototype.parseNav = function(navHtml){\r\n\tvar navElement = core.querySelectorByType(navHtml, \"nav\", \"toc\");\r\n\tvar navItems = navElement ? core.qsa(navElement, \"li\") : [];\r\n\tvar length = navItems.length;\r\n\tvar i;\r\n\tvar toc = {};\r\n\tvar list = [];\r\n\tvar item, parent;\r\n\r\n\tif(!navItems || length === 0) return list;\r\n\r\n\tfor (i = 0; i < length; ++i) {\r\n\t\titem = this.navItem(navItems[i]);\r\n\t\ttoc[item.id] = item;\r\n\t\tif(!item.parent) {\r\n\t\t\tlist.push(item);\r\n\t\t} else {\r\n\t\t\tparent = toc[item.parent];\r\n\t\t\tparent.subitems.push(item);\r\n\t\t}\r\n\t}\r\n\r\n\treturn list;\r\n};\r\n\r\n/**\r\n * Create a navItem\r\n * @private\r\n * @param  {element} item\r\n * @return {object} navItem\r\n */\r\nNavigation.prototype.navItem = function(item){\r\n\tvar id = item.getAttribute('id') || false,\r\n\t\t\tcontent = core.qs(item, \"a\"),\r\n\t\t\tsrc = content.getAttribute('href') || '',\r\n\t\t\ttext = content.textContent || \"\",\r\n\t\t\tsubitems = [],\r\n\t\t\tparentNode = item.parentNode,\r\n\t\t\tparent;\r\n\r\n\tif(parentNode && parentNode.nodeName === \"navPoint\") {\r\n\t\tparent = parentNode.getAttribute('id');\r\n\t}\r\n\r\n\treturn {\r\n\t\t\"id\": id,\r\n\t\t\"href\": src,\r\n\t\t\"label\": text,\r\n\t\t\"subitems\" : subitems,\r\n\t\t\"parent\" : parent\r\n\t};\r\n};\r\n\r\n/**\r\n * Parse from a Epub > 3.0 NC\r\n * @private\r\n * @param  {document} navHtml\r\n * @return {array} navigation list\r\n */\r\nNavigation.prototype.parseNcx = function(tocXml){\r\n\tvar navPoints = core.qsa(tocXml, \"navPoint\");\r\n\tvar length = navPoints.length;\r\n\tvar i;\r\n\tvar toc = {};\r\n\tvar list = [];\r\n\tvar item, parent;\r\n\r\n\tif(!navPoints || length === 0) return list;\r\n\r\n\tfor (i = 0; i < length; ++i) {\r\n\t\titem = this.ncxItem(navPoints[i]);\r\n\t\ttoc[item.id] = item;\r\n\t\tif(!item.parent) {\r\n\t\t\tlist.push(item);\r\n\t\t} else {\r\n\t\t\tparent = toc[item.parent];\r\n\t\t\tparent.subitems.push(item);\r\n\t\t}\r\n\t}\r\n\r\n\treturn list;\r\n};\r\n\r\n/**\r\n * Create a ncxItem\r\n * @private\r\n * @param  {element} item\r\n * @return {object} ncxItem\r\n */\r\nNavigation.prototype.ncxItem = function(item){\r\n\tvar id = item.getAttribute('id') || false,\r\n\t\t\tcontent = core.qs(item, \"content\"),\r\n\t\t\tsrc = content.getAttribute('src'),\r\n\t\t\tnavLabel = core.qs(item, \"navLabel\"),\r\n\t\t\ttext = navLabel.textContent ? navLabel.textContent : \"\",\r\n\t\t\tsubitems = [],\r\n\t\t\tparentNode = item.parentNode,\r\n\t\t\tparent;\r\n\r\n\tif(parentNode && parentNode.nodeName === \"navPoint\") {\r\n\t\tparent = parentNode.getAttribute('id');\r\n\t}\r\n\r\n\r\n\treturn {\r\n\t\t\"id\": id,\r\n\t\t\"href\": src,\r\n\t\t\"label\": text,\r\n\t\t\"subitems\" : subitems,\r\n\t\t\"parent\" : parent\r\n\t};\r\n};\r\n\r\n/**\r\n * forEach pass through\r\n * @param  {Function} fn function to run on each item\r\n * @return {method} forEach loop\r\n */\r\nNavigation.prototype.forEach = function(fn) {\r\n\treturn this.toc.forEach(fn);\r\n};\r\n\r\nmodule.exports = Navigation;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/navigation.js\n// module id = 42\n// module chunks = 0","var path = require('path');\r\nvar core = require('./core');\r\nvar EpubCFI = require('./epubcfi');\r\n\r\n/**\r\n * Open Packaging Format Parser\r\n * @class\r\n * @param {document} packageDocument OPF XML\r\n */\r\nfunction Packaging(packageDocument) {\r\n\tif (packageDocument) {\r\n\t\tthis.parse(packageDocument);\r\n\t}\r\n};\r\n\r\n/**\r\n * Parse OPF XML\r\n * @param  {document} packageDocument OPF XML\r\n * @return {object} parsed package parts\r\n */\r\nPackaging.prototype.parse = function(packageDocument){\r\n\tvar metadataNode, manifestNode, spineNode;\r\n\r\n\tif(!packageDocument) {\r\n\t\tconsole.error(\"Package File Not Found\");\r\n\t\treturn;\r\n\t}\r\n\r\n\tmetadataNode = core.qs(packageDocument, \"metadata\");\r\n\tif(!metadataNode) {\r\n\t\tconsole.error(\"No Metadata Found\");\r\n\t\treturn;\r\n\t}\r\n\r\n\tmanifestNode = core.qs(packageDocument, \"manifest\");\r\n\tif(!manifestNode) {\r\n\t\tconsole.error(\"No Manifest Found\");\r\n\t\treturn;\r\n\t}\r\n\r\n\tspineNode = core.qs(packageDocument, \"spine\");\r\n\tif(!spineNode) {\r\n\t\tconsole.error(\"No Spine Found\");\r\n\t\treturn;\r\n\t}\r\n\r\n\tthis.manifest = this.parseManifest(manifestNode);\r\n\tthis.navPath = this.findNavPath(manifestNode);\r\n\tthis.ncxPath = this.findNcxPath(manifestNode, spineNode);\r\n\tthis.coverPath = this.findCoverPath(packageDocument);\r\n\r\n\tthis.spineNodeIndex = Array.prototype.indexOf.call(spineNode.parentNode.childNodes, spineNode);\r\n\r\n\tthis.spine = this.parseSpine(spineNode, this.manifest);\r\n\r\n\tthis.metadata = this.parseMetadata(metadataNode);\r\n\r\n\tthis.metadata.direction = spineNode.getAttribute(\"page-progression-direction\");\r\n\r\n\r\n\treturn {\r\n\t\t'metadata' : this.metadata,\r\n\t\t'spine'    : this.spine,\r\n\t\t'manifest' : this.manifest,\r\n\t\t'navPath'  : this.navPath,\r\n\t\t'ncxPath'  : this.ncxPath,\r\n\t\t'coverPath': this.coverPath,\r\n\t\t'spineNodeIndex' : this.spineNodeIndex\r\n\t};\r\n};\r\n\r\n/**\r\n * Parse Metadata\r\n * @private\r\n * @param  {document} xml\r\n * @return {object} metadata\r\n */\r\nPackaging.prototype.parseMetadata = function(xml){\r\n\tvar metadata = {};\r\n\r\n\tmetadata.title = this.getElementText(xml, 'title');\r\n\tmetadata.creator = this.getElementText(xml, 'creator');\r\n\tmetadata.description = this.getElementText(xml, 'description');\r\n\r\n\tmetadata.pubdate = this.getElementText(xml, 'date');\r\n\r\n\tmetadata.publisher = this.getElementText(xml, 'publisher');\r\n\r\n\tmetadata.identifier = this.getElementText(xml, \"identifier\");\r\n\tmetadata.language = this.getElementText(xml, \"language\");\r\n\tmetadata.rights = this.getElementText(xml, \"rights\");\r\n\r\n\tmetadata.modified_date = this.getPropertyText(xml, 'dcterms:modified');\r\n\r\n\tmetadata.layout = this.getPropertyText(xml, \"rendition:layout\");\r\n\tmetadata.orientation = this.getPropertyText(xml, 'rendition:orientation');\r\n\tmetadata.flow = this.getPropertyText(xml, 'rendition:flow');\r\n\tmetadata.viewport = this.getPropertyText(xml, 'rendition:viewport');\r\n\t// metadata.page_prog_dir = packageXml.querySelector(\"spine\").getAttribute(\"page-progression-direction\");\r\n\r\n\treturn metadata;\r\n};\r\n\r\n/**\r\n * Parse Manifest\r\n * @private\r\n * @param  {document} manifestXml\r\n * @return {object} manifest\r\n */\r\nPackaging.prototype.parseManifest = function(manifestXml){\r\n\tvar manifest = {};\r\n\r\n\t//-- Turn items into an array\r\n\t// var selected = manifestXml.querySelectorAll(\"item\");\r\n\tvar selected = core.qsa(manifestXml, \"item\");\r\n\tvar items = Array.prototype.slice.call(selected);\r\n\r\n\t//-- Create an object with the id as key\r\n\titems.forEach(function(item){\r\n\t\tvar id = item.getAttribute('id'),\r\n\t\t\t\thref = item.getAttribute('href') || '',\r\n\t\t\t\ttype = item.getAttribute('media-type') || '',\r\n\t\t\t\tproperties = item.getAttribute('properties') || '';\r\n\r\n\t\tmanifest[id] = {\r\n\t\t\t'href' : href,\r\n\t\t\t// 'url' : href,\r\n\t\t\t'type' : type,\r\n\t\t\t'properties' : properties.length ? properties.split(' ') : []\r\n\t\t};\r\n\r\n\t});\r\n\r\n\treturn manifest;\r\n\r\n};\r\n\r\n/**\r\n * Parse Spine\r\n * @param  {document} spineXml\r\n * @param  {Packaging.manifest} manifest\r\n * @return {object} spine\r\n */\r\nPackaging.prototype.parseSpine = function(spineXml, manifest){\r\n\tvar spine = [];\r\n\r\n\tvar selected = spineXml.getElementsByTagName(\"itemref\"),\r\n\t\t\titems = Array.prototype.slice.call(selected);\r\n\r\n\tvar epubcfi = new EpubCFI();\r\n\r\n\t//-- Add to array to mantain ordering and cross reference with manifest\r\n\titems.forEach(function(item, index){\r\n\t\tvar idref = item.getAttribute('idref');\r\n\t\t// var cfiBase = epubcfi.generateChapterComponent(spineNodeIndex, index, Id);\r\n\t\tvar props = item.getAttribute('properties') || '';\r\n\t\tvar propArray = props.length ? props.split(' ') : [];\r\n\t\t// var manifestProps = manifest[Id].properties;\r\n\t\t// var manifestPropArray = manifestProps.length ? manifestProps.split(' ') : [];\r\n\r\n\t\tvar itemref = {\r\n\t\t\t'idref' : idref,\r\n\t\t\t'linear' : item.getAttribute('linear') || '',\r\n\t\t\t'properties' : propArray,\r\n\t\t\t// 'href' : manifest[Id].href,\r\n\t\t\t// 'url' :  manifest[Id].url,\r\n\t\t\t'index' : index\r\n\t\t\t// 'cfiBase' : cfiBase\r\n\t\t};\r\n\t\tspine.push(itemref);\r\n\t});\r\n\r\n\treturn spine;\r\n};\r\n\r\n/**\r\n * Find TOC NAV\r\n * @private\r\n */\r\nPackaging.prototype.findNavPath = function(manifestNode){\r\n\t// Find item with property 'nav'\r\n\t// Should catch nav irregardless of order\r\n\t// var node = manifestNode.querySelector(\"item[properties$='nav'], item[properties^='nav '], item[properties*=' nav ']\");\r\n\tvar node = core.qsp(manifestNode, \"item\", {\"properties\":\"nav\"});\r\n\treturn node ? node.getAttribute('href') : false;\r\n};\r\n\r\n/**\r\n * Find TOC NCX\r\n * media-type=\"application/x-dtbncx+xml\" href=\"toc.ncx\"\r\n * @private\r\n */\r\nPackaging.prototype.findNcxPath = function(manifestNode, spineNode){\r\n\t// var node = manifestNode.querySelector(\"item[media-type='application/x-dtbncx+xml']\");\r\n\tvar node = core.qsp(manifestNode, \"item\", {\"media-type\":\"application/x-dtbncx+xml\"});\r\n\tvar tocId;\r\n\r\n\t// If we can't find the toc by media-type then try to look for id of the item in the spine attributes as\r\n\t// according to http://www.idpf.org/epub/20/spec/OPF_2.0.1_draft.htm#Section2.4.1.2,\r\n\t// \"The item that describes the NCX must be referenced by the spine toc attribute.\"\r\n\tif (!node) {\r\n\t\ttocId = spineNode.getAttribute(\"toc\");\r\n\t\tif(tocId) {\r\n\t\t\t// node = manifestNode.querySelector(\"item[id='\" + tocId + \"']\");\r\n\t\t\tnode = manifestNode.getElementById(tocId);\r\n\t\t}\r\n\t}\r\n\r\n\treturn node ? node.getAttribute('href') : false;\r\n};\r\n\r\n/**\r\n * Find the Cover Path\r\n * <item properties=\"cover-image\" id=\"ci\" href=\"cover.svg\" media-type=\"image/svg+xml\" />\r\n * Fallback for Epub 2.0\r\n * @param  {document} packageXml\r\n * @return {string} href\r\n */\r\nPackaging.prototype.findCoverPath = function(packageXml){\r\n\tvar pkg = core.qs(packageXml, \"package\");\r\n\tvar epubVersion = pkg.getAttribute('version');\r\n\r\n\tif (epubVersion === '2.0') {\r\n\t\tvar metaCover = core.qsp(packageXml, 'meta', {'name':'cover'});\r\n\t\tif (metaCover) {\r\n\t\t\tvar coverId = metaCover.getAttribute('content');\r\n\t\t\t// var cover = packageXml.querySelector(\"item[id='\" + coverId + \"']\");\r\n\t\t\tvar cover = packageXml.getElementById(coverId);\r\n\t\t\treturn cover ? cover.getAttribute('href') : '';\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\t// var node = packageXml.querySelector(\"item[properties='cover-image']\");\r\n\t\tvar node = core.qsp(packageXml, 'item', {'properties':'cover-image'});\r\n\t\treturn node ? node.getAttribute('href') : '';\r\n\t}\r\n};\r\n\r\n/**\r\n * Get text of a namespaced element\r\n * @private\r\n * @param  {document} xml\r\n * @param  {string} tag\r\n * @return {string} text\r\n */\r\nPackaging.prototype.getElementText = function(xml, tag){\r\n\tvar found = xml.getElementsByTagNameNS(\"http://purl.org/dc/elements/1.1/\", tag),\r\n\t\tel;\r\n\r\n\tif(!found || found.length === 0) return '';\r\n\r\n\tel = found[0];\r\n\r\n\tif(el.childNodes.length){\r\n\t\treturn el.childNodes[0].nodeValue;\r\n\t}\r\n\r\n\treturn '';\r\n\r\n};\r\n\r\n/**\r\n * Get text by property\r\n * @private\r\n * @param  {document} xml\r\n * @param  {string} property\r\n * @return {string} text\r\n */\r\nPackaging.prototype.getPropertyText = function(xml, property){\r\n\tvar el = core.qsp(xml, \"meta\", {\"property\":property});\r\n\r\n\tif(el && el.childNodes.length){\r\n\t\treturn el.childNodes[0].nodeValue;\r\n\t}\r\n\r\n\treturn '';\r\n};\r\n\r\nmodule.exports = Packaging;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/packaging.js\n// module id = 43\n// module chunks = 0","var EpubCFI = require('./epubcfi');\r\nvar core = require('./core');\r\n\r\n/**\r\n * Page List Parser\r\n * @param {[document]} xml\r\n */\r\nfunction PageList(xml) {\r\n\tthis.pages = [];\r\n\tthis.locations = [];\r\n\tthis.epubcfi = new EpubCFI();\r\n\r\n\tif (xml) {\r\n\t\tthis.pageList = this.parse(xml);\r\n\t}\r\n\r\n\tif(this.pageList && this.pageList.length) {\r\n\t\tthis.process(this.pageList);\r\n\t}\r\n};\r\n\r\n/**\r\n * Parse PageList Xml\r\n * @param  {document} xml\r\n */\r\nPageList.prototype.parse = function(xml) {\r\n\tvar html = core.qs(xml, \"html\");\r\n\t// var ncx = core.qs(xml, \"ncx\");\r\n\r\n\tif(html) {\r\n\t\tthis.toc = this.parseNav(xml);\r\n\t} /*else if(ncx){ // Not supported\r\n\t\tthis.toc = this.parseNcx(xml);\r\n\t\treturn;\r\n\t}\r\n*/\r\n};\r\n\r\n/**\r\n * Parse a Nav PageList\r\n * @private\r\n * @param  {document} navHtml\r\n * @return {PageList.item[]} list\r\n */\r\nPageList.prototype.parseNav = function(navHtml){\r\n\tvar navElement = core.querySelectorByType(navHtml, \"nav\", \"page-list\");\r\n\tvar navItems = navElement ? core.qsa(navElement, \"li\") : [];\r\n\tvar length = navItems.length;\r\n\tvar i;\r\n\tvar toc = {};\r\n\tvar list = [];\r\n\tvar item;\r\n\r\n\tif(!navItems || length === 0) return list;\r\n\r\n\tfor (i = 0; i < length; ++i) {\r\n\t\titem = this.item(navItems[i]);\r\n\t\tlist.push(item);\r\n\t}\r\n\r\n\treturn list;\r\n};\r\n\r\n/**\r\n * Page List Item\r\n * @private\r\n * @param  {object} item\r\n * @return {object} pageListItem\r\n */\r\nPageList.prototype.item = function(item){\r\n\tvar id = item.getAttribute('id') || false,\r\n\t\tcontent = core.qs(item, \"a\"),\r\n\t\thref = content.getAttribute('href') || '',\r\n\t\ttext = content.textContent || \"\",\r\n\t\tpage = parseInt(text),\r\n\t\tisCfi = href.indexOf(\"epubcfi\"),\r\n\t\tsplit,\r\n\t\tpackageUrl,\r\n\t\tcfi;\r\n\r\n\tif(isCfi != -1) {\r\n\t\tsplit = href.split(\"#\");\r\n\t\tpackageUrl = split[0];\r\n\t\tcfi = split.length > 1 ? split[1] : false;\r\n\t\treturn {\r\n\t\t\t\"cfi\" : cfi,\r\n\t\t\t\"href\" : href,\r\n\t\t\t\"packageUrl\" : packageUrl,\r\n\t\t\t\"page\" : page\r\n\t\t};\r\n\t} else {\r\n\t\treturn {\r\n\t\t\t\"href\" : href,\r\n\t\t\t\"page\" : page\r\n\t\t};\r\n\t}\r\n};\r\n\r\n/**\r\n * Process pageList items\r\n * @private\r\n * @param  {array} pageList\r\n */\r\nPageList.prototype.process = function(pageList){\r\n\tpageList.forEach(function(item){\r\n\t\tthis.pages.push(item.page);\r\n\t\tif (item.cfi) {\r\n\t\t\tthis.locations.push(item.cfi);\r\n\t\t}\r\n\t}, this);\r\n\tthis.firstPage = parseInt(this.pages[0]);\r\n\tthis.lastPage = parseInt(this.pages[this.pages.length-1]);\r\n\tthis.totalPages = this.lastPage - this.firstPage;\r\n};\r\n\r\n\r\n/**\r\n * Replace HREFs with CFI\r\n * TODO: implement getting CFI from Href\r\n */\r\nPageList.prototype.addCFIs = function() {\r\n\tthis.pageList.forEach(function(pg){\r\n\t\tif(!pg.cfi) {\r\n\t\t\t// epubcfi.generateCfiFromHref(pg.href, book).then(function(cfi){\r\n\t\t\t// \tpg.cfi = cfi;\r\n\t\t\t// \tpg.packageUrl = book.settings.packageUrl;\r\n\t\t\t// });\r\n\t\t}\r\n\t});\r\n}\r\n\r\n/*\r\nEPUBJS.EpubCFI.prototype.generateCfiFromHref = function(href, book) {\r\n  var uri = EPUBJS.core.uri(href);\r\n  var path = uri.path;\r\n  var fragment = uri.fragment;\r\n  var spinePos = book.spineIndexByURL[path];\r\n  var loaded;\r\n  var deferred = new RSVP.defer();\r\n  var epubcfi = new EPUBJS.EpubCFI();\r\n  var spineItem;\r\n\r\n  if(typeof spinePos !== \"undefined\"){\r\n    spineItem = book.spine[spinePos];\r\n    loaded = book.loadXml(spineItem.url);\r\n    loaded.then(function(doc){\r\n      var element = doc.getElementById(fragment);\r\n      var cfi;\r\n      cfi = epubcfi.generateCfiFromElement(element, spineItem.cfiBase);\r\n      deferred.resolve(cfi);\r\n    });\r\n  }\r\n\r\n  return deferred.promise;\r\n};\r\n*/\r\n\r\n/**\r\n * Get a PageList result from a EpubCFI\r\n * @param  {string} cfi EpubCFI String\r\n * @return {string} page\r\n */\r\nPageList.prototype.pageFromCfi = function(cfi){\r\n\tvar pg = -1;\r\n\r\n\t// Check if the pageList has not been set yet\r\n\tif(this.locations.length === 0) {\r\n\t\treturn -1;\r\n\t}\r\n\r\n\t// TODO: check if CFI is valid?\r\n\r\n\t// check if the cfi is in the location list\r\n\t// var index = this.locations.indexOf(cfi);\r\n\tvar index = core.indexOfSorted(cfi, this.locations, this.epubcfi.compare);\r\n\tif(index != -1) {\r\n\t\tpg = this.pages[index];\r\n\t} else {\r\n\t\t// Otherwise add it to the list of locations\r\n\t\t// Insert it in the correct position in the locations page\r\n\t\t//index = EPUBJS.core.insert(cfi, this.locations, this.epubcfi.compare);\r\n\t\tindex = EPUBJS.core.locationOf(cfi, this.locations, this.epubcfi.compare);\r\n\t\t// Get the page at the location just before the new one, or return the first\r\n\t\tpg = index-1 >= 0 ? this.pages[index-1] : this.pages[0];\r\n\t\tif(pg !== undefined) {\r\n\t\t\t// Add the new page in so that the locations and page array match up\r\n\t\t\t//this.pages.splice(index, 0, pg);\r\n\t\t} else {\r\n\t\t\tpg = -1;\r\n\t\t}\r\n\r\n\t}\r\n\treturn pg;\r\n};\r\n\r\n/**\r\n * Get an EpubCFI from a Page List Item\r\n * @param  {string} pg\r\n * @return {string} cfi\r\n */\r\nPageList.prototype.cfiFromPage = function(pg){\r\n\tvar cfi = -1;\r\n\t// check that pg is an int\r\n\tif(typeof pg != \"number\"){\r\n\t\tpg = parseInt(pg);\r\n\t}\r\n\r\n\t// check if the cfi is in the page list\r\n\t// Pages could be unsorted.\r\n\tvar index = this.pages.indexOf(pg);\r\n\tif(index != -1) {\r\n\t\tcfi = this.locations[index];\r\n\t}\r\n\t// TODO: handle pages not in the list\r\n\treturn cfi;\r\n};\r\n\r\n/**\r\n * Get a Page from Book percentage\r\n * @param  {number} percent\r\n * @return {string} page\r\n */\r\nPageList.prototype.pageFromPercentage = function(percent){\r\n\tvar pg = Math.round(this.totalPages * percent);\r\n\treturn pg;\r\n};\r\n\r\n/**\r\n * Returns a value between 0 - 1 corresponding to the location of a page\r\n * @param  {int} pg the page\r\n * @return {number} percentage\r\n */\r\nPageList.prototype.percentageFromPage = function(pg){\r\n\tvar percentage = (pg - this.firstPage) / this.totalPages;\r\n\treturn Math.round(percentage * 1000) / 1000;\r\n};\r\n\r\n/**\r\n * Returns a value between 0 - 1 corresponding to the location of a cfi\r\n * @param  {string} cfi EpubCFI String\r\n * @return {number} percentage\r\n */\r\nPageList.prototype.percentageFromCfi = function(cfi){\r\n\tvar pg = this.pageFromCfi(cfi);\r\n\tvar percentage = this.percentageFromPage(pg);\r\n\treturn percentage;\r\n};\r\n\r\nmodule.exports = PageList;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pagelist.js\n// module id = 44\n// module chunks = 0","var replace = require('./replacements');\r\nvar core = require('./core');\r\nvar Path = require('./core').Path;\r\nvar path = require('path');\r\n\r\n/**\r\n * Handle Package Resources\r\n * @class\r\n * @param {Manifest} manifest\r\n * @param {[object]} options\r\n * @param {[string='base64']} options.replacements\r\n * @param {[Archive]} options.archive\r\n * @param {[method]} options.resolver\r\n */\r\nfunction Resources(manifest, options) {\r\n\tthis.settings = {\r\n\t\treplacements: (options && options.replacements) || 'base64',\r\n\t\tarchive: (options && options.archive),\r\n\t\tresolver: (options && options.resolver)\r\n\t};\r\n\tthis.manifest = manifest;\r\n\tthis.resources = Object.keys(manifest).\r\n\t\tmap(function (key){\r\n\t\t\treturn manifest[key];\r\n\t\t});\r\n\r\n\tthis.replacementUrls = [];\r\n\r\n\tthis.split();\r\n\tthis.splitUrls();\r\n}\r\n\r\n/**\r\n * Split resources by type\r\n * @private\r\n */\r\nResources.prototype.split = function(){\r\n\r\n\t// HTML\r\n\tthis.html = this.resources.\r\n\t\tfilter(function (item){\r\n\t\t\tif (item.type === \"application/xhtml+xml\" ||\r\n\t\t\t\t\titem.type === \"text/html\") {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t// Exclude HTML\r\n\tthis.assets = this.resources.\r\n\t\tfilter(function (item){\r\n\t\t\tif (item.type !== \"application/xhtml+xml\" &&\r\n\t\t\t\t\titem.type !== \"text/html\") {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t// Only CSS\r\n\tthis.css = this.resources.\r\n\t\tfilter(function (item){\r\n\t\t\tif (item.type === \"text/css\") {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n};\r\n\r\n/**\r\n * Convert split resources into Urls\r\n * @private\r\n */\r\nResources.prototype.splitUrls = function(){\r\n\r\n\t// All Assets Urls\r\n\tthis.urls = this.assets.\r\n\t\tmap(function(item) {\r\n\t\t\treturn item.href;\r\n\t\t}.bind(this));\r\n\r\n\t// Css Urls\r\n\tthis.cssUrls = this.css.map(function(item) {\r\n\t\treturn item.href;\r\n\t});\r\n\r\n};\r\n\r\n/**\r\n * Create blob urls for all the assets\r\n * @param  {Archive} archive\r\n * @param  {resolver} resolver Url resolver\r\n * @return {Promise}         returns replacement urls\r\n */\r\nResources.prototype.replacements = function(archive, resolver){\r\n\tarchive = archive || this.settings.archive;\r\n\tresolver = resolver || this.settings.resolver;\r\n\r\n\tif (this.settings.replacements === \"none\") {\r\n\t\treturn new Promise(function(resolve, reject) {\r\n\t\t\tresolve(this.urls);\r\n\t\t}.bind(this));\r\n\t}\r\n\r\n\tvar replacements = this.urls.\r\n\t\tmap(function(url) {\r\n\t\t\tvar absolute = resolver(url);\r\n\r\n\t\t\treturn archive.createUrl(absolute, {\"base64\": (this.settings.replacements === \"base64\")});\r\n\t\t}.bind(this))\r\n\r\n\treturn Promise.all(replacements)\r\n\t\t.then(function(replacementUrls) {\r\n\t\t\tthis.replacementUrls = replacementUrls;\r\n\t\t\treturn replacementUrls;\r\n\t\t}.bind(this));\r\n};\r\n\r\n/**\r\n * Replace URLs in CSS resources\r\n * @private\r\n * @param  {[Archive]} archive\r\n * @param  {[method]} resolver\r\n * @return {Promise}\r\n */\r\nResources.prototype.replaceCss = function(archive, resolver){\r\n\tvar replaced = [];\r\n\tarchive = archive || this.settings.archive;\r\n\tresolver = resolver || this.settings.resolver;\r\n\tthis.cssUrls.forEach(function(href) {\r\n\t\tvar replacement = this.createCssFile(href, archive, resolver)\r\n\t\t\t.then(function (replacementUrl) {\r\n\t\t\t\t// switch the url in the replacementUrls\r\n\t\t\t\tvar indexInUrls = this.urls.indexOf(href);\r\n\t\t\t\tif (indexInUrls > -1) {\r\n\t\t\t\t\tthis.replacementUrls[indexInUrls] = replacementUrl;\r\n\t\t\t\t}\r\n\t\t\t}.bind(this));\r\n\r\n\t\treplaced.push(replacement);\r\n\t}.bind(this));\r\n\treturn Promise.all(replaced);\r\n};\r\n\r\n/**\r\n * Create a new CSS file with the replaced URLs\r\n * @private\r\n * @param  {string} href the original css file\r\n * @param  {[Archive]} archive\r\n * @param  {[method]} resolver\r\n * @return {Promise}  returns a BlobUrl to the new CSS file or a data url\r\n */\r\nResources.prototype.createCssFile = function(href, archive, resolver){\r\n\t\tvar newUrl;\r\n\t\tvar indexInUrls;\r\n\t\tarchive = archive || this.settings.archive;\r\n\t\tresolver = resolver || this.settings.resolver;\r\n\r\n\t\tif (path.isAbsolute(href)) {\r\n\t\t\treturn new Promise(function(resolve, reject){\r\n\t\t\t\tresolve(urls, replacementUrls);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tvar absolute = resolver(href);\r\n\r\n\t\t// Get the text of the css file from the archive\r\n\t\tvar textResponse = archive.getText(absolute);\r\n\t\t// Get asset links relative to css file\r\n\t\tvar relUrls = this.urls.map(function(assetHref) {\r\n\t\t\t\tvar resolved = resolver(assetHref);\r\n\t\t\t\tvar relative = new Path(absolute).relative(resolved);\r\n\r\n\t\t\t\treturn relative;\r\n\t\t\t}.bind(this));\r\n\r\n\t\treturn textResponse.then(function (text) {\r\n\t\t\t// Replacements in the css text\r\n\t\t\ttext = replace.substitute(text, relUrls, this.replacementUrls);\r\n\r\n\t\t\t// Get the new url\r\n\t\t\tif (this.settings.replacements === \"base64\") {\r\n\t\t\t\tnewUrl = core.createBase64Url(text, 'text/css');\r\n\t\t\t} else {\r\n\t\t\t\tnewUrl = core.createBlobUrl(text, 'text/css');\r\n\t\t\t}\r\n\r\n\t\t\treturn newUrl;\r\n\t\t}.bind(this));\r\n\r\n};\r\n\r\n/**\r\n * Resolve all resources URLs relative to an absolute URL\r\n * @param  {string} absolute to be resolved to\r\n * @param  {[resolver]} resolver\r\n * @return {string[]} array with relative Urls\r\n */\r\nResources.prototype.relativeTo = function(absolute, resolver){\r\n\tresolver = resolver || this.settings.resolver;\r\n\r\n\t// Get Urls relative to current sections\r\n\treturn this.urls.\r\n\t\tmap(function(href) {\r\n\t\t\tvar resolved = resolver(href);\r\n\t\t\tvar relative = new Path(absolute).relative(resolved);\r\n\t\t\treturn relative;\r\n\t\t}.bind(this));\r\n};\r\n\r\n/**\r\n * Get a URL for a resource\r\n * @param  {string} path\r\n * @return {string} url\r\n */\r\nResources.prototype.get = function(path) {\r\n\tvar indexInUrls = this.urls.indexOf(path);\r\n\tif (indexInUrls === -1) {\r\n\t\treturn;\r\n\t}\r\n\tif (this.replacementUrls.length) {\r\n\t\treturn new Promise(function(resolve, reject) {\r\n\t\t\tresolve(this.replacementUrls[indexInUrls]);\r\n\t\t}.bind(this));\r\n\t} else {\r\n\t\treturn archive.createUrl(absolute,\r\n\t\t\t{\"base64\": (this.settings.replacements === \"base64\")})\r\n\t}\r\n}\r\n\r\n/**\r\n * Substitute urls in content, with replacements,\r\n * relative to a url if provided\r\n * @param  {string} content\r\n * @param  {[string]} url   url to resolve to\r\n * @return {string}         content with urls substituted\r\n */\r\nResources.prototype.substitute = function(content, url) {\r\n\tvar relUrls;\r\n\tif (url) {\r\n\t\trelUrls = this.relativeTo(url);\r\n\t} else {\r\n\t\trelUrls = this.urls;\r\n\t}\r\n\treturn replace.substitute(content, relUrls, this.replacementUrls);\r\n};\r\n\r\n\r\nmodule.exports = Resources;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/resources.js\n// module id = 45\n// module chunks = 0","var core = require('./core');\r\nvar EpubCFI = require('./epubcfi');\r\nvar Hook = require('./hook');\r\nvar Url = require('./core').Url;\r\n\r\n/**\r\n * Represents a Section of the Book\r\n * In most books this is equivelent to a Chapter\r\n * @param {object} item  The spine item representing the section\r\n * @param {object} hooks hooks for serialize and content\r\n */\r\nfunction Section(item, hooks){\r\n\t\tthis.idref = item.idref;\r\n\t\tthis.linear = item.linear;\r\n\t\tthis.properties = item.properties;\r\n\t\tthis.index = item.index;\r\n\t\tthis.href = item.href;\r\n\t\tthis.url = item.url;\r\n\t\tthis.next = item.next;\r\n\t\tthis.prev = item.prev;\r\n\r\n\t\tthis.cfiBase = item.cfiBase;\r\n\r\n\t\tif (hooks) {\r\n\t\t\tthis.hooks = hooks;\r\n\t\t} else {\r\n\t\t\tthis.hooks = {};\r\n\t\t\tthis.hooks.serialize = new Hook(this);\r\n\t\t\tthis.hooks.content = new Hook(this);\r\n\t\t}\r\n\r\n};\r\n\r\n/**\r\n * Load the section from its url\r\n * @param  {method} _request a request method to use for loading\r\n * @return {document} a promise with the xml document\r\n */\r\nSection.prototype.load = function(_request){\r\n\tvar request = _request || this.request || require('./request');\r\n\tvar loading = new core.defer();\r\n\tvar loaded = loading.promise;\r\n\r\n\tif(this.contents) {\r\n\t\tloading.resolve(this.contents);\r\n\t} else {\r\n\t\trequest(this.url)\r\n\t\t\t.then(function(xml){\r\n\t\t\t\tvar base;\r\n\t\t\t\tvar directory = new Url(this.url).directory;\r\n\r\n\t\t\t\tthis.document = xml;\r\n\t\t\t\tthis.contents = xml.documentElement;\r\n\r\n\t\t\t\treturn this.hooks.content.trigger(this.document, this);\r\n\t\t\t}.bind(this))\r\n\t\t\t.then(function(){\r\n\t\t\t\tloading.resolve(this.contents);\r\n\t\t\t}.bind(this))\r\n\t\t\t.catch(function(error){\r\n\t\t\t\tloading.reject(error);\r\n\t\t\t});\r\n\t}\r\n\r\n\treturn loaded;\r\n};\r\n\r\n/**\r\n * Adds a base tag for resolving urls in the section\r\n * @private\r\n * @param  {document} _document\r\n */\r\nSection.prototype.base = function(_document){\r\n\t\tvar task = new core.defer();\r\n\t\tvar base = _document.createElement(\"base\"); // TODO: check if exists\r\n\t\tvar head;\r\n\r\n\t\tbase.setAttribute(\"href\", window.location.origin + \"/\" +this.url);\r\n\r\n\t\tif(_document) {\r\n\t\t\thead = _document.querySelector(\"head\");\r\n\t\t}\r\n\t\tif(head) {\r\n\t\t\thead.insertBefore(base, head.firstChild);\r\n\t\t\ttask.resolve();\r\n\t\t} else {\r\n\t\t\ttask.reject(new Error(\"No head to insert into\"));\r\n\t\t}\r\n\r\n\r\n\t\treturn task.promise;\r\n};\r\n\r\n/**\r\n * Render the contents of a section\r\n * @param  {method} _request a request method to use for loading\r\n * @return {string} output a serialized XML Document\r\n */\r\nSection.prototype.render = function(_request){\r\n\tvar rendering = new core.defer();\r\n\tvar rendered = rendering.promise;\r\n\tthis.output; // TODO: better way to return this from hooks?\r\n\r\n\tthis.load(_request).\r\n\t\tthen(function(contents){\r\n\t\t\tvar serializer;\r\n\r\n\t\t\tif (typeof XMLSerializer === \"undefined\") {\r\n\t\t\t\tXMLSerializer = require('xmldom').XMLSerializer;\r\n\t\t\t}\r\n\t\t\tserializer = new XMLSerializer();\r\n\t\t\tthis.output = serializer.serializeToString(contents);\r\n\t\t\treturn this.output;\r\n\t\t}.bind(this)).\r\n\t\tthen(function(){\r\n\t\t\treturn this.hooks.serialize.trigger(this.output, this);\r\n\t\t}.bind(this)).\r\n\t\tthen(function(){\r\n\t\t\trendering.resolve(this.output);\r\n\t\t}.bind(this))\r\n\t\t.catch(function(error){\r\n\t\t\trendering.reject(error);\r\n\t\t});\r\n\r\n\treturn rendered;\r\n};\r\n\r\n/**\r\n * Find a string in a section\r\n * TODO: need reimplementation from v0.2\r\n * @param  {string} query [description]\r\n * @return {[type]} [description]\r\n */\r\nSection.prototype.find = function(query){\r\n\r\n};\r\n\r\n/**\r\n* Reconciles the current chapters layout properies with\r\n* the global layout properities.\r\n* @param {object} global  The globa layout settings object, chapter properties string\r\n* @return {object} layoutProperties Object with layout properties\r\n*/\r\nSection.prototype.reconcileLayoutSettings = function(global){\r\n\t//-- Get the global defaults\r\n\tvar settings = {\r\n\t\tlayout : global.layout,\r\n\t\tspread : global.spread,\r\n\t\torientation : global.orientation\r\n\t};\r\n\r\n\t//-- Get the chapter's display type\r\n\tthis.properties.forEach(function(prop){\r\n\t\tvar rendition = prop.replace(\"rendition:\", '');\r\n\t\tvar split = rendition.indexOf(\"-\");\r\n\t\tvar property, value;\r\n\r\n\t\tif(split != -1){\r\n\t\t\tproperty = rendition.slice(0, split);\r\n\t\t\tvalue = rendition.slice(split+1);\r\n\r\n\t\t\tsettings[property] = value;\r\n\t\t}\r\n\t});\r\n return settings;\r\n};\r\n\r\n/**\r\n * Get a CFI from a Range in the Section\r\n * @param  {range} _range\r\n * @return {string} cfi an EpubCFI string\r\n */\r\nSection.prototype.cfiFromRange = function(_range) {\r\n\treturn new EpubCFI(_range, this.cfiBase).toString();\r\n};\r\n\r\n/**\r\n * Get a CFI from an Element in the Section\r\n * @param  {element} el\r\n * @return {string} cfi an EpubCFI string\r\n */\r\nSection.prototype.cfiFromElement = function(el) {\r\n\treturn new EpubCFI(el, this.cfiBase).toString();\r\n};\r\n\r\nmodule.exports = Section;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/section.js\n// module id = 46\n// module chunks = 0","var core = require('./core');\r\nvar EpubCFI = require('./epubcfi');\r\nvar Hook = require('./hook');\r\nvar Section = require('./section');\r\nvar replacements = require('./replacements');\r\n\r\n/**\r\n * A collection of Spine Items\r\n */\r\nfunction Spine(){\r\n\tthis.spineItems = [];\r\n\tthis.spineByHref = {};\r\n\tthis.spineById = {};\r\n\r\n\tthis.hooks = {};\r\n\tthis.hooks.serialize = new Hook();\r\n\tthis.hooks.content = new Hook();\r\n\r\n\t// Register replacements\r\n\tthis.hooks.content.register(replacements.base);\r\n\tthis.hooks.content.register(replacements.canonical);\r\n\r\n\tthis.epubcfi = new EpubCFI();\r\n\r\n\tthis.loaded = false;\r\n};\r\n\r\n/**\r\n * Unpack items from a opf into spine items\r\n * @param  {Package} _package\r\n * @param  {method} resolver URL resolver\r\n */\r\nSpine.prototype.unpack = function(_package, resolver) {\r\n\r\n\tthis.items = _package.spine;\r\n\tthis.manifest = _package.manifest;\r\n\tthis.spineNodeIndex = _package.spineNodeIndex;\r\n\tthis.baseUrl = _package.baseUrl || _package.basePath || '';\r\n\tthis.length = this.items.length;\r\n\r\n\tthis.items.forEach(function(item, index){\r\n\t\tvar href, url;\r\n\t\tvar manifestItem = this.manifest[item.idref];\r\n\t\tvar spineItem;\r\n\r\n\t\titem.cfiBase = this.epubcfi.generateChapterComponent(this.spineNodeIndex, item.index, item.idref);\r\n\r\n\t\tif(manifestItem) {\r\n\t\t\titem.href = manifestItem.href;\r\n\t\t\titem.url = resolver(item.href, true);\r\n\r\n\t\t\tif(manifestItem.properties.length){\r\n\t\t\t\titem.properties.push.apply(item.properties, manifestItem.properties);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\titem.prev = function(){ return this.get(index-1); }.bind(this);\r\n\t\titem.next = function(){ return this.get(index+1); }.bind(this);\r\n\r\n\t\tspineItem = new Section(item, this.hooks);\r\n\r\n\t\tthis.append(spineItem);\r\n\r\n\r\n\t}.bind(this));\r\n\r\n\tthis.loaded = true;\r\n};\r\n\r\n/**\r\n * Get an item from the spine\r\n * @param  {[string|int]} target\r\n * @return {Section} section\r\n * @example spine.get();\r\n * @example spine.get(1);\r\n * @example spine.get(\"chap1.html\");\r\n * @example spine.get(\"#id1234\");\r\n */\r\nSpine.prototype.get = function(target) {\r\n\tvar index = 0;\r\n\r\n\tif(this.epubcfi.isCfiString(target)) {\r\n\t\tcfi = new EpubCFI(target);\r\n\t\tindex = cfi.spinePos;\r\n\t} else if(target && (typeof target === \"number\" || isNaN(target) === false)){\r\n\t\tindex = target;\r\n\t} else if(target && target.indexOf(\"#\") === 0) {\r\n\t\tindex = this.spineById[target.substring(1)];\r\n\t} else if(target) {\r\n\t\t// Remove fragments\r\n\t\ttarget = target.split(\"#\")[0];\r\n\t\tindex = this.spineByHref[target];\r\n\t}\r\n\r\n\treturn this.spineItems[index] || null;\r\n};\r\n\r\n/**\r\n * Append a Section to the Spine\r\n * @private\r\n * @param  {Section} section\r\n */\r\nSpine.prototype.append = function(section) {\r\n\tvar index = this.spineItems.length;\r\n\tsection.index = index;\r\n\r\n\tthis.spineItems.push(section);\r\n\r\n\tthis.spineByHref[section.href] = index;\r\n\tthis.spineById[section.idref] = index;\r\n\r\n\treturn index;\r\n};\r\n\r\n/**\r\n * Prepend a Section to the Spine\r\n * @private\r\n * @param  {Section} section\r\n */\r\nSpine.prototype.prepend = function(section) {\r\n\tvar index = this.spineItems.unshift(section);\r\n\tthis.spineByHref[section.href] = 0;\r\n\tthis.spineById[section.idref] = 0;\r\n\r\n\t// Re-index\r\n\tthis.spineItems.forEach(function(item, index){\r\n\t\titem.index = index;\r\n\t});\r\n\r\n\treturn 0;\r\n};\r\n\r\n// Spine.prototype.insert = function(section, index) {\r\n//\r\n// };\r\n\r\n/**\r\n * Remove a Section from the Spine\r\n * @private\r\n * @param  {Section} section\r\n */\r\nSpine.prototype.remove = function(section) {\r\n\tvar index = this.spineItems.indexOf(section);\r\n\r\n\tif(index > -1) {\r\n\t\tdelete this.spineByHref[section.href];\r\n\t\tdelete this.spineById[section.idref];\r\n\r\n\t\treturn this.spineItems.splice(index, 1);\r\n\t}\r\n};\r\n\r\n/**\r\n * Loop over the Sections in the Spine\r\n * @return {method} forEach\r\n */\r\nSpine.prototype.each = function() {\r\n\treturn this.spineItems.forEach.apply(this.spineItems, arguments);\r\n};\r\n\r\nmodule.exports = Spine;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/spine.js\n// module id = 47\n// module chunks = 0","if(typeof __WEBPACK_EXTERNAL_MODULE_48__ === 'undefined') {var e = new Error(\"Cannot find module \\\"JSZip\\\"\"); e.code = 'MODULE_NOT_FOUND'; throw e;}\nmodule.exports = __WEBPACK_EXTERNAL_MODULE_48__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"JSZip\"\n// module id = 48\n// module chunks = 0","var Book = require('./book');\r\nvar EpubCFI = require('./epubcfi');\r\nvar Rendition = require('./rendition');\r\nvar Contents = require('./contents');\r\n\r\n/**\r\n * Creates a new Book\r\n * @param {string|ArrayBuffer} url URL, Path or ArrayBuffer\r\n * @param {object} options to pass to the book\r\n * @returns {Book} a new Book object\r\n * @example ePub(\"/path/to/book.epub\", {})\r\n */\r\nfunction ePub(url, options) {\r\n\treturn new Book(url, options);\r\n};\r\n\r\nePub.VERSION = \"0.3.0\";\r\n\r\nif (typeof(global) !== \"undefined\") {\r\n\tglobal.EPUBJS_VERSION = ePub.VERSION;\r\n}\r\n\r\nePub.CFI = EpubCFI;\r\nePub.Rendition = Rendition;\r\nePub.Contents = Contents;\r\n\r\nePub.ViewManagers = {};\r\nePub.Views = {};\r\n/**\r\n * register plugins\r\n */\r\nePub.register = {\r\n\t/**\r\n\t * register a new view manager\r\n\t */\r\n\tmanager : function(name, manager){\r\n\t\treturn ePub.ViewManagers[name] = manager;\r\n\t},\r\n\t/**\r\n\t * register a new view\r\n\t */\r\n\tview : function(name, view){\r\n\t\treturn ePub.Views[name] = view;\r\n\t}\r\n};\r\n\r\n// Default Views\r\nePub.register.view(\"iframe\", require('./managers/views/iframe'));\r\n\r\n// Default View Managers\r\nePub.register.manager(\"default\", require('./managers/default'));\r\nePub.register.manager(\"continuous\", require('./managers/continuous'));\r\n\r\nmodule.exports = ePub;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/epub.js\n// module id = 50\n// module chunks = 0"],"sourceRoot":""}